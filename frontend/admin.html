<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTIC Legal Calendar - Qu·∫£n tr·ªã</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .sidebar { transition: transform 0.3s ease; }
        .sidebar-item.active { background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white; }
        .sidebar-item:hover:not(.active) { background: #F3F4F6; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .btn-primary { background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%); }
        .btn-danger { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); }
        .table-row:hover { background: #F9FAFB; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #D1FAE5; color: #065F46; }
        .badge-warning { background: #FEF3C7; color: #92400E; }
        .badge-danger { background: #FEE2E2; color: #991B1B; }
        .badge-info { background: #DBEAFE; color: #1E40AF; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 20px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .input-field { border: 2px solid #E5E7EB; border-radius: 12px; padding: 12px 16px; transition: all 0.2s; }
        .input-field:focus { border-color: #3B82F6; outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .toast { position: fixed; top: 20px; right: 20px; padding: 16px 24px; border-radius: 12px; color: white; z-index: 2000; animation: slideIn 0.3s ease; }
        .toast-success { background: #10B981; }
        .toast-error { background: #EF4444; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .stat-card { background: linear-gradient(135deg, var(--from) 0%, var(--to) 100%); }
        .logo-preview { width: 120px; height: 120px; border: 3px dashed #E5E7EB; border-radius: 16px; display: flex; align-items: center; justify-content: center; }
        .logo-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-content-center bg-gradient-to-br from-blue-500 to-blue-700">
        <div class="w-full max-w-md mx-auto p-6">
            <div class="card p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">HTIC Legal Calendar</h1>
                    <p class="text-gray-500 mt-2">ƒêƒÉng nh·∫≠p trang qu·∫£n tr·ªã</p>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n ƒëƒÉng nh·∫≠p</label>
                        <input type="text" id="username" class="input-field w-full" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">M·∫≠t kh·∫©u</label>
                        <input type="password" id="password" class="input-field w-full" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                    </div>
                    <button type="submit" class="btn-primary w-full py-3 text-white font-semibold rounded-xl">
                        ƒêƒÉng nh·∫≠p
                    </button>
                </form>
                <p id="loginError" class="text-red-500 text-center mt-4 hidden">Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u</p>
            </div>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar fixed left-0 top-0 h-full w-64 bg-white border-r border-gray-200 z-50">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">H</span>
                    </div>
                    <div>
                        <h2 class="font-bold text-gray-800">HTIC Legal</h2>
                        <p class="text-xs text-gray-500">Trang qu·∫£n tr·ªã</p>
                    </div>
                </div>
            </div>
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="sidebar-item active flex items-center gap-3 px-4 py-3 rounded-xl" data-page="dashboard">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                            <span>T·ªïng quan</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600" data-page="events">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            <span>L·ªãch ph√°p l√Ω</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600" data-page="news">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
                            <span>Tin t·ª©c</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600" data-page="agencies">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                            <span>C∆° quan</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600" data-page="customers">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            <span>Kh√°ch h√†ng</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600" data-page="settings">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            <span>C√†i ƒë·∫∑t</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
                <button onclick="logout()" class="flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 w-full">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                    <span>ƒêƒÉng xu·∫•t</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 p-8">
            <!-- Header -->
            <header class="flex items-center justify-between mb-8">
                <div>
                    <h1 id="pageTitle" class="text-2xl font-bold text-gray-800">T·ªïng quan</h1>
                    <p id="pageSubtitle" class="text-gray-500">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi trang qu·∫£n tr·ªã</p>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-500" id="currentDate"></span>
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                        <span class="text-blue-600 font-semibold">A</span>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div id="pageContent">
                <!-- Dashboard s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Modal</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
            </div>
            <div id="modalBody" class="p-6">
                <!-- Form content -->
            </div>
        </div>
    </div>

    <script>
        // =============== CONFIG ===============
        const API_BASE = window.location.origin;
        let currentPage = 'dashboard';
        let editingId = null;

        // =============== INIT ===============
        document.addEventListener('DOMContentLoaded', () => {
            // Check login
            if (localStorage.getItem('adminToken')) {
                showAdminPanel();
            }

            // Login form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                try {
                    const res = await fetch(`${API_BASE}/api/admin/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    const data = await res.json();
                    
                    if (data.success) {
                        localStorage.setItem('adminToken', data.token);
                        showAdminPanel();
                        showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                    } else {
                        document.getElementById('loginError').classList.remove('hidden');
                    }
                } catch (err) {
                    showToast('L·ªói k·∫øt n·ªëi server', 'error');
                }
            });

            // Sidebar navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.dataset.page;
                    navigateTo(page);
                });
            });

            // Current date
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('vi-VN', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
        });

        // =============== NAVIGATION ===============
        function showAdminPanel() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            navigateTo('dashboard');
        }

        function logout() {
            localStorage.removeItem('adminToken');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            showToast('ƒê√£ ƒëƒÉng xu·∫•t', 'success');
        }

        function navigateTo(page) {
            currentPage = page;
            
            // Update sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                item.classList.add('text-gray-600');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                    item.classList.remove('text-gray-600');
                }
            });

            // Update header
            const titles = {
                dashboard: ['T·ªïng quan', 'Th·ªëng k√™ d·ªØ li·ªáu h·ªá th·ªëng'],
                events: ['L·ªãch ph√°p l√Ω', 'Qu·∫£n l√Ω c√°c m·ªëc th·ªùi gian b√°o c√°o'],
                news: ['Tin t·ª©c ph√°p lu·∫≠t', 'Qu·∫£n l√Ω tin t·ª©c (m·ªõi nh·∫•t hi·ªán tr∆∞·ªõc)'],
                agencies: ['C∆° quan ph√°p l√Ω', 'Qu·∫£n l√Ω danh s√°ch c∆° quan, vƒÉn ph√≤ng'],
                customers: ['Kh√°ch h√†ng', 'Danh s√°ch kh√°ch h√†ng ƒëƒÉng k√Ω'],
                settings: ['C√†i ƒë·∫∑t', 'C·∫•u h√¨nh ·ª©ng d·ª•ng']
            };
            document.getElementById('pageTitle').textContent = titles[page][0];
            document.getElementById('pageSubtitle').textContent = titles[page][1];

            // Load page content
            loadPage(page);
        }

        async function loadPage(page) {
            const content = document.getElementById('pageContent');
            
            switch(page) {
                case 'dashboard': await loadDashboard(); break;
                case 'events': await loadEvents(); break;
                case 'news': await loadNews(); break;
                case 'agencies': await loadAgencies(); break;
                case 'customers': await loadCustomers(); break;
                case 'settings': await loadSettings(); break;
            }
        }

        // =============== DASHBOARD ===============
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/stats`);
                const data = await res.json();
                const stats = data.data;

                document.getElementById('pageContent').innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card p-6 rounded-2xl text-white" style="--from: #3B82F6; --to: #2563EB;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100">L·ªãch ph√°p l√Ω</p>
                                    <p class="text-3xl font-bold mt-2">${stats.events.total}</p>
                                    <p class="text-sm text-blue-100 mt-1">${stats.events.active} ƒëang ho·∫°t ƒë·ªông</p>
                                </div>
                                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-6 rounded-2xl text-white" style="--from: #10B981; --to: #059669;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100">Tin t·ª©c</p>
                                    <p class="text-3xl font-bold mt-2">${stats.news.total}</p>
                                    <p class="text-sm text-green-100 mt-1">${stats.news.hot} tin n·ªïi b·∫≠t</p>
                                </div>
                                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-6 rounded-2xl text-white" style="--from: #F59E0B; --to: #D97706;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100">C∆° quan</p>
                                    <p class="text-3xl font-bold mt-2">${stats.agencies.total}</p>
                                    <p class="text-sm text-yellow-100 mt-1">ƒë∆°n v·ªã</p>
                                </div>
                                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-6 rounded-2xl text-white" style="--from: #8B5CF6; --to: #7C3AED;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100">Kh√°ch h√†ng</p>
                                    <p class="text-3xl font-bold mt-2">${stats.customers.total}</p>
                                    <p class="text-sm text-purple-100 mt-1">${stats.customers.pro} g√≥i Pro</p>
                                </div>
                                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">H∆∞·ªõng d·∫´n nhanh</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-xl">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 font-bold">1</div>
                                    <p class="text-gray-700">Th√™m/s·ª≠a <strong>L·ªãch ph√°p l√Ω</strong> ƒë·ªÉ c·∫≠p nh·∫≠t deadline</p>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-green-50 rounded-xl">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center text-green-600 font-bold">2</div>
                                    <p class="text-gray-700">ƒêƒÉng <strong>Tin t·ª©c</strong> m·ªõi - tin m·ªõi nh·∫•t t·ª± ƒë·ªông l√™n ƒë·∫ßu</p>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-yellow-50 rounded-xl">
                                    <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center text-yellow-600 font-bold">3</div>
                                    <p class="text-gray-700">Qu·∫£n l√Ω <strong>C∆° quan</strong> v√† th√¥ng tin li√™n h·ªá</p>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-xl">
                                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 font-bold">4</div>
                                    <p class="text-gray-700">Xem danh s√°ch <strong>Kh√°ch h√†ng</strong> ƒë√£ ƒëƒÉng k√Ω</p>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin h·ªá th·ªëng</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                    <span class="text-gray-600">Phi√™n b·∫£n</span>
                                    <span class="font-semibold text-gray-800">2.0.0</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                    <span class="text-gray-600">Server</span>
                                    <span class="badge badge-success">ƒêang ho·∫°t ƒë·ªông</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                    <span class="text-gray-600">C·∫≠p nh·∫≠t cu·ªëi</span>
                                    <span class="font-semibold text-gray-800">${new Date().toLocaleDateString('vi-VN')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        // =============== EVENTS ===============
        async function loadEvents() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/events`);
                const data = await res.json();
                const events = data.data || [];

                const categoryLabels = {
                    tax: 'Thu·∫ø', insurance: 'B·∫£o hi·ªÉm', report: 'B√°o c√°o', 
                    labor: 'Lao ƒë·ªông', license: 'Gi·∫•y ph√©p', other: 'Kh√°c'
                };

                document.getElementById('pageContent').innerHTML = `
                    <div class="card">
                        <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-lg font-bold text-gray-800">Danh s√°ch l·ªãch (${events.length})</h3>
                            <button onclick="openEventModal()" class="btn-primary px-4 py-2 text-white rounded-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                Th√™m l·ªãch m·ªõi
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Ti√™u ƒë·ªÅ</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Danh m·ª•c</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">T·∫ßn su·∫•t</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Ng√†y</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Tr·∫°ng th√°i</th>
                                        <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${events.map(e => `
                                        <tr class="table-row">
                                            <td class="px-6 py-4">
                                                <div class="font-medium text-gray-800">${e.title}</div>
                                                <div class="text-sm text-gray-500">${e.description || ''}</div>
                                            </td>
                                            <td class="px-6 py-4"><span class="badge badge-info">${categoryLabels[e.category] || e.category}</span></td>
                                            <td class="px-6 py-4 text-gray-600">${e.frequency === 'monthly' ? 'H√†ng th√°ng' : e.frequency === 'quarterly' ? 'H√†ng qu√Ω' : 'H√†ng nƒÉm'}</td>
                                            <td class="px-6 py-4 text-gray-600">Ng√†y ${e.dayOfMonth}${e.month ? '/' + e.month : ''}</td>
                                            <td class="px-6 py-4">
                                                <span class="badge ${e.isActive !== false ? 'badge-success' : 'badge-danger'}">${e.isActive !== false ? 'Ho·∫°t ƒë·ªông' : 'T·∫Øt'}</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <button onclick='openEventModal(${JSON.stringify(e)})' class="text-blue-600 hover:text-blue-800 mr-3">S·ª≠a</button>
                                                <button onclick="deleteEvent(${e.id})" class="text-red-600 hover:text-red-800">X√≥a</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        function openEventModal(event = null) {
            editingId = event?.id || null;
            document.getElementById('modalTitle').textContent = event ? 'S·ª≠a l·ªãch ph√°p l√Ω' : 'Th√™m l·ªãch ph√°p l√Ω';
            document.getElementById('modalBody').innerHTML = `
                <form id="eventForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ti√™u ƒë·ªÅ *</label>
                        <input type="text" name="title" value="${event?.title || ''}" class="input-field w-full" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Danh m·ª•c</label>
                            <select name="category" class="input-field w-full">
                                <option value="tax" ${event?.category === 'tax' ? 'selected' : ''}>Thu·∫ø</option>
                                <option value="insurance" ${event?.category === 'insurance' ? 'selected' : ''}>B·∫£o hi·ªÉm</option>
                                <option value="report" ${event?.category === 'report' ? 'selected' : ''}>B√°o c√°o</option>
                                <option value="labor" ${event?.category === 'labor' ? 'selected' : ''}>Lao ƒë·ªông</option>
                                <option value="license" ${event?.category === 'license' ? 'selected' : ''}>Gi·∫•y ph√©p</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">T·∫ßn su·∫•t</label>
                            <select name="frequency" class="input-field w-full">
                                <option value="monthly" ${event?.frequency === 'monthly' ? 'selected' : ''}>H√†ng th√°ng</option>
                                <option value="quarterly" ${event?.frequency === 'quarterly' ? 'selected' : ''}>H√†ng qu√Ω</option>
                                <option value="yearly" ${event?.frequency === 'yearly' ? 'selected' : ''}>H√†ng nƒÉm</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ng√†y trong th√°ng</label>
                            <input type="number" name="dayOfMonth" value="${event?.dayOfMonth || 20}" min="1" max="31" class="input-field w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Th√°ng (n·∫øu h√†ng nƒÉm)</label>
                            <input type="number" name="month" value="${event?.month || ''}" min="1" max="12" class="input-field w-full" placeholder="1-12">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">M√¥ t·∫£</label>
                        <textarea name="description" rows="2" class="input-field w-full">${event?.description || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">CƒÉn c·ª© ph√°p l√Ω</label>
                        <input type="text" name="legalReference" value="${event?.legalReference || ''}" class="input-field w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">M·ª©c ph·∫°t vi ph·∫°m</label>
                        <input type="text" name="penalty" value="${event?.penalty || ''}" class="input-field w-full">
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" name="isActive" id="isActive" ${event?.isActive !== false ? 'checked' : ''}>
                        <label for="isActive" class="text-sm text-gray-700">ƒêang ho·∫°t ƒë·ªông</label>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50">H·ªßy</button>
                        <button type="submit" class="flex-1 btn-primary px-4 py-3 text-white rounded-xl">L∆∞u</button>
                    </div>
                </form>
            `;
            document.getElementById('eventForm').addEventListener('submit', saveEvent);
            openModal();
        }

        async function saveEvent(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                title: form.title.value,
                category: form.category.value,
                frequency: form.frequency.value,
                dayOfMonth: parseInt(form.dayOfMonth.value),
                month: form.month.value ? parseInt(form.month.value) : null,
                description: form.description.value,
                legalReference: form.legalReference.value,
                penalty: form.penalty.value,
                isActive: form.isActive.checked
            };

            try {
                const url = editingId ? `${API_BASE}/api/admin/events/${editingId}` : `${API_BASE}/api/admin/events`;
                const method = editingId ? 'PUT' : 'POST';
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.success) {
                    showToast(result.message, 'success');
                    closeModal();
                    loadEvents();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói l∆∞u d·ªØ li·ªáu', 'error');
            }
        }

        async function deleteEvent(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch n√†y?')) return;
            try {
                const res = await fetch(`${API_BASE}/api/admin/events/${id}`, { method: 'DELETE' });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ x√≥a th√†nh c√¥ng', 'success');
                    loadEvents();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói x√≥a d·ªØ li·ªáu', 'error');
            }
        }

        // =============== NEWS ===============
        async function loadNews() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/news`);
                const data = await res.json();
                const news = data.data || [];

                document.getElementById('pageContent').innerHTML = `
                    <div class="card">
                        <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">Danh s√°ch tin t·ª©c (${news.length})</h3>
                                <p class="text-sm text-gray-500">Tin m·ªõi nh·∫•t hi·ªÉn th·ªã ƒë·∫ßu ti√™n</p>
                            </div>
                            <button onclick="openNewsModal()" class="btn-primary px-4 py-2 text-white rounded-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                Th√™m tin m·ªõi
                            </button>
                        </div>
                        <div class="divide-y divide-gray-200">
                            ${news.map((n, index) => `
                                <div class="p-6 table-row flex items-start gap-4">
                                    <div class="flex-shrink-0">
                                        ${index === 0 ? '<span class="badge badge-success">M·ªöI NH·∫§T</span>' : `<span class="text-gray-400 font-medium">#${index + 1}</span>`}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">${n.title}</h4>
                                            ${n.isHot ? '<span class="badge badge-danger">HOT</span>' : ''}
                                        </div>
                                        <p class="text-sm text-gray-500 mb-2">${n.summary || ''}</p>
                                        <div class="flex items-center gap-4 text-xs text-gray-400">
                                            <span class="badge badge-info">${n.category || 'Chung'}</span>
                                            <span>üìÖ ${n.date}</span>
                                            ${n.source ? `<span>üì∞ ${n.source}</span>` : ''}
                                        </div>
                                    </div>
                                    <div class="flex-shrink-0">
                                        <button onclick='openNewsModal(${JSON.stringify(n).replace(/'/g, "\\'")})' class="text-blue-600 hover:text-blue-800 mr-3">S·ª≠a</button>
                                        <button onclick="deleteNews(${n.id})" class="text-red-600 hover:text-red-800">X√≥a</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        function openNewsModal(news = null) {
            editingId = news?.id || null;
            document.getElementById('modalTitle').textContent = news ? 'S·ª≠a tin t·ª©c' : 'Th√™m tin t·ª©c m·ªõi';
            document.getElementById('modalBody').innerHTML = `
                <form id="newsForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ti√™u ƒë·ªÅ *</label>
                        <input type="text" name="title" value="${news?.title || ''}" class="input-field w-full" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Danh m·ª•c</label>
                            <select name="category" class="input-field w-full">
                                <option value="tax" ${news?.category === 'tax' ? 'selected' : ''}>Thu·∫ø</option>
                                <option value="insurance" ${news?.category === 'insurance' ? 'selected' : ''}>B·∫£o hi·ªÉm</option>
                                <option value="labor" ${news?.category === 'labor' ? 'selected' : ''}>Lao ƒë·ªông</option>
                                <option value="enterprise" ${news?.category === 'enterprise' ? 'selected' : ''}>Doanh nghi·ªáp</option>
                                <option value="general" ${news?.category === 'general' ? 'selected' : ''}>Chung</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ng√†y ƒëƒÉng</label>
                            <input type="date" name="date" value="${news?.date || new Date().toISOString().split('T')[0]}" class="input-field w-full">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√≥m t·∫Øt</label>
                        <textarea name="summary" rows="2" class="input-field w-full">${news?.summary || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">N·ªôi dung chi ti·∫øt</label>
                        <textarea name="content" rows="4" class="input-field w-full">${news?.content || ''}</textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ngu·ªìn</label>
                            <input type="text" name="source" value="${news?.source || ''}" class="input-field w-full" placeholder="VD: Th∆∞ vi·ªán ph√°p lu·∫≠t">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link ngu·ªìn</label>
                            <input type="url" name="sourceUrl" value="${news?.sourceUrl || ''}" class="input-field w-full" placeholder="https://...">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Link h√¨nh ·∫£nh</label>
                        <input type="url" name="image" value="${news?.image || ''}" class="input-field w-full" placeholder="https://...">
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" name="isHot" id="isHot" ${news?.isHot ? 'checked' : ''}>
                        <label for="isHot" class="text-sm text-gray-700">ƒê√°nh d·∫•u tin n·ªïi b·∫≠t (HOT)</label>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50">H·ªßy</button>
                        <button type="submit" class="flex-1 btn-primary px-4 py-3 text-white rounded-xl">L∆∞u</button>
                    </div>
                </form>
            `;
            document.getElementById('newsForm').addEventListener('submit', saveNews);
            openModal();
        }

        async function saveNews(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                title: form.title.value,
                category: form.category.value,
                date: form.date.value,
                summary: form.summary.value,
                content: form.content.value,
                source: form.source.value,
                sourceUrl: form.sourceUrl.value,
                image: form.image.value,
                isHot: form.isHot.checked
            };

            try {
                const url = editingId ? `${API_BASE}/api/admin/news/${editingId}` : `${API_BASE}/api/admin/news`;
                const method = editingId ? 'PUT' : 'POST';
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.success) {
                    showToast(result.message, 'success');
                    closeModal();
                    loadNews();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói l∆∞u d·ªØ li·ªáu', 'error');
            }
        }

        async function deleteNews(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tin t·ª©c n√†y?')) return;
            try {
                const res = await fetch(`${API_BASE}/api/admin/news/${id}`, { method: 'DELETE' });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ x√≥a th√†nh c√¥ng', 'success');
                    loadNews();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói x√≥a d·ªØ li·ªáu', 'error');
            }
        }

        // =============== AGENCIES ===============
        async function loadAgencies() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/agencies`);
                const data = await res.json();
                const agencies = data.data || [];

                const typeLabels = {
                    government: 'C∆° quan NN', law_firm: 'VP Lu·∫≠t', notary: 'C√¥ng ch·ª©ng', bailiff: 'Th·ª´a ph√°t l·∫°i'
                };

                document.getElementById('pageContent').innerHTML = `
                    <div class="card">
                        <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-lg font-bold text-gray-800">Danh s√°ch c∆° quan (${agencies.length})</h3>
                            <button onclick="openAgencyModal()" class="btn-primary px-4 py-2 text-white rounded-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                Th√™m c∆° quan
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">T√™n c∆° quan</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Lo·∫°i</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">ƒê·ªãa ch·ªâ</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">ƒêi·ªán tho·∫°i</th>
                                        <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${agencies.map(a => `
                                        <tr class="table-row">
                                            <td class="px-6 py-4 font-medium text-gray-800">${a.name}</td>
                                            <td class="px-6 py-4"><span class="badge badge-info">${typeLabels[a.type] || a.type}</span></td>
                                            <td class="px-6 py-4 text-gray-600">${a.address || ''}</td>
                                            <td class="px-6 py-4 text-gray-600">${a.phone || ''}</td>
                                            <td class="px-6 py-4 text-right">
                                                <button onclick='openAgencyModal(${JSON.stringify(a).replace(/'/g, "\\'")})' class="text-blue-600 hover:text-blue-800 mr-3">S·ª≠a</button>
                                                <button onclick="deleteAgency(${a.id})" class="text-red-600 hover:text-red-800">X√≥a</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        function openAgencyModal(agency = null) {
            editingId = agency?.id || null;
            document.getElementById('modalTitle').textContent = agency ? 'S·ª≠a c∆° quan' : 'Th√™m c∆° quan m·ªõi';
            document.getElementById('modalBody').innerHTML = `
                <form id="agencyForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n c∆° quan *</label>
                        <input type="text" name="name" value="${agency?.name || ''}" class="input-field w-full" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lo·∫°i c∆° quan</label>
                        <select name="type" class="input-field w-full">
                            <option value="government" ${agency?.type === 'government' ? 'selected' : ''}>C∆° quan Nh√† n∆∞·ªõc</option>
                            <option value="law_firm" ${agency?.type === 'law_firm' ? 'selected' : ''}>VƒÉn ph√≤ng Lu·∫≠t s∆∞</option>
                            <option value="notary" ${agency?.type === 'notary' ? 'selected' : ''}>VƒÉn ph√≤ng C√¥ng ch·ª©ng</option>
                            <option value="bailiff" ${agency?.type === 'bailiff' ? 'selected' : ''}>VƒÉn ph√≤ng Th·ª´a ph√°t l·∫°i</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ƒê·ªãa ch·ªâ</label>
                        <input type="text" name="address" value="${agency?.address || ''}" class="input-field w-full">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ƒêi·ªán tho·∫°i</label>
                            <input type="text" name="phone" value="${agency?.phone || ''}" class="input-field w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" name="email" value="${agency?.email || ''}" class="input-field w-full">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                        <input type="url" name="website" value="${agency?.website || ''}" class="input-field w-full">
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50">H·ªßy</button>
                        <button type="submit" class="flex-1 btn-primary px-4 py-3 text-white rounded-xl">L∆∞u</button>
                    </div>
                </form>
            `;
            document.getElementById('agencyForm').addEventListener('submit', saveAgency);
            openModal();
        }

        async function saveAgency(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                name: form.name.value,
                type: form.type.value,
                address: form.address.value,
                phone: form.phone.value,
                email: form.email.value,
                website: form.website.value
            };

            try {
                const url = editingId ? `${API_BASE}/api/admin/agencies/${editingId}` : `${API_BASE}/api/admin/agencies`;
                const method = editingId ? 'PUT' : 'POST';
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.success) {
                    showToast(result.message, 'success');
                    closeModal();
                    loadAgencies();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói l∆∞u d·ªØ li·ªáu', 'error');
            }
        }

        async function deleteAgency(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c∆° quan n√†y?')) return;
            try {
                const res = await fetch(`${API_BASE}/api/admin/agencies/${id}`, { method: 'DELETE' });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ x√≥a th√†nh c√¥ng', 'success');
                    loadAgencies();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (err) {
                showToast('L·ªói x√≥a d·ªØ li·ªáu', 'error');
            }
        }

        // =============== CUSTOMERS ===============
        async function loadCustomers() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/customers`);
                const data = await res.json();
                const customers = data.data || [];

                document.getElementById('pageContent').innerHTML = `
                    <div class="card">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800">Danh s√°ch kh√°ch h√†ng ƒëƒÉng k√Ω (${customers.length})</h3>
                            <p class="text-sm text-gray-500">Kh√°ch h√†ng m·ªõi ƒëƒÉng k√Ω hi·ªÉn th·ªã ƒë·∫ßu ti√™n</p>
                        </div>
                        ${customers.length === 0 ? `
                            <div class="p-12 text-center">
                                <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                <p class="text-gray-500">Ch∆∞a c√≥ kh√°ch h√†ng n√†o ƒëƒÉng k√Ω</p>
                            </div>
                        ` : `
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Kh√°ch h√†ng</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Li√™n h·ªá</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">C√¥ng ty</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">Ng√†y ƒëƒÉng k√Ω</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase">G√≥i</th>
                                            <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase">Thao t√°c</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${customers.map(c => `
                                            <tr class="table-row">
                                                <td class="px-6 py-4">
                                                    <div class="font-medium text-gray-800">${c.name || 'Ch∆∞a c√≥ t√™n'}</div>
                                                    ${c.note ? `<div class="text-sm text-gray-500">${c.note}</div>` : ''}
                                                </td>
                                                <td class="px-6 py-4">
                                                    <div class="text-gray-600">${c.email || ''}</div>
                                                    <div class="text-sm text-gray-500">${c.phone || ''}</div>
                                                </td>
                                                <td class="px-6 py-4 text-gray-600">${c.company || '-'}</td>
                                                <td class="px-6 py-4 text-gray-600">${new Date(c.createdAt).toLocaleDateString('vi-VN')}</td>
                                                <td class="px-6 py-4">
                                                    <span class="badge ${c.isPro ? 'badge-warning' : 'badge-info'}">${c.isPro ? 'PRO' : 'Mi·ªÖn ph√≠'}</span>
                                                </td>
                                                <td class="px-6 py-4 text-right">
                                                    <button onclick="toggleProCustomer(${c.id}, ${!c.isPro})" class="text-blue-600 hover:text-blue-800 mr-3">${c.isPro ? 'H·ªßy Pro' : 'N√¢ng Pro'}</button>
                                                    <button onclick="deleteCustomer(${c.id})" class="text-red-600 hover:text-red-800">X√≥a</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `}
                    </div>
                `;
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        async function toggleProCustomer(id, isPro) {
            try {
                const res = await fetch(`${API_BASE}/api/admin/customers/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isPro })
                });
                const result = await res.json();
                if (result.success) {
                    showToast(isPro ? 'ƒê√£ n√¢ng c·∫•p Pro' : 'ƒê√£ h·ªßy Pro', 'success');
                    loadCustomers();
                }
            } catch (err) {
                showToast('L·ªói c·∫≠p nh·∫≠t', 'error');
            }
        }

        async function deleteCustomer(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√°ch h√†ng n√†y?')) return;
            try {
                const res = await fetch(`${API_BASE}/api/admin/customers/${id}`, { method: 'DELETE' });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ x√≥a th√†nh c√¥ng', 'success');
                    loadCustomers();
                }
            } catch (err) {
                showToast('L·ªói x√≥a d·ªØ li·ªáu', 'error');
            }
        }

        // =============== SETTINGS ===============
        async function loadSettings() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/settings`);
                const data = await res.json();
                const settings = data.data || {};

                document.getElementById('pageContent').innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Logo -->
                        <div class="card p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Logo ·ª©ng d·ª•ng</h3>
                            <div class="flex items-start gap-6">
                                <div class="logo-preview" id="logoPreview">
                                    ${settings.logo ? `<img src="${settings.logo}" alt="Logo">` : '<span class="text-gray-400">Ch∆∞a c√≥ logo</span>'}
                                </div>
                                <div class="flex-1">
                                    <input type="url" id="logoUrl" value="${settings.logo || ''}" placeholder="Nh·∫≠p URL h√¨nh ·∫£nh logo" class="input-field w-full mb-3">
                                    <div class="flex gap-2">
                                        <button onclick="saveLogo()" class="btn-primary px-4 py-2 text-white rounded-xl">L∆∞u logo</button>
                                        <button onclick="deleteLogo()" class="px-4 py-2 border border-red-300 text-red-600 rounded-xl hover:bg-red-50">X√≥a</button>
                                    </div>
                                    <p class="text-sm text-gray-500 mt-2">Khuy·∫øn ngh·ªã: 200x200px, ƒë·ªãnh d·∫°ng PNG/SVG</p>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin c√¥ng ty -->
                        <div class="card p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin c√¥ng ty</h3>
                            <form id="settingsForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">T√™n ·ª©ng d·ª•ng</label>
                                    <input type="text" name="appName" value="${settings.appName || 'HTIC Legal Calendar'}" class="input-field w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">T√™n c√¥ng ty</label>
                                    <input type="text" name="companyName" value="${settings.companyName || ''}" class="input-field w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ƒê·ªãa ch·ªâ</label>
                                    <input type="text" name="companyAddress" value="${settings.companyAddress || ''}" class="input-field w-full">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ƒêi·ªán tho·∫°i</label>
                                        <input type="text" name="companyPhone" value="${settings.companyPhone || ''}" class="input-field w-full">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" name="companyEmail" value="${settings.companyEmail || ''}" class="input-field w-full">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                    <input type="url" name="companyWebsite" value="${settings.companyWebsite || ''}" class="input-field w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Gi√° g√≥i Pro (VNƒê/th√°ng)</label>
                                    <input type="number" name="proPrice" value="${settings.proPrice || 99000}" class="input-field w-full">
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 text-white rounded-xl">L∆∞u c√†i ƒë·∫∑t</button>
                            </form>
                        </div>
                    </div>
                `;

                // Logo preview
                document.getElementById('logoUrl').addEventListener('input', (e) => {
                    const preview = document.getElementById('logoPreview');
                    if (e.target.value) {
                        preview.innerHTML = `<img src="${e.target.value}" alt="Logo" onerror="this.parentElement.innerHTML='<span class=\\'text-red-400\\'>URL kh√¥ng h·ª£p l·ªá</span>'">`;
                    } else {
                        preview.innerHTML = '<span class="text-gray-400">Ch∆∞a c√≥ logo</span>';
                    }
                });

                // Save settings form
                document.getElementById('settingsForm').addEventListener('submit', saveSettings);
            } catch (err) {
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        async function saveLogo() {
            const logo = document.getElementById('logoUrl').value;
            try {
                const res = await fetch(`${API_BASE}/api/admin/settings/logo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ logo })
                });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ l∆∞u logo', 'success');
                }
            } catch (err) {
                showToast('L·ªói l∆∞u logo', 'error');
            }
        }

        async function deleteLogo() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/settings/logo`, { method: 'DELETE' });
                const result = await res.json();
                if (result.success) {
                    document.getElementById('logoUrl').value = '';
                    document.getElementById('logoPreview').innerHTML = '<span class="text-gray-400">Ch∆∞a c√≥ logo</span>';
                    showToast('ƒê√£ x√≥a logo', 'success');
                }
            } catch (err) {
                showToast('L·ªói x√≥a logo', 'error');
            }
        }

        async function saveSettings(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                appName: form.appName.value,
                companyName: form.companyName.value,
                companyAddress: form.companyAddress.value,
                companyPhone: form.companyPhone.value,
                companyEmail: form.companyEmail.value,
                companyWebsite: form.companyWebsite.value,
                proPrice: parseInt(form.proPrice.value)
            };

            try {
                const res = await fetch(`${API_BASE}/api/admin/settings`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.success) {
                    showToast('ƒê√£ l∆∞u c√†i ƒë·∫∑t', 'success');
                }
            } catch (err) {
                showToast('L·ªói l∆∞u c√†i ƒë·∫∑t', 'error');
            }
        }

        // =============== MODAL ===============
        function openModal() {
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            editingId = null;
        }

        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // =============== TOAST ===============
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
