<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3a5f">
    <title>HTIC Legal - L·ªãch Ph√°p L√Ω</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>tailwind.config={theme:{extend:{colors:{navy:{50:'#e8eef5',100:'#c5d4e8',200:'#9db5d6',300:'#7596c4',400:'#5580b6',500:'#3d6d9e',600:'#1e3a5f',700:'#162d4a',800:'#0f2035'},gold:{400:'#f5c842',500:'#e67e22',600:'#d35400'}}}}}</script>
    <style>
        *{font-family:'Inter',sans-serif;-webkit-tap-highlight-color:transparent;box-sizing:border-box}
        html,body,#root{height:100%;margin:0;padding:0;overflow:hidden;background:#f1f5f9}
        .safe-top{padding-top:env(safe-area-inset-top,0px)}.safe-bottom{padding-bottom:env(safe-area-inset-bottom,0px)}
        .hide-scrollbar::-webkit-scrollbar{display:none}.hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
        @keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.slide-up{animation:slideUp .3s ease-out}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}.fade-in{animation:fadeIn .5s ease-out}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.animate-pulse-custom{animation:pulse 2s infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.animate-float{animation:float 3s ease-in-out infinite}
        .touch-active:active{transform:scale(.98);opacity:.9}
        .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .line-clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
    </style>
</head>
<body><div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useMemo,useRef}=React;
const API='/api';

// ============ LOGO COMPONENT ============
const Logo=({size=40})=>{
    const[hasError,setHasError]=useState(false);
    const[appLogo,setAppLogo]=useState(null);
    useEffect(()=>{
        fetch(API+'/settings/logo').then(r=>r.json()).then(d=>{
            if(d.success&&d.data?.logo)setAppLogo(d.data.logo);
        }).catch(()=>{});
    },[]);
    if(appLogo&&!hasError){
        return <img src={appLogo} width={size} height={size} style={{borderRadius:'12px',objectFit:'contain'}} onError={()=>setHasError(true)}/>;
    }
    if(!hasError){
        return <img src="/images/logo.png" width={size} height={size} style={{borderRadius:'12px',objectFit:'contain'}} onError={()=>setHasError(true)}/>;
    }
    return(<div style={{width:size,height:size,background:'linear-gradient(135deg,#1e3a5f,#162d4a)',borderRadius:'12px',display:'flex',alignItems:'center',justifyContent:'center'}}><span style={{color:'white',fontWeight:'bold',fontSize:size*0.45}}>H</span></div>);
};

const COMPANY_INFO={name:'C√¥ng ty Lu·∫≠t HTIC',website:'www.htic.com.vn',phone:'0379 044 299',email:'contact@htic.com.vn'};
const MEMBERSHIP_PLANS={free:{name:'Mi·ªÖn ph√≠',price:0,features:['Xem l·ªãch ph√°p l√Ω','ƒê·ªçc tin t·ª©c','C√≥ qu·∫£ng c√°o']},pro_monthly:{name:'Pro Th√°ng',price:61000,period:'th√°ng',features:['Kh√¥ng qu·∫£ng c√°o','Hi·ªÉn th·ªã DN trong H·ªó tr·ª£','∆Øu ti√™n h·ªó tr·ª£']},pro_yearly:{name:'Pro NƒÉm',price:599000,period:'nƒÉm',features:['Kh√¥ng qu·∫£ng c√°o','Hi·ªÉn th·ªã DN trong H·ªó tr·ª£','∆Øu ti√™n h·ªó tr·ª£','Ti·∫øt ki·ªám 133k']}};
const BUSINESS_TYPES=[{id:'tnhh',name:'C√¥ng ty TNHH'},{id:'joint_stock',name:'C√¥ng ty C·ªï ph·∫ßn'},{id:'private',name:'DN t∆∞ nh√¢n'},{id:'household',name:'H·ªô kinh doanh'}];
const INDUSTRIES=[{id:'trade',name:'Th∆∞∆°ng m·∫°i'},{id:'manufacturing',name:'S·∫£n xu·∫•t'},{id:'service',name:'D·ªãch v·ª•'},{id:'construction',name:'X√¢y d·ª±ng'},{id:'it',name:'CNTT'},{id:'legal',name:'Ph√°p l√Ω'},{id:'accounting',name:'K·∫ø to√°n'},{id:'other',name:'Kh√°c'}];
const TAX_PERIODS=[{id:'monthly',name:'K√™ khai theo th√°ng'},{id:'quarterly',name:'K√™ khai theo qu√Ω'}];
const categoryConfig={tax:{label:'Thu·∫ø',color:'bg-red-600',lightColor:'bg-red-50',textColor:'text-red-700',borderColor:'border-red-200'},insurance:{label:'BHXH',color:'bg-blue-600',lightColor:'bg-blue-50',textColor:'text-blue-700',borderColor:'border-blue-200'},report:{label:'B√°o c√°o',color:'bg-emerald-600',lightColor:'bg-emerald-50',textColor:'text-emerald-700',borderColor:'border-emerald-200'},license:{label:'Gi·∫•y ph√©p',color:'bg-amber-600',lightColor:'bg-amber-50',textColor:'text-amber-700',borderColor:'border-amber-200'},news:{label:'Tin t·ª©c',color:'bg-purple-600',lightColor:'bg-purple-50',textColor:'text-purple-700',borderColor:'border-purple-200'}};
const agencyCategories={tax:{label:'Thu·∫ø',color:'bg-red-50 text-red-700 border border-red-200'},court:{label:'T√≤a √°n',color:'bg-purple-50 text-purple-700 border border-purple-200'},insurance:{label:'BHXH',color:'bg-emerald-50 text-emerald-700 border border-emerald-200'},labor:{label:'S·ªü LƒêTBXH',color:'bg-teal-50 text-teal-700 border border-teal-200'},business:{label:'ƒêƒÉng k√Ω KD',color:'bg-indigo-50 text-indigo-700 border border-indigo-200'}};
const monthNames=['Th√°ng 1','Th√°ng 2','Th√°ng 3','Th√°ng 4','Th√°ng 5','Th√°ng 6','Th√°ng 7','Th√°ng 8','Th√°ng 9','Th√°ng 10','Th√°ng 11','Th√°ng 12'];
const dayNames=['CN','T2','T3','T4','T5','T6','T7'];

const Icons={
    Home:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
    Calendar:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
    CalendarPlus:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><line x1="19" x2="19" y1="16" y2="22"/><line x1="16" x2="22" y1="19" y2="19"/></svg>,
    Newspaper:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8M15 18h-5M10 6h8v4h-8V6Z"/></svg>,
    Settings:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
    Headphones:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"/></svg>,
    Check:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><polyline points="20 6 9 17 4 12"/></svg>,
    CheckCircle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
    ChevronLeft:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m15 18-6-6 6-6"/></svg>,
    ChevronRight:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m9 18 6-6-6-6"/></svg>,
    ChevronDown:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m6 9 6 6 6-6"/></svg>,
    ChevronUp:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m18 15-6-6-6 6"/></svg>,
    Clock:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
    X:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M18 6 6 18M6 6l12 12"/></svg>,
    Mail:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>,
    Phone:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
    Building:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"/></svg>,
    FileText:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
    MapPin:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
    Search:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
    Landmark:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/></svg>,
    TrendingUp:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
    Info:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>,
    Shield:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    HelpCircle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"/></svg>,
    Trash:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
    ExternalLink:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>,
    AlertTriangle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
    Plus:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
    User:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    Crown:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
    CreditCard:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>,
    Upload:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
    Image:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
};

const getDeadlineFromEvent=(ev)=>{const now=new Date();const y=now.getFullYear();const m=now.getMonth();let day=ev.dayOfMonth||20;if(ev.frequency==='monthly')return new Date(y,m,day);if(ev.frequency==='quarterly'){const qMonth=Math.floor(m/3)*3+2;return new Date(y,qMonth,day);}if(ev.frequency==='yearly'){const eventMonth=(ev.month||1)-1;return new Date(y,eventMonth,day);}return new Date(y,m,day);};
const getDaysUntil=(date)=>{const d=typeof date==='string'?new Date(date):date;const today=new Date();today.setHours(0,0,0,0);d.setHours(0,0,0,0);return Math.ceil((d-today)/(1000*60*60*24));};
const formatPrice=(price)=>new Intl.NumberFormat('vi-VN').format(price)+'ƒë';

// ============ SPLASH SCREEN ============
const SplashScreen=({onFinish})=>{
    useEffect(()=>{const t=setTimeout(onFinish,3000);return()=>clearTimeout(t);},[]);
    return(
        <div className="h-full bg-gradient-to-br from-navy-600 to-navy-800 flex flex-col items-center justify-center p-8">
            <div className="bg-white p-6 rounded-3xl shadow-2xl mb-8 animate-float"><Logo size={100}/></div>
            <h1 className="text-4xl font-bold text-white mb-3">HTIC Legal</h1>
            <p className="text-white text-center text-lg mb-2 font-semibold">L·ªãch Ph√°p L√Ω Doanh Nghi·ªáp</p>
            <p className="text-sky-200 text-center text-sm font-medium">Qu·∫£n l√Ω deadline thu·∫ø, BHXH, b√°o c√°o</p>
            <div className="mt-12 flex gap-2">{[0,1,2].map(i=><div key={i} className="w-3 h-3 bg-white rounded-full animate-pulse" style={{animationDelay:`${i*.2}s`}}/>)}</div>
            <p className="mt-8 text-sky-300 text-sm font-semibold">by {COMPANY_INFO.name}</p>
        </div>
    );
};

// ============ AD BANNER ============
const AdBanner=({membership})=>{
    if(membership?.plan!=='free')return null;
    return(
        <div className="bg-gradient-to-r from-amber-500 to-orange-500 p-3 mx-5 rounded-xl mb-4 shadow-md">
            <p className="text-white text-sm font-bold text-center">üéÅ N√¢ng c·∫•p Pro ƒë·ªÉ b·ªè qu·∫£ng c√°o v√† hi·ªÉn th·ªã DN</p>
        </div>
    );
};

// ============ EVENT CARD ============
const EventCard=({event,onClick,compact=false})=>{
    const c=categoryConfig[event.category]||categoryConfig.tax;
    const deadline=event.date?new Date(event.date):getDeadlineFromEvent(event);
    const d=getDaysUntil(deadline);
    const isOverdue=d<0&&!event.completed;
    const isUrgent=d>=0&&d<=7&&!event.completed;
    const dateStr=event.date?new Date(event.date).toLocaleDateString('vi-VN'):`Ng√†y ${event.dayOfMonth||20}`;
    if(compact)return(
        <button onClick={onClick} className={`w-full bg-white rounded-xl p-3.5 shadow-sm border flex items-center gap-3 text-left touch-active ${c.borderColor}`}>
            <div className={`w-2 h-12 rounded-full ${c.color} flex-shrink-0`}/>
            <div className="flex-1 min-w-0"><p className="font-semibold text-gray-900 text-sm truncate">{event.title}</p><p className="text-xs text-gray-600 mt-0.5 font-medium">H·∫°n: {dateStr}</p></div>
            {isOverdue?<span className="text-xs font-bold text-white bg-red-600 px-2.5 py-1 rounded-lg shadow-sm">-{Math.abs(d)}d</span>:isUrgent?<span className="text-xs font-bold text-white bg-amber-500 px-2.5 py-1 rounded-lg shadow-sm">{d}d</span>:<span className="text-xs font-bold text-gray-700 bg-gray-100 px-2.5 py-1 rounded-lg">{d}d</span>}
        </button>
    );
    return(
        <button onClick={onClick} className={`w-full bg-white rounded-2xl p-4 shadow-sm border flex items-center gap-4 text-left touch-active ${c.borderColor}`}>
            <div className={`p-3 rounded-xl ${c.lightColor} flex-shrink-0 border ${c.borderColor}`}><div className={`w-5 h-5 ${c.textColor}`}><Icons.FileText/></div></div>
            <div className="flex-1 min-w-0"><p className="font-semibold text-gray-900 truncate text-sm">{event.title}</p><p className="text-xs text-gray-600 mt-0.5 font-medium">{dateStr}</p></div>
            {event.completed?<div className="w-7 h-7 text-emerald-600 flex-shrink-0"><Icons.CheckCircle/></div>:isOverdue?<span className="text-xs font-bold text-white bg-red-600 px-3 py-1.5 rounded-full animate-pulse-custom shadow">Qu√° {Math.abs(d)}d</span>:isUrgent?<span className="text-xs font-bold text-white bg-amber-500 px-3 py-1.5 rounded-full shadow">{d}d</span>:<span className="text-xs font-bold text-navy-700 bg-navy-50 px-3 py-1.5 rounded-full border border-navy-200">{d}d</span>}
        </button>
    );
};

// ============ NEWS CARD (thumbnail nh·ªè) ============
const NewsCard=({news,onClick})=>(
    <button onClick={onClick} className="w-full bg-white rounded-xl p-3.5 shadow-sm border border-gray-200 flex items-center gap-3 text-left touch-active">
        {news.image?<img src={news.image} alt="" className="w-20 h-16 object-cover rounded-lg flex-shrink-0 border border-gray-100"/>:<div className="w-20 h-16 bg-navy-50 rounded-lg flex items-center justify-center flex-shrink-0 border border-navy-100"><div className="w-8 h-8 text-navy-400"><Icons.Newspaper/></div></div>}
        <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2 mb-1">
                <span className="bg-purple-100 text-purple-700 text-xs px-2 py-0.5 rounded-full font-bold">{news.category}</span>
                {news.isHot&&<span className="text-orange-500 text-xs font-bold">üî•</span>}
            </div>
            <p className="font-semibold text-gray-900 text-sm line-clamp-2">{news.title}</p>
            <p className="text-xs text-gray-500 mt-1 font-medium">{news.date}</p>
        </div>
        <div className="w-5 h-5 text-gray-400 flex-shrink-0"><Icons.ChevronRight/></div>
    </button>
);

// ============ EVENT DETAIL MODAL ============
const EventDetailModal=({event,onClose,onToggle,checklistState,onChecklistChange})=>{
    if(!event)return null;
    const c=categoryConfig[event.category]||categoryConfig.tax;
    const deadline=event.date?new Date(event.date):getDeadlineFromEvent(event);
    const d=getDaysUntil(deadline);
    const isOverdue=d<0&&!event.completed;
    const checklist=event.checklist||[];
    const completedSteps=checklistState[event.id]||[];
    const progress=checklist.length>0?Math.round((completedSteps.length/checklist.length)*100):0;
    const toggleStep=(stepId)=>{const current=completedSteps||[];const newState=current.includes(stepId)?current.filter(id=>id!==stepId):[...current,stepId];onChecklistChange(event.id,newState);};
    const dateStr=event.date?new Date(event.date).toLocaleDateString('vi-VN',{weekday:'long',day:'numeric',month:'long',year:'numeric'}):`Ng√†y ${event.dayOfMonth||20} h√†ng ${event.frequency==='monthly'?'th√°ng':event.frequency==='quarterly'?'qu√Ω':'nƒÉm'}`;
    return(
        <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl max-h-[90vh] overflow-auto hide-scrollbar slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="sticky top-0 bg-white px-5 py-4 border-b border-gray-200 flex justify-between items-center z-10"><div className={`px-3 py-1.5 rounded-full ${c.lightColor} ${c.textColor} text-sm font-bold border ${c.borderColor}`}>{c.label}</div><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200"><div className="w-5 h-5 text-gray-700"><Icons.X/></div></button></div>
                <div className="p-5 space-y-5">
                    <h2 className="text-xl font-bold text-gray-900">{event.title}</h2>
                    <div className={`p-4 rounded-2xl border-2 ${event.completed?'bg-emerald-50 border-emerald-300':isOverdue?'bg-red-50 border-red-300':d<=7?'bg-amber-50 border-amber-300':'bg-sky-50 border-sky-300'}`}><div className="flex items-center gap-3"><div className={`w-11 h-11 rounded-full flex items-center justify-center ${event.completed?'bg-emerald-500':isOverdue?'bg-red-500':d<=7?'bg-amber-500':'bg-sky-500'}`}><div className="w-5 h-5 text-white">{event.completed?<Icons.Check/>:<Icons.Clock/>}</div></div><div><p className="text-sm text-gray-700 font-semibold">{dateStr}</p><p className={`font-bold text-lg ${event.completed?'text-emerald-700':isOverdue?'text-red-700':d<=7?'text-amber-700':'text-sky-700'}`}>{event.completed?'ƒê√£ ho√†n th√†nh':isOverdue?`Qu√° h·∫°n ${Math.abs(d)} ng√†y`:d===0?'H√¥m nay l√† h·∫°n ch√≥t!':`C√≤n ${d} ng√†y`}</p></div></div></div>
                    {checklist.length>0&&<div className="bg-gray-50 rounded-2xl p-4 border border-gray-200"><div className="flex items-center justify-between mb-3"><h3 className="font-bold text-gray-900">C√°c b∆∞·ªõc th·ª±c hi·ªán</h3><span className="text-sm font-bold text-gray-700 bg-white px-2 py-1 rounded-lg border">{completedSteps.length}/{checklist.length}</span></div><div className="w-full bg-gray-200 rounded-full h-2.5 mb-4"><div className="bg-emerald-500 h-2.5 rounded-full transition-all" style={{width:`${progress}%`}}/></div><div className="space-y-2">{checklist.map((step,idx)=><div key={step.id} className="flex items-start gap-3 p-2.5 rounded-xl hover:bg-white border border-transparent hover:border-gray-200"><button onClick={()=>toggleStep(step.id)} className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${completedSteps.includes(step.id)?'bg-emerald-500 border-emerald-500':'border-gray-400 hover:border-gray-500'}`}>{completedSteps.includes(step.id)&&<div className="w-4 h-4 text-white"><Icons.Check/></div>}</button><div className="flex-1"><p className={`text-sm font-semibold ${completedSteps.includes(step.id)?'text-gray-400 line-through':'text-gray-800'}`}>{idx+1}. {step.text}</p>{step.link&&<a href={step.link} target="_blank" rel="noopener noreferrer" className="text-xs text-blue-600 flex items-center gap-1 mt-1.5 font-semibold hover:underline"><div className="w-3.5 h-3.5"><Icons.ExternalLink/></div>M·ªü li√™n k·∫øt</a>}</div></div>)}</div></div>}
                    {event.description&&<div><h3 className="font-bold mb-2 text-gray-900">M√¥ t·∫£</h3><p className="text-gray-700 text-sm leading-relaxed font-medium">{event.description}</p></div>}
                    {event.legalReference&&<div><h3 className="font-bold mb-2 text-gray-900">CƒÉn c·ª© ph√°p l√Ω</h3><p className="text-gray-700 text-sm leading-relaxed font-medium">{event.legalReference}</p></div>}
                    {event.penalty&&<div className="bg-red-50 p-4 rounded-xl border-2 border-red-200"><h3 className="font-bold mb-2 text-red-800 flex items-center gap-2"><div className="w-5 h-5"><Icons.AlertTriangle/></div>M·ª©c ph·∫°t</h3><p className="text-red-700 text-sm font-semibold">{event.penalty}</p></div>}
                    {!event.isFromNews&&<button onClick={()=>onToggle(event.id)} className={`w-full py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-sm ${event.completed?'bg-gray-200 text-gray-800 hover:bg-gray-300':'bg-emerald-500 text-white hover:bg-emerald-600'}`}><div className="w-5 h-5">{event.completed?<Icons.X/>:<Icons.Check/>}</div>{event.completed?'B·ªè ƒë√°nh d·∫•u':'ƒê√°nh d·∫•u ho√†n th√†nh'}</button>}
                </div>
            </div>
        </div>
    );
};

// ============ DASHBOARD SCREEN ============
const DashboardScreen=({events,news,onEventClick,onNewsClick,membership,businessProfile,savedEvents})=>{
    const today=new Date();
    const allEvents=[...events.map(e=>({...e,deadline:getDeadlineFromEvent(e),daysUntil:getDaysUntil(getDeadlineFromEvent(e))})),...(savedEvents||[]).map(e=>({...e,deadline:new Date(e.date),daysUntil:getDaysUntil(new Date(e.date))}))];
    const overdue=allEvents.filter(e=>e.daysUntil<0&&!e.completed);
    const upcoming=allEvents.filter(e=>!e.completed).sort((a,b)=>a.daysUntil-b.daysUntil).slice(0,6);
    const latestNews=news.slice(0,5);
    const nearestDeadline=upcoming[0];
    return(
        <div className="h-full bg-slate-100 overflow-auto hide-scrollbar pb-24">
            <div className="bg-gradient-to-br from-navy-600 to-navy-800 pt-14 pb-6 px-5 safe-top">
                <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3"><div className="bg-white p-2 rounded-xl shadow-lg"><Logo size={32}/></div><div><p className="text-white font-bold text-lg">L·ªãch Ph√°p L√Ω</p><p className="text-sky-200 text-xs font-semibold">by HTIC LAW</p></div></div>
                    {(membership?.plan==='pro_monthly'||membership?.plan==='pro_yearly')&&<div className="bg-amber-500 px-3 py-1.5 rounded-full flex items-center gap-1 shadow-lg"><div className="w-4 h-4 text-white"><Icons.Crown/></div><span className="text-white text-xs font-bold">PRO</span></div>}
                </div>
                <p className="text-sky-100 text-sm font-semibold">{today.toLocaleDateString('vi-VN',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</p>
            </div>
            {overdue.length>0&&<div className="px-5 -mt-3 mb-3"><div className="bg-red-600 rounded-2xl p-4 shadow-lg animate-pulse-custom border-2 border-red-400"><div className="flex items-center gap-3"><div className="w-11 h-11 bg-white/20 rounded-full flex items-center justify-center"><div className="w-6 h-6 text-white"><Icons.AlertTriangle/></div></div><div><p className="text-white font-bold text-base">‚ö†Ô∏è {overdue.length} vi·ªác ƒë√£ qu√° h·∫°n!</p><p className="text-red-100 text-sm font-semibold">Vui l√≤ng x·ª≠ l√Ω ngay</p></div></div></div></div>}
            {nearestDeadline&&<div className={`px-5 ${overdue.length===0?'-mt-3':''} mb-4`}><div className={`rounded-2xl p-5 shadow-lg border-2 ${nearestDeadline.daysUntil<0?'bg-red-500 border-red-400':nearestDeadline.daysUntil<=7?'bg-amber-500 border-amber-400':'bg-emerald-500 border-emerald-400'}`}><div className="flex justify-between items-start"><div className="flex-1"><p className="text-white/90 text-sm font-semibold mb-1">Deadline g·∫ßn nh·∫•t</p><p className="text-white font-bold text-lg mb-2 line-clamp-2">{nearestDeadline.title}</p><div className="flex items-center gap-2"><div className="w-5 h-5 text-white/90"><Icons.Clock/></div><p className="text-white font-bold text-2xl">{nearestDeadline.daysUntil<0?`Qu√° h·∫°n ${Math.abs(nearestDeadline.daysUntil)} ng√†y`:nearestDeadline.daysUntil===0?'H√¥m nay!':`C√≤n ${nearestDeadline.daysUntil} ng√†y`}</p></div></div><button onClick={()=>onEventClick(nearestDeadline)} className="bg-white/25 p-3 rounded-full touch-active hover:bg-white/35"><div className="w-6 h-6 text-white"><Icons.ChevronRight/></div></button></div></div></div>}
            <AdBanner membership={membership}/>
            <div className="px-5 py-4">
                <h2 className="text-lg font-bold mb-3 text-gray-900 flex items-center gap-2"><div className="w-6 h-6 text-navy-600"><Icons.Calendar/></div>S·ª± ki·ªán s·∫Øp t·ªõi</h2>
                <div className="space-y-2.5">{upcoming.length===0?<div className="bg-white rounded-xl p-6 text-center border border-gray-200"><p className="text-gray-500 font-medium">Kh√¥ng c√≥ s·ª± ki·ªán n√†o</p></div>:upcoming.map((e,i)=><EventCard key={e.id||i} event={e} onClick={()=>onEventClick(e)} compact/>)}</div>
            </div>
            <div className="px-5 pb-4">
                <h2 className="text-lg font-bold mb-3 text-gray-900 flex items-center gap-2"><div className="w-6 h-6 text-amber-500"><Icons.Newspaper/></div>Tin ph√°p l√Ω m·ªõi</h2>
                <div className="space-y-2.5">{latestNews.length===0?<div className="bg-white rounded-xl p-6 text-center border border-gray-200"><p className="text-gray-500 font-medium">ƒêang t·∫£i...</p></div>:latestNews.map(n=><NewsCard key={n.id} news={n} onClick={()=>onNewsClick(n)}/>)}</div>
            </div>
        </div>
    );
};

// ============ CALENDAR SCREEN (thu g·ªçn khi scroll) ============
const CalendarScreen=({events,onEventClick,savedEvents})=>{
    const today=new Date();
    const[month,setMonth]=useState(today.getMonth());
    const[year,setYear]=useState(today.getFullYear());
    const[sel,setSel]=useState(null);
    const[isCollapsed,setIsCollapsed]=useState(false);
    const scrollRef=useRef(null);
    
    const days=new Date(year,month+1,0).getDate();
    const first=new Date(year,month,1).getDay();
    
    // T√≠nh tu·∫ßn hi·ªán t·∫°i
    const currentWeekStart=useMemo(()=>{
        const d=new Date(year,month,today.getDate());
        const dayOfWeek=d.getDay();
        return today.getDate()-dayOfWeek;
    },[year,month,today]);
    
    // Combine events
    const allEvents=useMemo(()=>{
        const systemEv=events.map(e=>({...e,deadline:getDeadlineFromEvent(e)}));
        const savedEv=(savedEvents||[]).map(e=>({...e,deadline:new Date(e.date),isFromNews:true}));
        return [...systemEv,...savedEv];
    },[events,savedEvents]);
    
    const getEv=(d)=>allEvents.filter(e=>{const dd=new Date(e.deadline);return dd.getDate()===d&&dd.getMonth()===month&&dd.getFullYear()===year;});
    const selEv=sel?getEv(sel):[];
    
    // Scroll handler
    const handleScroll=(e)=>{
        const scrollTop=e.target.scrollTop;
        setIsCollapsed(scrollTop>50);
    };
    
    // Week days for collapsed view
    const weekDays=useMemo(()=>{
        const result=[];
        for(let i=0;i<7;i++){
            const d=currentWeekStart+i;
            if(d>=1&&d<=days)result.push(d);
        }
        return result;
    },[currentWeekStart,days]);

    return(
        <div className="h-full bg-slate-100 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top border-b border-gray-200">
                <div className="flex items-center gap-3">
                    <div className="bg-navy-100 p-2.5 rounded-xl border border-navy-200"><div className="w-6 h-6 text-navy-700"><Icons.Calendar/></div></div>
                    <h1 className="text-2xl font-bold text-gray-900">L·ªãch ph√°p l√Ω</h1>
                </div>
            </div>
            
            {/* Month navigation */}
            <div className="bg-white px-5 py-3 flex justify-between items-center border-b border-gray-200">
                <button onClick={()=>{if(month===0){setMonth(11);setYear(year-1);}else{setMonth(month-1);}setIsCollapsed(false);}} className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 touch-active hover:bg-gray-200"><div className="w-6 h-6 text-gray-700"><Icons.ChevronLeft/></div></button>
                <div className="flex items-center gap-2">
                    <h2 className="text-lg font-bold text-gray-900">{monthNames[month]} {year}</h2>
                    {isCollapsed&&<button onClick={()=>setIsCollapsed(false)} className="text-navy-600 text-sm font-semibold flex items-center gap-1"><div className="w-4 h-4"><Icons.ChevronDown/></div>M·ªü r·ªông</button>}
                </div>
                <button onClick={()=>{if(month===11){setMonth(0);setYear(year+1);}else{setMonth(month+1);}setIsCollapsed(false);}} className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 touch-active hover:bg-gray-200"><div className="w-6 h-6 text-gray-700"><Icons.ChevronRight/></div></button>
            </div>
            
            {/* Calendar grid */}
            <div className={`bg-white px-3 transition-all duration-300 ${isCollapsed?'py-2':'py-3'}`}>
                <div className="grid grid-cols-7 mb-2">
                    {dayNames.map(d=><div key={d} className="text-center text-xs font-bold text-gray-500 py-1">{d}</div>)}
                </div>
                
                {isCollapsed?(
                    // Collapsed: ch·ªâ hi·ªán 1 tu·∫ßn
                    <div className="grid grid-cols-7 gap-1">
                        {Array.from({length:7}).map((_,i)=>{
                            const dayNum=weekDays[i];
                            if(!dayNum)return <div key={i}/>;
                            const ev=getEv(dayNum);
                            const isT=dayNum===today.getDate()&&month===today.getMonth()&&year===today.getFullYear();
                            const isS=dayNum===sel;
                            return(
                                <button key={i} onClick={()=>setSel(dayNum)} className={`aspect-square flex flex-col items-center justify-center rounded-xl transition-all ${isS?'bg-navy-600 shadow-lg':isT?'bg-navy-100 border-2 border-navy-300':'hover:bg-gray-100'}`}>
                                    <span className={`text-sm font-bold ${isS?'text-white':isT?'text-navy-700':'text-gray-800'}`}>{dayNum}</span>
                                    {ev.length>0&&<div className="flex gap-0.5 mt-0.5">{ev.slice(0,3).map((e,idx)=><div key={idx} className={`w-1.5 h-1.5 rounded-full ${isS?'bg-white':(categoryConfig[e.category]?.color||'bg-purple-500')}`}/>)}</div>}
                                </button>
                            );
                        })}
                    </div>
                ):(
                    // Full month view
                    <div className="grid grid-cols-7 gap-1">
                        {Array.from({length:first}).map((_,i)=><div key={`e-${i}`}/>)}
                        {Array.from({length:days}).map((_,i)=>{
                            const day=i+1;
                            const ev=getEv(day);
                            const isT=day===today.getDate()&&month===today.getMonth()&&year===today.getFullYear();
                            const isS=day===sel;
                            return(
                                <button key={day} onClick={()=>setSel(day)} className={`aspect-square flex flex-col items-center justify-center rounded-xl transition-all ${isS?'bg-navy-600 shadow-lg':isT?'bg-navy-100 border-2 border-navy-300':'hover:bg-gray-100'}`}>
                                    <span className={`text-sm font-bold ${isS?'text-white':isT?'text-navy-700':'text-gray-800'}`}>{day}</span>
                                    {ev.length>0&&<div className="flex gap-0.5 mt-1">{ev.slice(0,3).map((e,idx)=><div key={idx} className={`w-1.5 h-1.5 rounded-full ${isS?'bg-white':(categoryConfig[e.category]?.color||'bg-purple-500')}`}/>)}</div>}
                                </button>
                            );
                        })}
                    </div>
                )}
            </div>
            
            {/* Legend */}
            <div className="bg-white px-5 py-2.5 flex flex-wrap gap-3 border-t border-b border-gray-200 text-xs">
                {Object.entries(categoryConfig).map(([k,c])=><div key={k} className="flex items-center gap-1.5"><div className={`w-2.5 h-2.5 rounded-full ${c.color}`}/><span className="text-gray-700 font-semibold">{c.label}</span></div>)}
            </div>
            
            {/* Events list */}
            <div ref={scrollRef} onScroll={handleScroll} className="flex-1 bg-slate-100 px-5 py-4 overflow-auto hide-scrollbar">
                {sel?(
                    <>
                        <h3 className="font-bold mb-3 text-gray-900">Ng√†y {sel}/{month+1}/{year}</h3>
                        {selEv.length>0?<div className="space-y-2">{selEv.map((e,idx)=><EventCard key={e.id||idx} event={e} onClick={()=>onEventClick(e)} compact/>)}</div>:<div className="bg-white rounded-xl p-6 text-center border border-gray-200"><p className="text-gray-500 font-medium">Kh√¥ng c√≥ s·ª± ki·ªán</p></div>}
                    </>
                ):(
                    <>
                        <h3 className="font-bold mb-3 text-gray-900">T·∫•t c·∫£ s·ª± ki·ªán th√°ng {month+1}</h3>
                        {allEvents.filter(e=>{const dd=new Date(e.deadline);return dd.getMonth()===month&&dd.getFullYear()===year;}).sort((a,b)=>new Date(a.deadline)-new Date(b.deadline)).length>0?(
                            <div className="space-y-2">
                                {allEvents.filter(e=>{const dd=new Date(e.deadline);return dd.getMonth()===month&&dd.getFullYear()===year;}).sort((a,b)=>new Date(a.deadline)-new Date(b.deadline)).map((e,idx)=><EventCard key={e.id||idx} event={e} onClick={()=>onEventClick(e)} compact/>)}
                            </div>
                        ):<div className="bg-white rounded-xl p-6 text-center border border-gray-200"><p className="text-gray-500 font-medium">Kh√¥ng c√≥ s·ª± ki·ªán trong th√°ng</p></div>}
                    </>
                )}
            </div>
        </div>
    );
};

// ============ NEWS DETAIL MODAL ============
const NewsDetailModal=({news,onClose,onAddToCalendar})=>{
    const[showDatePicker,setShowDatePicker]=useState(false);
    const[selectedDate,setSelectedDate]=useState(new Date().toISOString().split('T')[0]);
    
    const handleAddToCalendar=()=>{
        onAddToCalendar({
            id:'news-'+news.id+'-'+Date.now(),
            title:news.title,
            category:'news',
            date:selectedDate,
            description:news.summary,
            isFromNews:true
        });
        setShowDatePicker(false);
        alert('‚úÖ ƒê√£ th√™m v√†o l·ªãch!');
    };
    
    return(
        <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl max-h-[90vh] overflow-auto hide-scrollbar slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="sticky top-0 bg-white px-5 py-4 border-b border-gray-200 flex justify-between items-center z-10">
                    <span className="bg-purple-100 text-purple-700 px-3 py-1.5 rounded-full text-sm font-bold border border-purple-200">{news.category}</span>
                    <button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200"><div className="w-5 h-5 text-gray-700"><Icons.X/></div></button>
                </div>
                
                {/* ·∫¢nh to */}
                {news.image&&<img src={news.image} alt="" className="w-full h-56 object-cover"/>}
                
                <div className="p-5 space-y-4">
                    <div className="flex items-center gap-2">
                        {news.isHot&&<span className="bg-red-100 text-red-700 text-sm px-3 py-1 rounded-full font-bold border border-red-200">üî• Tin n·ªïi b·∫≠t</span>}
                        <span className="text-gray-500 text-sm font-medium">{news.date}</span>
                    </div>
                    
                    <h2 className="text-xl font-bold text-gray-900">{news.title}</h2>
                    <p className="text-gray-700 leading-relaxed font-medium">{news.summary}</p>
                    {news.content&&<p className="text-gray-700 leading-relaxed whitespace-pre-line">{news.content}</p>}
                    
                    {/* Add to calendar section */}
                    <div className="bg-purple-50 rounded-2xl p-4 border-2 border-purple-200">
                        <p className="text-purple-800 font-bold mb-3 flex items-center gap-2"><div className="w-5 h-5"><Icons.CalendarPlus/></div>Th√™m v√†o l·ªãch ƒë·ªÉ nh·∫Øc nh·ªü</p>
                        
                        {showDatePicker?(
                            <div className="space-y-3">
                                <div>
                                    <label className="text-sm font-semibold text-gray-700 mb-2 block">Ch·ªçn ng√†y nh·∫Øc nh·ªü:</label>
                                    <input type="date" value={selectedDate} onChange={e=>setSelectedDate(e.target.value)} className="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-gray-900 font-medium"/>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={handleAddToCalendar} className="flex-1 bg-purple-600 text-white py-3 rounded-xl font-bold hover:bg-purple-700 flex items-center justify-center gap-2"><div className="w-5 h-5"><Icons.Check/></div>X√°c nh·∫≠n</button>
                                    <button onClick={()=>setShowDatePicker(false)} className="px-4 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-300">H·ªßy</button>
                                </div>
                            </div>
                        ):(
                            <button onClick={()=>setShowDatePicker(true)} className="w-full bg-purple-600 text-white py-3 rounded-xl font-bold hover:bg-purple-700 flex items-center justify-center gap-2"><div className="w-5 h-5"><Icons.CalendarPlus/></div>Th√™m v√†o l·ªãch</button>
                        )}
                    </div>
                </div>
            </div>
        </div>
    );
};

// ============ NEWS SCREEN ============
const NewsScreen=({newsData,onAddToCalendar})=>{
    const[sel,setSel]=useState(null);
    return(
        <div className="h-full bg-slate-100 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top border-b border-gray-200">
                <div className="flex items-center gap-3">
                    <div className="bg-navy-100 p-2.5 rounded-xl border border-navy-200"><div className="w-6 h-6 text-navy-700"><Icons.Newspaper/></div></div>
                    <h1 className="text-2xl font-bold text-gray-900">Tin t·ª©c ph√°p lu·∫≠t</h1>
                </div>
            </div>
            <div className="flex-1 px-5 py-5 overflow-auto hide-scrollbar">
                <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-gray-900"><div className="w-6 h-6 text-amber-500"><Icons.TrendingUp/></div>Tin m·ªõi nh·∫•t</h2>
                {newsData.length===0?<div className="bg-white rounded-xl p-8 text-center border border-gray-200"><p className="text-gray-500 font-medium">ƒêang t·∫£i...</p></div>:<div className="space-y-3">{newsData.map(n=><NewsCard key={n.id} news={n} onClick={()=>setSel(n)}/>)}</div>}
            </div>
            {sel&&<NewsDetailModal news={sel} onClose={()=>setSel(null)} onAddToCalendar={onAddToCalendar}/>}
        </div>
    );
};

// ============ SUPPORT SCREEN ============
const SupportScreen=({provinces,agencies,businesses,membership})=>{
    const[tab,setTab]=useState('agencies');
    const[province,setProvince]=useState(provinces[0]?.id||'');
    const[searchQuery,setSearchQuery]=useState('');
    const filteredAgencies=agencies.filter(a=>a.provinceId===province&&a.name.toLowerCase().includes(searchQuery.toLowerCase()));
    const proBiz=(businesses||[]).filter(b=>b.isPro);
    return(
        <div className="h-full bg-slate-100 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top border-b border-gray-200"><div className="flex items-center gap-3"><div className="bg-purple-100 p-2.5 rounded-xl border border-purple-200"><div className="w-6 h-6 text-purple-700"><Icons.Headphones/></div></div><h1 className="text-2xl font-bold text-gray-900">H·ªó tr·ª£</h1></div></div>
            <div className="bg-white px-5 py-3 flex gap-2 border-b border-gray-200">
                <button onClick={()=>setTab('agencies')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${tab==='agencies'?'bg-navy-600 text-white shadow':'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}><div className="flex items-center justify-center gap-2"><div className="w-4 h-4"><Icons.Landmark/></div>C∆° quan NN</div></button>
                <button onClick={()=>setTab('businesses')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${tab==='businesses'?'bg-navy-600 text-white shadow':'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}><div className="flex items-center justify-center gap-2"><div className="w-4 h-4"><Icons.Building/></div>Doanh nghi·ªáp</div></button>
            </div>
            <div className="flex-1 overflow-auto hide-scrollbar">
                {tab==='agencies'&&<div className="px-5 py-4">
                    <div className="mb-4"><label className="text-sm font-bold text-gray-800 mb-2 block">Ch·ªçn t·ªânh/th√†nh ph·ªë</label><div className="relative"><select value={province} onChange={e=>setProvince(e.target.value)} className="w-full p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-navy-500 focus:outline-none appearance-none pr-10 text-gray-900 font-semibold">{provinces.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}</select><div className="w-5 h-5 text-gray-500 absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none"><Icons.ChevronDown/></div></div></div>
                    <div className="mb-4 relative"><div className="w-5 h-5 text-gray-500 absolute left-4 top-1/2 -translate-y-1/2"><Icons.Search/></div><input type="text" value={searchQuery} onChange={e=>setSearchQuery(e.target.value)} placeholder="T√¨m c∆° quan..." className="w-full pl-12 pr-4 py-3.5 rounded-xl border-2 border-gray-200 bg-white focus:border-navy-500 focus:outline-none text-gray-900 font-medium"/></div>
                    <div className="space-y-3">{filteredAgencies.length===0?<div className="bg-white rounded-xl p-8 text-center border border-gray-200"><p className="text-gray-500 font-medium">Kh√¥ng t√¨m th·∫•y</p></div>:filteredAgencies.map(agency=>{const catInfo=agencyCategories[agency.category]||{label:agency.category,color:'bg-gray-100 text-gray-700 border border-gray-200'};return<div key={agency.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-200"><div className="flex items-start gap-3"><div className={`p-2.5 rounded-xl ${catInfo.color} flex-shrink-0`}><div className="w-5 h-5"><Icons.Landmark/></div></div><div className="flex-1 min-w-0"><h3 className="font-bold text-gray-900 mb-1">{agency.name}</h3><div className="flex items-center gap-1.5 text-gray-600 text-sm"><div className="w-4 h-4 flex-shrink-0"><Icons.MapPin/></div><span className="truncate font-medium">{agency.address}</span></div><div className="flex items-center gap-1.5 text-gray-700 text-sm mt-1"><div className="w-4 h-4 flex-shrink-0"><Icons.Phone/></div><span className="font-bold">{agency.phone}</span></div></div></div></div>;})}</div>
                </div>}
                {tab==='businesses'&&<div className="px-5 py-4">
                    <div className="bg-amber-50 border-2 border-amber-300 rounded-xl p-4 mb-4"><p className="text-amber-800 text-sm font-bold">üíº C√°c doanh nghi·ªáp Pro ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y</p></div>
                    {proBiz.length===0?<div className="bg-white rounded-xl p-10 text-center border border-gray-200"><div className="w-16 h-16 text-gray-300 mx-auto mb-4"><Icons.Building/></div><p className="text-gray-500 font-semibold">Ch∆∞a c√≥ doanh nghi·ªáp Pro n√†o</p></div>:<div className="space-y-3">{proBiz.map(biz=><div key={biz.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-200"><div className="flex items-start gap-3">{biz.logo?<img src={biz.logo} alt="" className="w-14 h-14 rounded-xl object-cover border border-gray-200"/>:<div className="w-14 h-14 bg-navy-50 rounded-xl flex items-center justify-center border border-navy-100"><div className="w-8 h-8 text-navy-500"><Icons.Building/></div></div>}<div className="flex-1 min-w-0"><div className="flex items-center gap-2"><h3 className="font-bold text-gray-900">{biz.name}</h3><div className="bg-amber-500 px-1.5 py-0.5 rounded text-white text-xs font-bold shadow-sm">PRO</div></div><p className="text-sm text-gray-600 font-semibold">{INDUSTRIES.find(i=>i.id===biz.industry)?.name}</p>{biz.phone&&<p className="text-sm text-gray-700 mt-1 font-medium">üìû {biz.phone}</p>}{biz.address&&<p className="text-sm text-gray-600 font-medium">üìç {biz.address}</p>}</div></div></div>)}</div>}
                </div>}
            </div>
        </div>
    );
};

// ============ MEMBERSHIP MODAL ============
const MembershipModal=({onClose,onSelectPlan,currentPlan})=>(
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50 fade-in" onClick={onClose}>
        <div className="bg-white w-full max-w-lg rounded-t-3xl max-h-[90vh] overflow-auto hide-scrollbar slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
            <div className="sticky top-0 bg-white px-5 py-4 border-b border-gray-200 flex justify-between items-center z-10"><h2 className="text-xl font-bold text-gray-900">N√¢ng c·∫•p t√†i kho·∫£n</h2><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200"><div className="w-5 h-5 text-gray-700"><Icons.X/></div></button></div>
            <div className="p-5 space-y-4">
                <div className={`border-2 rounded-2xl p-5 ${currentPlan==='free'?'border-navy-500 bg-navy-50':'border-gray-200'}`}>
                    <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-900">Mi·ªÖn ph√≠</h3>{currentPlan==='free'&&<span className="bg-navy-600 text-white text-xs px-2.5 py-1 rounded-full font-bold">Hi·ªán t·∫°i</span>}</div>
                    <p className="text-3xl font-bold text-gray-900 mb-3">0ƒë</p>
                    <ul className="space-y-2">{MEMBERSHIP_PLANS.free.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-700 text-sm font-semibold"><div className="w-5 h-5 text-emerald-600"><Icons.Check/></div>{f}</li>)}</ul>
                </div>
                <div className={`border-2 rounded-2xl p-5 relative overflow-hidden ${currentPlan==='pro_monthly'?'border-amber-500 bg-amber-50':'border-gray-200'}`}>
                    <div className="absolute top-0 right-0 bg-amber-500 text-white text-xs px-3 py-1 rounded-bl-xl font-bold">PH·ªî BI·∫æN</div>
                    <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-900">Pro Th√°ng</h3>{currentPlan==='pro_monthly'&&<span className="bg-amber-500 text-white text-xs px-2.5 py-1 rounded-full font-bold">Hi·ªán t·∫°i</span>}</div>
                    <p className="text-3xl font-bold text-gray-900 mb-1">{formatPrice(61000)}<span className="text-lg font-normal text-gray-600">/th√°ng</span></p>
                    <ul className="space-y-2 mt-3">{MEMBERSHIP_PLANS.pro_monthly.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-700 text-sm font-semibold"><div className="w-5 h-5 text-amber-500"><Icons.Check/></div>{f}</li>)}</ul>
                    {currentPlan!=='pro_monthly'&&<button onClick={()=>onSelectPlan('pro_monthly')} className="w-full mt-4 py-3 bg-amber-500 text-white rounded-xl font-bold shadow-md hover:bg-amber-600">Ch·ªçn g√≥i n√†y</button>}
                </div>
                <div className={`border-2 rounded-2xl p-5 ${currentPlan==='pro_yearly'?'border-emerald-500 bg-emerald-50':'border-gray-200'}`}>
                    <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-900">Pro NƒÉm</h3>{currentPlan==='pro_yearly'&&<span className="bg-emerald-600 text-white text-xs px-2.5 py-1 rounded-full font-bold">Hi·ªán t·∫°i</span>}</div>
                    <p className="text-3xl font-bold text-gray-900 mb-1">{formatPrice(599000)}<span className="text-lg font-normal text-gray-600">/nƒÉm</span></p>
                    <p className="text-emerald-700 text-sm font-bold mb-3">üéÅ Ti·∫øt ki·ªám 133.000ƒë</p>
                    <ul className="space-y-2">{MEMBERSHIP_PLANS.pro_yearly.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-700 text-sm font-semibold"><div className="w-5 h-5 text-emerald-600"><Icons.Check/></div>{f}</li>)}</ul>
                    {currentPlan!=='pro_yearly'&&<button onClick={()=>onSelectPlan('pro_yearly')} className="w-full mt-4 py-3 bg-emerald-600 text-white rounded-xl font-bold shadow-md hover:bg-emerald-700">Ti·∫øt ki·ªám nh·∫•t!</button>}
                </div>
            </div>
        </div>
    </div>
);

// ============ PAYMENT MODAL ============
const PaymentModal=({plan,onClose,onSuccess})=>{
    const[method,setMethod]=useState('');
    const price=plan==='pro_monthly'?61000:599000;
    const period=plan==='pro_monthly'?'th√°ng':'nƒÉm';
    const handlePay=()=>{alert(`Chuy·ªÉn h∆∞·ªõng ƒë·∫øn ${method}...\nS·ªë ti·ªÅn: ${formatPrice(price)}`);onSuccess(plan);};
    return(
        <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl p-5 slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4"><h2 className="text-xl font-bold text-gray-900">Thanh to√°n</h2><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100"><div className="w-5 h-5 text-gray-700"><Icons.X/></div></button></div>
                <div className="bg-navy-50 rounded-xl p-4 mb-4 border-2 border-navy-200"><p className="text-navy-700 font-bold">G√≥i Pro {period==='th√°ng'?'Th√°ng':'NƒÉm'}</p><p className="text-2xl font-bold text-navy-900">{formatPrice(price)}/{period}</p></div>
                <p className="text-sm font-bold text-gray-800 mb-3">Ch·ªçn ph∆∞∆°ng th·ª©c:</p>
                <div className="space-y-2 mb-4">
                    <button onClick={()=>setMethod('vnpay')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='vnpay'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">VNPay</div><div className="text-left"><p className="font-bold text-gray-900">VNPay</p><p className="text-xs text-gray-600">Th·∫ª ATM, Visa, MasterCard</p></div></button>
                    <button onClick={()=>setMethod('momo')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='momo'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">MoMo</div><div className="text-left"><p className="font-bold text-gray-900">V√≠ MoMo</p><p className="text-xs text-gray-600">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠</p></div></button>
                    <button onClick={()=>setMethod('bank')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='bank'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center"><div className="w-6 h-6 text-white"><Icons.CreditCard/></div></div><div className="text-left"><p className="font-bold text-gray-900">Chuy·ªÉn kho·∫£n</p><p className="text-xs text-gray-600">Ng√¢n h√†ng n·ªôi ƒë·ªãa</p></div></button>
                </div>
                <button onClick={handlePay} disabled={!method} className={`w-full py-4 rounded-2xl font-bold text-white ${method?'bg-navy-600':'bg-gray-300'}`}>Thanh to√°n {formatPrice(price)}</button>
            </div>
        </div>
    );
};

// ============ SETTINGS SCREEN ============
const SettingsScreen=({onReset,businessProfile,onUpdateProfile,membership,onUpgradeMembership})=>{
    const[showProfileForm,setShowProfileForm]=useState(false);
    const[profile,setProfile]=useState(businessProfile||{});
    const[showMembership,setShowMembership]=useState(false);
    const[selectedPlan,setSelectedPlan]=useState(null);
    const saveProfile=()=>{onUpdateProfile(profile);setShowProfileForm(false);};
    const handleLogoUpload=(e)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onloadend=()=>{setProfile({...profile,logo:reader.result});};reader.readAsDataURL(file);}};
    const handleSelectPlan=(plan)=>{setShowMembership(false);setSelectedPlan(plan);};
    const handlePaymentSuccess=(plan)=>{onUpgradeMembership(plan);setSelectedPlan(null);};

    if(showProfileForm)return(
        <div className="h-full bg-slate-100 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top border-b border-gray-200"><div className="flex items-center gap-3"><button onClick={()=>setShowProfileForm(false)} className="touch-active"><div className="w-7 h-7 text-gray-700"><Icons.ChevronLeft/></div></button><h1 className="text-xl font-bold text-gray-900">H·ªì s∆° doanh nghi·ªáp</h1></div></div>
            <div className="flex-1 px-5 py-5 overflow-auto hide-scrollbar">
                <div className="flex flex-col items-center mb-6">
                    <div className="relative">
                        {profile.logo?<img src={profile.logo} alt="Logo" className="w-24 h-24 rounded-2xl object-cover border-2 border-gray-300 shadow"/>:<div className="w-24 h-24 bg-navy-50 rounded-2xl flex items-center justify-center border-2 border-navy-200"><div className="w-12 h-12 text-navy-400"><Icons.Building/></div></div>}
                        <label className="absolute -bottom-2 -right-2 bg-navy-600 p-2.5 rounded-full cursor-pointer shadow-lg hover:bg-navy-700"><div className="w-5 h-5 text-white"><Icons.Upload/></div><input type="file" accept="image/*" onChange={handleLogoUpload} className="hidden"/></label>
                    </div>
                    <p className="text-sm text-gray-600 mt-3 font-semibold">Nh·∫•n ƒë·ªÉ upload logo</p>
                </div>
                <div className="space-y-4">
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">T√™n c√¥ng ty *</label><input type="text" value={profile.companyName||''} onChange={e=>setProfile({...profile,companyName:e.target.value})} placeholder="C√¥ng ty TNHH ABC" className="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-navy-500 focus:outline-none text-gray-900 font-medium"/></div>
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">M√£ s·ªë thu·∫ø</label><input type="text" value={profile.taxCode||''} onChange={e=>setProfile({...profile,taxCode:e.target.value})} placeholder="0123456789" className="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-navy-500 focus:outline-none text-gray-900 font-medium"/></div>
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">S·ªë ƒëi·ªán tho·∫°i</label><input type="tel" value={profile.phone||''} onChange={e=>setProfile({...profile,phone:e.target.value})} placeholder="0912 345 678" className="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-navy-500 focus:outline-none text-gray-900 font-medium"/></div>
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">ƒê·ªãa ch·ªâ</label><input type="text" value={profile.address||''} onChange={e=>setProfile({...profile,address:e.target.value})} placeholder="123 ƒê∆∞·ªùng ABC" className="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-navy-500 focus:outline-none text-gray-900 font-medium"/></div>
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">Lo·∫°i h√¨nh</label><select value={profile.businessType||''} onChange={e=>setProfile({...profile,businessType:e.target.value})} className="w-full p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-navy-500 focus:outline-none text-gray-900 font-medium"><option value="">-- Ch·ªçn --</option>{BUSINESS_TYPES.map(t=><option key={t.id} value={t.id}>{t.name}</option>)}</select></div>
                    <div><label className="text-sm font-bold text-gray-800 mb-2 block">Ng√†nh ngh·ªÅ</label><select value={profile.industry||''} onChange={e=>setProfile({...profile,industry:e.target.value})} className="w-full p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-navy-500 focus:outline-none text-gray-900 font-medium"><option value="">-- Ch·ªçn --</option>{INDUSTRIES.map(i=><option key={i.id} value={i.id}>{i.name}</option>)}</select></div>
                </div>
            </div>
            <div className="p-5 bg-white border-t border-gray-200"><button onClick={saveProfile} className="w-full py-4 rounded-2xl bg-navy-600 text-white font-bold shadow-md hover:bg-navy-700">L∆∞u th√¥ng tin</button></div>
        </div>
    );

    return(
        <div className="h-full bg-slate-100 overflow-auto hide-scrollbar pb-24">
            <div className="bg-gradient-to-br from-navy-600 to-navy-800 pt-14 pb-8 px-5 safe-top">
                <h1 className="text-2xl font-bold text-white mb-5">C√†i ƒë·∫∑t</h1>
                <div className="bg-white/15 rounded-2xl p-5 border border-white/20">
                    <div className="flex items-center gap-4">
                        {businessProfile?.logo?<img src={businessProfile.logo} alt="" className="w-14 h-14 rounded-xl object-cover border-2 border-white/30"/>:<div className="bg-white p-2.5 rounded-xl shadow-lg"><Logo size={36}/></div>}
                        <div className="flex-1 min-w-0"><p className="text-white font-bold text-lg truncate">{businessProfile?.companyName||'Doanh nghi·ªáp'}</p><p className="text-sky-200 truncate font-semibold">{businessProfile?.taxCode?`MST: ${businessProfile.taxCode}`:'Ch∆∞a thi·∫øt l·∫≠p'}</p></div>
                        {(membership?.plan==='pro_monthly'||membership?.plan==='pro_yearly')&&<div className="bg-amber-500 px-2.5 py-1 rounded-full flex items-center gap-1 shadow-lg"><div className="w-4 h-4 text-white"><Icons.Crown/></div><span className="text-white text-xs font-bold">PRO</span></div>}
                    </div>
                </div>
            </div>
            <div className="px-5 py-5">
                <div className="bg-white rounded-2xl p-5 shadow-sm mb-5 border border-gray-200">
                    <div className="flex items-center justify-between mb-4"><h3 className="font-bold text-gray-900 flex items-center gap-2"><div className="w-5 h-5 text-navy-600"><Icons.Building/></div>H·ªì s∆° doanh nghi·ªáp</h3><button onClick={()=>setShowProfileForm(true)} className="text-navy-600 text-sm font-bold hover:underline">Ch·ªânh s·ª≠a</button></div>
                    {businessProfile?.companyName?<div className="space-y-2 text-sm"><p><span className="text-gray-500">T√™n:</span> <span className="text-gray-900 font-semibold">{businessProfile.companyName}</span></p>{businessProfile.taxCode&&<p><span className="text-gray-500">MST:</span> <span className="text-gray-900 font-semibold">{businessProfile.taxCode}</span></p>}{businessProfile.businessType&&<p><span className="text-gray-500">Lo·∫°i h√¨nh:</span> <span className="text-gray-900 font-semibold">{BUSINESS_TYPES.find(t=>t.id===businessProfile.businessType)?.name}</span></p>}</div>:<p className="text-gray-500 text-sm font-semibold">Ch∆∞a thi·∫øt l·∫≠p h·ªì s∆°.</p>}
                </div>
                <div className="bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-5 shadow-lg mb-5 border border-amber-400">
                    <div className="flex items-center justify-between"><div><h3 className="font-bold text-white flex items-center gap-2"><div className="w-5 h-5"><Icons.Crown/></div>G√≥i th√†nh vi√™n</h3><p className="text-amber-100 text-sm mt-1 font-semibold">{membership?.plan==='free'?'Mi·ªÖn ph√≠ (c√≥ qu·∫£ng c√°o)':membership?.plan==='pro_monthly'?'Pro Th√°ng':'Pro NƒÉm'}</p></div><button onClick={()=>setShowMembership(true)} className="bg-white text-amber-600 px-4 py-2 rounded-xl font-bold text-sm shadow">{membership?.plan==='free'?'N√¢ng c·∫•p':'Qu·∫£n l√Ω'}</button></div>
                </div>
                <div className="bg-white rounded-2xl px-5 shadow-sm mb-5 border border-gray-200">
                    <h3 className="font-bold pt-5 pb-3 text-gray-900">V·ªÅ ·ª©ng d·ª•ng</h3>
                    <div className="py-4 border-b border-gray-100 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.Info/></div><span className="flex-1 text-gray-800 font-semibold">Phi√™n b·∫£n</span><span className="text-gray-600 font-bold">8.0.0</span></div>
                    <div className="py-4 border-b border-gray-100 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.Shield/></div><span className="flex-1 text-gray-800 font-semibold">Ch√≠nh s√°ch b·∫£o m·∫≠t</span><div className="w-5 h-5 text-gray-400"><Icons.ChevronRight/></div></div>
                    <div className="py-4 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.HelpCircle/></div><span className="flex-1 text-gray-800 font-semibold">Li√™n h·ªá h·ªó tr·ª£</span><div className="w-5 h-5 text-gray-400"><Icons.ChevronRight/></div></div>
                </div>
                <div className="bg-white rounded-2xl p-5 shadow-sm mb-5 border border-gray-200">
                    <h3 className="font-bold mb-4 text-gray-900">Nh√† ph√°t h√†nh</h3>
                    <div className="flex items-center gap-4"><div className="bg-navy-50 p-3 rounded-xl border border-navy-100"><Logo size={28}/></div><div><p className="font-bold text-gray-900">{COMPANY_INFO.name}</p><p className="text-sm text-gray-600 font-medium">{COMPANY_INFO.website}</p></div></div>
                    <div className="mt-4 pt-4 border-t border-gray-100 space-y-3"><div className="flex items-center gap-3 text-gray-700"><div className="w-5 h-5"><Icons.Phone/></div><span className="font-semibold">{COMPANY_INFO.phone}</span></div><div className="flex items-center gap-3 text-gray-700"><div className="w-5 h-5"><Icons.Mail/></div><span className="font-semibold">{COMPANY_INFO.email}</span></div></div>
                </div>
                <div className="bg-white rounded-2xl px-5 shadow-sm border border-gray-200"><button onClick={onReset} className="w-full py-4 flex items-center gap-4 touch-active"><div className="w-5 h-5 text-red-500"><Icons.Trash/></div><span className="text-red-600 font-bold">ƒê·∫∑t l·∫°i d·ªØ li·ªáu</span></button></div>
            </div>
            {showMembership&&<MembershipModal onClose={()=>setShowMembership(false)} onSelectPlan={handleSelectPlan} currentPlan={membership?.plan}/>}
            {selectedPlan&&<PaymentModal plan={selectedPlan} onClose={()=>setSelectedPlan(null)} onSuccess={handlePaymentSuccess}/>}
        </div>
    );
};

// ============ TAB BAR ============
const TabBar=({activeTab,onTabChange})=>{
    const tabs=[{id:'home',I:Icons.Home,l:'Trang ch·ªß'},{id:'calendar',I:Icons.Calendar,l:'L·ªãch'},{id:'news',I:Icons.Newspaper,l:'Tin t·ª©c'},{id:'support',I:Icons.Headphones,l:'H·ªó tr·ª£'},{id:'settings',I:Icons.Settings,l:'C√†i ƒë·∫∑t'}];
    return<div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 flex safe-bottom z-40 max-w-lg mx-auto shadow-2xl">{tabs.map(t=><button key={t.id} onClick={()=>onTabChange(t.id)} className={`flex-1 py-3 flex flex-col items-center gap-1 transition-all ${activeTab===t.id?'text-navy-600':'text-gray-400'}`}><div className="w-6 h-6"><t.I/></div><span className={`text-xs ${activeTab===t.id?'font-bold':'font-semibold'}`}>{t.l}</span></button>)}</div>;
};

// ============ MAIN APP ============
function App(){
    const[screen,setScreen]=useState('splash');
    const[tab,setTab]=useState('home');
    const[selEvent,setSelEvent]=useState(null);
    const[events,setEvents]=useState([]);
    const[newsData,setNewsData]=useState([]);
    const[provinces,setProvinces]=useState([]);
    const[agencies,setAgencies]=useState([]);
    const[businesses,setBusinesses]=useState([]);
    const[checklistState,setChecklistState]=useState(()=>{const s=localStorage.getItem('checklistState');return s?JSON.parse(s):{};});
    const[businessProfile,setBusinessProfile]=useState(()=>{const s=localStorage.getItem('businessProfile');return s?JSON.parse(s):{};});
    const[membership,setMembership]=useState(()=>{const s=localStorage.getItem('membership');return s?JSON.parse(s):{plan:'free'};});
    const[savedEvents,setSavedEvents]=useState(()=>{const s=localStorage.getItem('savedEvents');return s?JSON.parse(s):[];});

    useEffect(()=>{localStorage.setItem('checklistState',JSON.stringify(checklistState));},[checklistState]);
    useEffect(()=>{localStorage.setItem('businessProfile',JSON.stringify(businessProfile));},[businessProfile]);
    useEffect(()=>{localStorage.setItem('membership',JSON.stringify(membership));},[membership]);
    useEffect(()=>{localStorage.setItem('savedEvents',JSON.stringify(savedEvents));},[savedEvents]);

    useEffect(()=>{
        const fetchData=async()=>{
            try{
                const[evRes,newsRes,provRes,agRes,bizRes]=await Promise.all([fetch(API+'/events'),fetch(API+'/news'),fetch(API+'/provinces'),fetch(API+'/agencies'),fetch(API+'/businesses').catch(()=>({json:()=>({success:true,data:[]})}))]);
                const evData=await evRes.json();const newsDataJson=await newsRes.json();const provData=await provRes.json();const agData=await agRes.json();const bizData=await bizRes.json();
                if(evData.success)setEvents(evData.data.map(e=>({...e,completed:false})));
                if(newsDataJson.success)setNewsData(newsDataJson.data);
                if(provData.success)setProvinces(provData.data);
                if(agData.success)setAgencies(agData.data);
                if(bizData.success)setBusinesses(bizData.data);
            }catch(err){console.error('Error:',err);}
        };
        fetchData();
    },[]);

    const toggleEvent=id=>{setEvents(events.map(e=>e.id===id?{...e,completed:!e.completed}:e));setSelEvent(p=>p&&p.id===id?{...p,completed:!p.completed}:p);};
    const handleChecklistChange=(eventId,completedSteps)=>{setChecklistState(prev=>({...prev,[eventId]:completedSteps}));};
    const reset=()=>{localStorage.clear();window.location.reload();};
    const handleUpgradeMembership=(plan)=>{setMembership({plan});if(plan!=='free'&&businessProfile?.companyName){setBusinesses(prev=>[...prev.filter(b=>b.id!==businessProfile.id),{...businessProfile,id:businessProfile.id||Date.now(),isPro:true}]);}};
    const addToCalendarFromNews=(event)=>{setSavedEvents(prev=>[...prev,event]);};

    return(
        <div className="h-full w-full max-w-lg mx-auto bg-slate-100 relative overflow-hidden">
            {screen==='splash'&&<SplashScreen onFinish={()=>setScreen('main')}/>}
            {screen==='main'&&<>
                {tab==='home'&&<DashboardScreen events={events} news={newsData} onEventClick={setSelEvent} onNewsClick={()=>setTab('news')} membership={membership} businessProfile={businessProfile} savedEvents={savedEvents}/>}
                {tab==='calendar'&&<CalendarScreen events={events} onEventClick={setSelEvent} savedEvents={savedEvents}/>}
                {tab==='news'&&<NewsScreen newsData={newsData} onAddToCalendar={addToCalendarFromNews}/>}
                {tab==='support'&&<SupportScreen provinces={provinces} agencies={agencies} businesses={businesses} membership={membership}/>}
                {tab==='settings'&&<SettingsScreen onReset={reset} businessProfile={businessProfile} onUpdateProfile={setBusinessProfile} membership={membership} onUpgradeMembership={handleUpgradeMembership}/>}
                <TabBar activeTab={tab} onTabChange={setTab}/>
                {selEvent&&<EventDetailModal event={selEvent} onClose={()=>setSelEvent(null)} onToggle={toggleEvent} checklistState={checklistState} onChecklistChange={handleChecklistChange}/>}
            </>}
        </div>
    );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
