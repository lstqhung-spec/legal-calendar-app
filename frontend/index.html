<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a5276">
    <title>HTIC Legal - L·ªãch Ph√°p L√Ω</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>tailwind.config={theme:{extend:{colors:{navy:{50:'#f0f5fa',100:'#dae4f0',500:'#3d6d9e',600:'#1a5276',700:'#154360',800:'#143a52'},gold:{400:'#f2b327',500:'#e67e22'}}}}}</script>
    <style>
        *{font-family:'Inter',sans-serif;-webkit-tap-highlight-color:transparent;box-sizing:border-box}
        html,body,#root{height:100%;margin:0;padding:0;overflow:hidden;background:#f8fafc}
        .safe-top{padding-top:env(safe-area-inset-top,0px)}.safe-bottom{padding-bottom:env(safe-area-inset-bottom,0px)}
        .hide-scrollbar::-webkit-scrollbar{display:none}.hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
        @keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.slide-up{animation:slideUp .3s ease-out}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}.fade-in{animation:fadeIn .5s ease-out}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.animate-pulse-custom{animation:pulse 2s infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.animate-float{animation:float 3s ease-in-out infinite}
        .touch-active:active{transform:scale(.98);opacity:.9}
        .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    </style>
</head>
<body><div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useMemo}=React;
const API='/api';

const AppLogo=({size=40})=>(
    <svg viewBox="0 0 100 100" width={size} height={size}>
        <circle cx="50" cy="50" r="46" fill="none" stroke="#1a5276" strokeWidth="6"/>
        <path d="M18 28 L18 72 M18 50 L32 50 M32 28 L32 72" stroke="#1a5276" strokeWidth="6" fill="none" strokeLinecap="round"/>
        <path d="M42 28 L42 72" stroke="#1a5276" strokeWidth="6" strokeLinecap="round"/>
        <path d="M52 28 L68 28 M60 28 L60 72" stroke="#1a5276" strokeWidth="6" fill="none" strokeLinecap="round"/>
        <circle cx="60" cy="36" r="4" fill="#e67e22"/>
        <path d="M78 50 Q78 28 64 28 M78 50 Q78 72 64 72" stroke="#1a5276" strokeWidth="6" fill="none" strokeLinecap="round"/>
    </svg>
);

const COMPANY_INFO={name:'C√¥ng ty Lu·∫≠t HTIC',website:'www.htic.com.vn',phone:'0379 044 299',email:'contact@htic.com.vn'};
const MEMBERSHIP_PLANS={
    free:{name:'Mi·ªÖn ph√≠',price:0,features:['Xem l·ªãch ph√°p l√Ω','ƒê·ªçc tin t·ª©c','C√≥ qu·∫£ng c√°o']},
    pro_monthly:{name:'Pro Th√°ng',price:61000,period:'th√°ng',features:['Kh√¥ng qu·∫£ng c√°o','Hi·ªÉn th·ªã DN trong H·ªó tr·ª£','∆Øu ti√™n h·ªó tr·ª£']},
    pro_yearly:{name:'Pro NƒÉm',price:599000,period:'nƒÉm',features:['Kh√¥ng qu·∫£ng c√°o','Hi·ªÉn th·ªã DN trong H·ªó tr·ª£','∆Øu ti√™n h·ªó tr·ª£','Ti·∫øt ki·ªám 133k']}
};
const BUSINESS_TYPES=[{id:'tnhh',name:'C√¥ng ty TNHH'},{id:'joint_stock',name:'C√¥ng ty C·ªï ph·∫ßn'},{id:'private',name:'DN t∆∞ nh√¢n'},{id:'household',name:'H·ªô kinh doanh'}];
const INDUSTRIES=[{id:'trade',name:'Th∆∞∆°ng m·∫°i'},{id:'manufacturing',name:'S·∫£n xu·∫•t'},{id:'service',name:'D·ªãch v·ª•'},{id:'construction',name:'X√¢y d·ª±ng'},{id:'it',name:'CNTT'},{id:'legal',name:'Ph√°p l√Ω'},{id:'accounting',name:'K·∫ø to√°n'},{id:'other',name:'Kh√°c'}];
const TAX_PERIODS=[{id:'monthly',name:'K√™ khai theo th√°ng'},{id:'quarterly',name:'K√™ khai theo qu√Ω'}];
const categoryConfig={tax:{label:'Thu·∫ø',color:'bg-red-500',lightColor:'bg-red-100',textColor:'text-red-600'},insurance:{label:'BHXH',color:'bg-blue-500',lightColor:'bg-blue-100',textColor:'text-blue-600'},report:{label:'B√°o c√°o',color:'bg-green-500',lightColor:'bg-green-100',textColor:'text-green-600'},license:{label:'Gi·∫•y ph√©p',color:'bg-orange-500',lightColor:'bg-orange-100',textColor:'text-orange-600'}};
const agencyCategories={tax:{label:'Thu·∫ø',color:'bg-red-100 text-red-600'},court:{label:'T√≤a √°n',color:'bg-purple-100 text-purple-600'},insurance:{label:'BHXH',color:'bg-green-100 text-green-600'},labor:{label:'S·ªü LƒêTBXH',color:'bg-teal-100 text-teal-600'},business:{label:'ƒêƒÉng k√Ω KD',color:'bg-indigo-100 text-indigo-600'}};
const monthNames=['Th√°ng 1','Th√°ng 2','Th√°ng 3','Th√°ng 4','Th√°ng 5','Th√°ng 6','Th√°ng 7','Th√°ng 8','Th√°ng 9','Th√°ng 10','Th√°ng 11','Th√°ng 12'];
const dayNames=['CN','T2','T3','T4','T5','T6','T7'];

const Icons={
    Home:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
    Calendar:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
    Newspaper:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8M15 18h-5M10 6h8v4h-8V6Z"/></svg>,
    Settings:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
    Headphones:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"/></svg>,
    Check:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><polyline points="20 6 9 17 4 12"/></svg>,
    CheckCircle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
    ChevronLeft:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m15 18-6-6 6-6"/></svg>,
    ChevronRight:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m9 18 6-6-6-6"/></svg>,
    ChevronDown:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m6 9 6 6 6-6"/></svg>,
    Clock:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
    X:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M18 6 6 18M6 6l12 12"/></svg>,
    Mail:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>,
    Phone:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
    Building:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"/></svg>,
    FileText:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
    MapPin:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
    Search:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
    Landmark:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/></svg>,
    TrendingUp:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
    Info:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>,
    Shield:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    HelpCircle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"/></svg>,
    Trash:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
    ExternalLink:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>,
    AlertTriangle:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
    Plus:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
    User:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    Crown:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
    CreditCard:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>,
    Image:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
    Upload:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-full h-full"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
    Star:()=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-full h-full"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
};

const getDeadlineFromEvent=(ev)=>{const now=new Date();const y=now.getFullYear();const m=now.getMonth();let day=ev.dayOfMonth||20;if(ev.frequency==='monthly')return new Date(y,m,day);if(ev.frequency==='quarterly'){const qMonth=Math.floor(m/3)*3+2;return new Date(y,qMonth,day);}if(ev.frequency==='yearly'){const eventMonth=(ev.month||1)-1;return new Date(y,eventMonth,day);}return new Date(y,m,day);};
const getDaysUntil=(date)=>{const d=typeof date==='string'?new Date(date):date;const today=new Date();today.setHours(0,0,0,0);d.setHours(0,0,0,0);return Math.ceil((d-today)/(1000*60*60*24));};
const formatPrice=(price)=>new Intl.NumberFormat('vi-VN').format(price)+'ƒë';

// ============ SPLASH SCREEN (3 gi√¢y) ============
const SplashScreen=({onFinish})=>{
    useEffect(()=>{const t=setTimeout(onFinish,3000);return()=>clearTimeout(t);},[]);
    return(
        <div className="h-full bg-gradient-to-br from-navy-700 to-navy-800 flex flex-col items-center justify-center p-8">
            <div className="bg-white p-6 rounded-3xl shadow-2xl mb-8 animate-float"><AppLogo size={100}/></div>
            <h1 className="text-4xl font-bold text-white mb-3">HTIC Legal</h1>
            <p className="text-navy-100 text-center text-lg mb-2">L·ªãch Ph√°p L√Ω Doanh Nghi·ªáp</p>
            <p className="text-navy-200 text-center text-sm">Qu·∫£n l√Ω deadline thu·∫ø, BHXH, b√°o c√°o</p>
            <p className="text-navy-200 text-center text-sm">d·ªÖ d√†ng v√† chuy√™n nghi·ªáp</p>
            <div className="mt-12 flex gap-2">{[0,1,2].map(i=><div key={i} className="w-3 h-3 bg-white/50 rounded-full animate-pulse" style={{animationDelay:`${i*.2}s`}}/>)}</div>
            <p className="mt-8 text-navy-300 text-xs">by {COMPANY_INFO.name}</p>
        </div>
    );
};

// ============ AD BANNER (cho Free users) ============
const AdBanner=({membership})=>{
    if(membership?.plan!=='free')return null;
    return(
        <div className="bg-gradient-to-r from-gold-400 to-gold-500 p-3 mx-5 rounded-xl mb-4">
            <p className="text-white text-sm font-medium text-center">üéÅ N√¢ng c·∫•p Pro ƒë·ªÉ b·ªè qu·∫£ng c√°o v√† hi·ªÉn th·ªã DN</p>
        </div>
    );
};

// ============ EVENT CARD ============
const EventCard=({event,onClick,compact=false})=>{
    const c=categoryConfig[event.category]||categoryConfig.tax;
    const deadline=getDeadlineFromEvent(event);
    const d=getDaysUntil(deadline);
    const isOverdue=d<0&&!event.completed;
    const isUrgent=d>=0&&d<=7&&!event.completed;
    if(compact)return(
        <button onClick={onClick} className="w-full bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex items-center gap-3 text-left touch-active">
            <div className={`w-2 h-10 rounded-full ${c.color} flex-shrink-0`}/>
            <div className="flex-1 min-w-0"><p className="font-medium text-gray-800 text-sm truncate">{event.title}</p><p className="text-xs text-gray-500">Ng√†y {event.dayOfMonth||20}</p></div>
            {isOverdue?<span className="text-xs font-bold text-red-500">-{Math.abs(d)}d</span>:isUrgent?<span className="text-xs font-bold text-yellow-500">{d}d</span>:<span className="text-xs text-gray-400">{d}d</span>}
        </button>
    );
    return(
        <button onClick={onClick} className="w-full bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex items-center gap-4 text-left touch-active">
            <div className={`p-3 rounded-xl ${c.lightColor} flex-shrink-0`}><div className={`w-5 h-5 ${c.textColor}`}><Icons.FileText/></div></div>
            <div className="flex-1 min-w-0"><p className="font-medium text-gray-800 truncate text-sm">{event.title}</p><p className="text-xs text-gray-500 mt-0.5">Ng√†y {event.dayOfMonth||20} {event.frequency==='monthly'?'h√†ng th√°ng':event.frequency==='quarterly'?'h√†ng qu√Ω':'h√†ng nƒÉm'}</p></div>
            {event.completed?<div className="w-6 h-6 text-green-500 flex-shrink-0"><Icons.CheckCircle/></div>:isOverdue?<span className="text-xs font-semibold text-white bg-red-500 px-2.5 py-1 rounded-full animate-pulse-custom">Qu√° {Math.abs(d)}d</span>:isUrgent?<span className="text-xs font-semibold text-white bg-yellow-500 px-2.5 py-1 rounded-full">{d}d</span>:<span className="text-xs font-semibold text-navy-600 bg-navy-50 px-2.5 py-1 rounded-full">{d}d</span>}
        </button>
    );
};

// ============ NEWS CARD (v·ªõi h√¨nh ·∫£nh) ============
const NewsCard=({news,onClick,compact=false})=>{
    if(compact)return(
        <button onClick={onClick} className="w-full bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex items-center gap-3 text-left touch-active">
            {news.image?<img src={news.image} alt="" className="w-16 h-12 object-cover rounded-lg flex-shrink-0"/>:<div className="w-16 h-12 bg-navy-100 rounded-lg flex items-center justify-center flex-shrink-0"><div className="w-6 h-6 text-navy-400"><Icons.Newspaper/></div></div>}
            <div className="flex-1 min-w-0"><p className="font-medium text-gray-800 text-sm line-clamp-2">{news.title}</p><p className="text-xs text-gray-400 mt-1">{news.date}</p></div>
        </button>
    );
    return(
        <button onClick={onClick} className="w-full bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden text-left touch-active">
            {news.image?<img src={news.image} alt="" className="w-full h-40 object-cover"/>:<div className="w-full h-40 bg-navy-100 flex items-center justify-center"><div className="w-12 h-12 text-navy-400"><Icons.Newspaper/></div></div>}
            <div className="p-4"><div className="flex items-center gap-2 mb-2"><span className="bg-navy-100 text-navy-700 text-xs px-2 py-1 rounded-full font-medium">{news.category}</span>{news.isHot&&<span className="bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full">üî• Hot</span>}</div><h3 className="font-semibold text-gray-800 mb-2 line-clamp-2">{news.title}</h3><p className="text-gray-500 text-sm line-clamp-2">{news.summary}</p><p className="text-gray-400 text-xs mt-2">{news.date}</p></div>
        </button>
    );
};

// ============ EVENT DETAIL MODAL ============
const EventDetailModal=({event,onClose,onToggle,checklistState,onChecklistChange})=>{
    if(!event)return null;
    const c=categoryConfig[event.category]||categoryConfig.tax;
    const deadline=getDeadlineFromEvent(event);
    const d=getDaysUntil(deadline);
    const isOverdue=d<0&&!event.completed;
    const checklist=event.checklist||[];
    const completedSteps=checklistState[event.id]||[];
    const progress=checklist.length>0?Math.round((completedSteps.length/checklist.length)*100):0;
    const toggleStep=(stepId)=>{const current=completedSteps||[];const newState=current.includes(stepId)?current.filter(id=>id!==stepId):[...current,stepId];onChecklistChange(event.id,newState);};
    return(
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl max-h-[90vh] overflow-auto hide-scrollbar slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="sticky top-0 bg-white px-5 py-4 border-b flex justify-between items-center z-10"><div className={`px-3 py-1.5 rounded-full ${c.lightColor} ${c.textColor} text-sm font-semibold`}>{c.label}</div><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100"><div className="w-5 h-5 text-gray-500"><Icons.X/></div></button></div>
                <div className="p-5 space-y-5">
                    <h2 className="text-xl font-bold text-gray-900">{event.title}</h2>
                    <div className={`p-4 rounded-2xl ${event.completed?'bg-green-50':isOverdue?'bg-red-50':d<=7?'bg-yellow-50':'bg-navy-50'}`}><div className="flex items-center gap-3"><div className={`w-10 h-10 rounded-full flex items-center justify-center ${event.completed?'bg-green-500':isOverdue?'bg-red-500':d<=7?'bg-yellow-500':'bg-navy-600'}`}><div className="w-5 h-5 text-white">{event.completed?<Icons.Check/>:<Icons.Clock/>}</div></div><div><p className="text-sm text-gray-600">H·∫°n n·ªôp: Ng√†y {event.dayOfMonth||20}</p><p className={`font-bold ${event.completed?'text-green-600':isOverdue?'text-red-600':d<=7?'text-yellow-600':'text-navy-700'}`}>{event.completed?'ƒê√£ ho√†n th√†nh':isOverdue?`Qu√° h·∫°n ${Math.abs(d)} ng√†y`:d===0?'H√¥m nay l√† h·∫°n ch√≥t!':`C√≤n ${d} ng√†y`}</p></div></div></div>
                    {checklist.length>0&&<div className="bg-gray-50 rounded-2xl p-4"><div className="flex items-center justify-between mb-3"><h3 className="font-semibold text-gray-800">C√°c b∆∞·ªõc th·ª±c hi·ªán</h3><span className="text-sm text-gray-500">{completedSteps.length}/{checklist.length}</span></div><div className="w-full bg-gray-200 rounded-full h-2 mb-4"><div className="bg-green-500 h-2 rounded-full transition-all" style={{width:`${progress}%`}}/></div><div className="space-y-2">{checklist.map((step,idx)=><div key={step.id} className="flex items-start gap-3 p-2 rounded-xl hover:bg-white"><button onClick={()=>toggleStep(step.id)} className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${completedSteps.includes(step.id)?'bg-green-500 border-green-500':'border-gray-300'}`}>{completedSteps.includes(step.id)&&<div className="w-4 h-4 text-white"><Icons.Check/></div>}</button><div className="flex-1"><p className={`text-sm ${completedSteps.includes(step.id)?'text-gray-400 line-through':'text-gray-700'}`}>{idx+1}. {step.text}</p>{step.link&&<a href={step.link} target="_blank" rel="noopener noreferrer" className="text-xs text-navy-600 flex items-center gap-1 mt-1"><div className="w-3 h-3"><Icons.ExternalLink/></div>M·ªü li√™n k·∫øt</a>}</div></div>)}</div></div>}
                    {event.description&&<div><h3 className="font-semibold mb-2 text-gray-800">M√¥ t·∫£</h3><p className="text-gray-600 text-sm">{event.description}</p></div>}
                    {event.legalReference&&<div><h3 className="font-semibold mb-2 text-gray-800">CƒÉn c·ª© ph√°p l√Ω</h3><p className="text-gray-600 text-sm">{event.legalReference}</p></div>}
                    {event.penalty&&<div className="bg-red-50 p-4 rounded-xl"><h3 className="font-semibold mb-2 text-red-700 flex items-center gap-2"><div className="w-5 h-5"><Icons.AlertTriangle/></div>M·ª©c ph·∫°t</h3><p className="text-red-600 text-sm">{event.penalty}</p></div>}
                    <button onClick={()=>onToggle(event.id)} className={`w-full py-4 rounded-2xl font-semibold flex items-center justify-center gap-2 ${event.completed?'bg-gray-100 text-gray-700':'bg-green-500 text-white'}`}><div className="w-5 h-5">{event.completed?<Icons.X/>:<Icons.Check/>}</div>{event.completed?'B·ªè ƒë√°nh d·∫•u':'ƒê√°nh d·∫•u ho√†n th√†nh'}</button>
                </div>
            </div>
        </div>
    );
};

// ============ DASHBOARD SCREEN (5 s·ª± ki·ªán + 5 tin t·ª©c) ============
const DashboardScreen=({events,news,onEventClick,onNewsClick,membership,businessProfile})=>{
    const today=new Date();
    const eventsWithDeadline=useMemo(()=>events.map(e=>({...e,deadline:getDeadlineFromEvent(e),daysUntil:getDaysUntil(getDeadlineFromEvent(e))})),[events]);
    const overdue=eventsWithDeadline.filter(e=>e.daysUntil<0&&!e.completed);
    const upcoming=eventsWithDeadline.filter(e=>!e.completed).sort((a,b)=>a.daysUntil-b.daysUntil).slice(0,5);
    const latestNews=news.slice(0,5);
    const nearestDeadline=upcoming[0];
    return(
        <div className="h-full bg-gray-50 overflow-auto hide-scrollbar pb-24">
            <div className="bg-gradient-to-br from-navy-700 to-navy-800 pt-14 pb-6 px-5 safe-top">
                <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3"><div className="bg-white p-2 rounded-xl shadow"><AppLogo size={32}/></div><div><p className="text-white font-bold text-lg">L·ªãch Ph√°p L√Ω</p><p className="text-navy-300 text-xs">by HTIC LAW</p></div></div>
                    {membership?.plan==='pro_monthly'||membership?.plan==='pro_yearly'?<div className="bg-gold-500 px-3 py-1 rounded-full flex items-center gap-1"><div className="w-4 h-4 text-white"><Icons.Crown/></div><span className="text-white text-xs font-bold">PRO</span></div>:null}
                </div>
                <p className="text-navy-200 text-sm">{today.toLocaleDateString('vi-VN',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</p>
            </div>
            {overdue.length>0&&<div className="px-5 -mt-3 mb-3"><div className="bg-red-500 rounded-2xl p-4 shadow-lg animate-pulse-custom"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"><div className="w-6 h-6 text-white"><Icons.AlertTriangle/></div></div><div><p className="text-white font-bold">‚ö†Ô∏è {overdue.length} vi·ªác ƒë√£ qu√° h·∫°n!</p><p className="text-red-100 text-sm">Vui l√≤ng x·ª≠ l√Ω ngay</p></div></div></div></div>}
            {nearestDeadline&&<div className={`px-5 ${overdue.length===0?'-mt-3':''}`}><div className={`rounded-2xl p-5 shadow-lg ${nearestDeadline.daysUntil<0?'bg-red-500':nearestDeadline.daysUntil<=7?'bg-yellow-500':'bg-green-500'}`}><div className="flex justify-between items-start"><div className="flex-1"><p className="text-white/80 text-sm mb-1">Deadline g·∫ßn nh·∫•t</p><p className="text-white font-bold text-lg mb-2 line-clamp-2">{nearestDeadline.title}</p><div className="flex items-center gap-2"><div className="w-5 h-5 text-white/80"><Icons.Clock/></div><p className="text-white font-bold text-2xl">{nearestDeadline.daysUntil<0?`Qu√° h·∫°n ${Math.abs(nearestDeadline.daysUntil)} ng√†y`:nearestDeadline.daysUntil===0?'H√¥m nay!':`C√≤n ${nearestDeadline.daysUntil} ng√†y`}</p></div></div><button onClick={()=>onEventClick(nearestDeadline)} className="bg-white/20 p-3 rounded-full"><div className="w-6 h-6 text-white"><Icons.ChevronRight/></div></button></div></div></div>}
            <AdBanner membership={membership}/>
            <div className="px-5 py-4">
                <h2 className="text-lg font-bold mb-3 text-gray-800 flex items-center gap-2"><div className="w-6 h-6 text-navy-600"><Icons.Calendar/></div>5 S·ª± ki·ªán s·∫Øp t·ªõi</h2>
                <div className="space-y-2">{upcoming.length===0?<p className="text-gray-500 text-center py-4">Kh√¥ng c√≥ s·ª± ki·ªán</p>:upcoming.map(e=><EventCard key={e.id} event={e} onClick={()=>onEventClick(e)} compact/>)}</div>
            </div>
            <div className="px-5 pb-4">
                <h2 className="text-lg font-bold mb-3 text-gray-800 flex items-center gap-2"><div className="w-6 h-6 text-gold-500"><Icons.Newspaper/></div>5 Tin ph√°p l√Ω m·ªõi</h2>
                <div className="space-y-2">{latestNews.length===0?<p className="text-gray-500 text-center py-4">ƒêang t·∫£i...</p>:latestNews.map(n=><NewsCard key={n.id} news={n} onClick={()=>onNewsClick(n)} compact/>)}</div>
            </div>
        </div>
    );
};

// ============ CALENDAR SCREEN (c√≥ L·ªãch c·ªßa b·∫°n) ============
const CalendarScreen=({events,onEventClick,userEvents,onAddUserEvent,onDeleteUserEvent})=>{
    const today=new Date();
    const[month,setMonth]=useState(today.getMonth());
    const[year,setYear]=useState(today.getFullYear());
    const[sel,setSel]=useState(null);
    const[showAddModal,setShowAddModal]=useState(false);
    const[viewMode,setViewMode]=useState('system');
    const days=new Date(year,month+1,0).getDate();
    const first=new Date(year,month,1).getDay();
    const eventsWithDeadline=events.map(e=>({...e,deadline:getDeadlineFromEvent(e)}));
    const getEv=(d)=>{
        const systemEv=eventsWithDeadline.filter(e=>{const dd=new Date(e.deadline);return dd.getDate()===d&&dd.getMonth()===month&&dd.getFullYear()===year;});
        const userEv=(userEvents||[]).filter(e=>{const dd=new Date(e.date);return dd.getDate()===d&&dd.getMonth()===month&&dd.getFullYear()===year;});
        return viewMode==='system'?systemEv:viewMode==='user'?userEv:[...systemEv,...userEv];
    };
    const selEv=sel?getEv(sel):[];
    return(
        <div className="h-full bg-gray-50 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="bg-navy-100 p-2.5 rounded-xl"><div className="w-6 h-6 text-navy-700"><Icons.Calendar/></div></div><h1 className="text-2xl font-bold text-gray-800">L·ªãch</h1></div><button onClick={()=>setShowAddModal(true)} className="bg-navy-600 text-white p-2 rounded-full"><div className="w-5 h-5"><Icons.Plus/></div></button></div></div>
            <div className="bg-white px-5 py-3 flex gap-2 border-b">
                <button onClick={()=>setViewMode('all')} className={`px-3 py-1.5 rounded-full text-sm font-medium ${viewMode==='all'?'bg-navy-700 text-white':'bg-gray-100 text-gray-600'}`}>T·∫•t c·∫£</button>
                <button onClick={()=>setViewMode('system')} className={`px-3 py-1.5 rounded-full text-sm font-medium ${viewMode==='system'?'bg-navy-700 text-white':'bg-gray-100 text-gray-600'}`}>H·ªá th·ªëng</button>
                <button onClick={()=>setViewMode('user')} className={`px-3 py-1.5 rounded-full text-sm font-medium ${viewMode==='user'?'bg-navy-700 text-white':'bg-gray-100 text-gray-600'}`}>L·ªãch c·ªßa b·∫°n</button>
            </div>
            <div className="bg-white px-5 py-3 flex justify-between items-center border-b"><button onClick={()=>{if(month===0){setMonth(11);setYear(year-1);}else{setMonth(month-1);}}} className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100"><div className="w-6 h-6 text-gray-600"><Icons.ChevronLeft/></div></button><h2 className="text-lg font-bold text-gray-800">{monthNames[month]} {year}</h2><button onClick={()=>{if(month===11){setMonth(0);setYear(year+1);}else{setMonth(month+1);}}} className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100"><div className="w-6 h-6 text-gray-600"><Icons.ChevronRight/></div></button></div>
            <div className="bg-white px-3 py-3"><div className="grid grid-cols-7 mb-2">{dayNames.map(d=><div key={d} className="text-center text-sm font-semibold text-gray-500 py-2">{d}</div>)}</div><div className="grid grid-cols-7 gap-1">{Array.from({length:first}).map((_,i)=><div key={`e-${i}`}/>)}{Array.from({length:days}).map((_,i)=>{const day=i+1;const ev=getEv(day);const isT=day===today.getDate()&&month===today.getMonth()&&year===today.getFullYear();const isS=day===sel;return<button key={day} onClick={()=>setSel(day)} className={`aspect-square flex flex-col items-center justify-center rounded-xl transition-all ${isS?'bg-navy-700 shadow-lg':isT?'bg-navy-100':'hover:bg-gray-100'}`}><span className={`text-sm font-medium ${isS?'text-white':isT?'text-navy-700 font-bold':'text-gray-700'}`}>{day}</span>{ev.length>0&&<div className="flex gap-0.5 mt-1">{ev.slice(0,3).map((e,idx)=><div key={idx} className={`w-1.5 h-1.5 rounded-full ${isS?'bg-white':e.isUserEvent?'bg-purple-500':(categoryConfig[e.category]?.color||'bg-gray-400')}`}/>)}</div>}</button>;})}</div></div>
            <div className="bg-white px-5 py-2 flex flex-wrap gap-3 border-t text-xs">{Object.entries(categoryConfig).map(([k,c])=><div key={k} className="flex items-center gap-1"><div className={`w-2 h-2 rounded-full ${c.color}`}/><span className="text-gray-600">{c.label}</span></div>)}<div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-purple-500"/><span className="text-gray-600">C√° nh√¢n</span></div></div>
            {sel&&<div className="flex-1 bg-gray-50 px-5 py-4 overflow-auto hide-scrollbar"><h3 className="font-semibold mb-3 text-gray-800">Ng√†y {sel}/{month+1}/{year}</h3>{selEv.length>0?<div className="space-y-2">{selEv.map((e,idx)=>e.isUserEvent?<div key={idx} className="bg-purple-50 rounded-xl p-3 flex items-center justify-between"><div><p className="font-medium text-purple-700">{e.title}</p><p className="text-xs text-purple-500">{e.note}</p></div><button onClick={()=>onDeleteUserEvent(e.id)} className="text-red-500"><div className="w-5 h-5"><Icons.Trash/></div></button></div>:<EventCard key={e.id} event={e} onClick={()=>onEventClick(e)} compact/>)}</div>:<p className="text-gray-500 text-center py-6">Kh√¥ng c√≥ s·ª± ki·ªán</p>}</div>}
            {showAddModal&&<AddUserEventModal onClose={()=>setShowAddModal(false)} onAdd={(ev)=>{onAddUserEvent(ev);setShowAddModal(false);}} selectedDate={sel?new Date(year,month,sel):new Date()}/>}
        </div>
    );
};

const AddUserEventModal=({onClose,onAdd,selectedDate})=>{
    const[title,setTitle]=useState('');
    const[note,setNote]=useState('');
    const[date,setDate]=useState(selectedDate.toISOString().split('T')[0]);
    const handleAdd=()=>{if(!title)return;onAdd({id:Date.now(),title,note,date,isUserEvent:true});};
    return(
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl p-5 slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4"><h2 className="text-xl font-bold text-gray-800">Th√™m l·ªãch c√° nh√¢n</h2><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100"><div className="w-5 h-5 text-gray-500"><Icons.X/></div></button></div>
                <div className="space-y-4">
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">Ti√™u ƒë·ªÅ *</label><input type="text" value={title} onChange={e=>setTitle(e.target.value)} placeholder="VD: H·ªçp v·ªõi kh√°ch h√†ng" className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">Ng√†y</label><input type="date" value={date} onChange={e=>setDate(e.target.value)} className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">Ghi ch√∫</label><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Ghi ch√∫ th√™m..." rows={3} className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none resize-none"/></div>
                    <button onClick={handleAdd} disabled={!title} className={`w-full py-4 rounded-2xl font-semibold text-white ${title?'bg-navy-700':'bg-gray-300'}`}>Th√™m s·ª± ki·ªán</button>
                </div>
            </div>
        </div>
    );
};

// ============ NEWS SCREEN (c√≥ h√¨nh ·∫£nh) ============
const NewsScreen=({newsData,onNewsClick})=>{
    const[sel,setSel]=useState(null);
    if(sel)return(
        <div className="h-full bg-gray-50 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top"><div className="flex items-center gap-3"><button onClick={()=>setSel(null)}><div className="w-7 h-7 text-gray-600"><Icons.ChevronLeft/></div></button><h1 className="text-xl font-bold text-gray-800">Chi ti·∫øt tin</h1></div></div>
            <div className="flex-1 overflow-auto hide-scrollbar">
                {sel.image&&<img src={sel.image} alt="" className="w-full h-52 object-cover"/>}
                <div className="px-5 py-5">
                    <div className="flex items-center gap-2 mb-4"><span className="bg-navy-100 text-navy-700 text-sm px-3 py-1 rounded-full font-medium">{sel.category}</span>{sel.isHot&&<span className="bg-red-100 text-red-600 text-sm px-3 py-1 rounded-full">üî• Hot</span>}</div>
                    <h2 className="text-2xl font-bold mb-3 text-gray-900">{sel.title}</h2>
                    <p className="text-gray-500 mb-5">{sel.date}</p>
                    <p className="text-gray-700 text-lg leading-relaxed">{sel.summary}</p>
                    {sel.content&&<p className="text-gray-700 mt-5 leading-relaxed whitespace-pre-line">{sel.content}</p>}
                </div>
            </div>
        </div>
    );
    return(
        <div className="h-full bg-gray-50 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top"><div className="flex items-center gap-3"><div className="bg-navy-100 p-2.5 rounded-xl"><div className="w-6 h-6 text-navy-700"><Icons.Newspaper/></div></div><h1 className="text-2xl font-bold text-gray-800">Tin t·ª©c ph√°p lu·∫≠t</h1></div></div>
            <div className="flex-1 px-5 py-5 overflow-auto hide-scrollbar">
                <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-gray-800"><div className="w-6 h-6 text-gold-500"><Icons.TrendingUp/></div>Tin m·ªõi nh·∫•t</h2>
                {newsData.length===0?<div className="text-center py-10 text-gray-500">ƒêang t·∫£i...</div>:<div className="space-y-4">{newsData.map(n=><NewsCard key={n.id} news={n} onClick={()=>setSel(n)}/>)}</div>}
            </div>
        </div>
    );
};

// ============ SUPPORT SCREEN (C∆° quan + Doanh nghi·ªáp) ============
const SupportScreen=({provinces,agencies,businesses,membership})=>{
    const[tab,setTab]=useState('agencies');
    const[province,setProvince]=useState(provinces[0]?.id||'');
    const[searchQuery,setSearchQuery]=useState('');
    const filteredAgencies=agencies.filter(a=>a.provinceId===province&&a.name.toLowerCase().includes(searchQuery.toLowerCase()));
    const proBiz=(businesses||[]).filter(b=>b.isPro);
    return(
        <div className="h-full bg-gray-50 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top"><div className="flex items-center gap-3"><div className="bg-purple-100 p-2.5 rounded-xl"><div className="w-6 h-6 text-purple-700"><Icons.Headphones/></div></div><h1 className="text-2xl font-bold text-gray-800">H·ªó tr·ª£</h1></div></div>
            <div className="bg-white px-5 py-3 flex gap-2 border-b">
                <button onClick={()=>setTab('agencies')} className={`flex-1 py-2 rounded-xl text-sm font-medium ${tab==='agencies'?'bg-navy-700 text-white':'bg-gray-100 text-gray-600'}`}><div className="flex items-center justify-center gap-2"><div className="w-4 h-4"><Icons.Landmark/></div>C∆° quan NN</div></button>
                <button onClick={()=>setTab('businesses')} className={`flex-1 py-2 rounded-xl text-sm font-medium ${tab==='businesses'?'bg-navy-700 text-white':'bg-gray-100 text-gray-600'}`}><div className="flex items-center justify-center gap-2"><div className="w-4 h-4"><Icons.Building/></div>Doanh nghi·ªáp</div></button>
            </div>
            <div className="flex-1 overflow-auto hide-scrollbar">
                {tab==='agencies'&&<div className="px-5 py-4">
                    <div className="mb-4"><label className="text-sm font-medium text-gray-700 mb-2 block">Ch·ªçn t·ªânh/th√†nh ph·ªë</label><div className="relative"><select value={province} onChange={e=>setProvince(e.target.value)} className="w-full p-4 rounded-xl border border-gray-200 bg-white focus:border-navy-500 focus:outline-none appearance-none pr-10">{provinces.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}</select><div className="w-5 h-5 text-gray-400 absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none"><Icons.ChevronDown/></div></div></div>
                    <div className="mb-4 relative"><div className="w-5 h-5 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2"><Icons.Search/></div><input type="text" value={searchQuery} onChange={e=>setSearchQuery(e.target.value)} placeholder="T√¨m c∆° quan..." className="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 bg-white focus:border-navy-500 focus:outline-none"/></div>
                    <div className="space-y-3">{filteredAgencies.length===0?<p className="text-gray-500 text-center py-10">Kh√¥ng t√¨m th·∫•y</p>:filteredAgencies.map(agency=>{const catInfo=agencyCategories[agency.category]||{label:agency.category,color:'bg-gray-100 text-gray-600'};return<div key={agency.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100"><div className="flex items-start gap-3"><div className={`p-2.5 rounded-xl ${catInfo.color} flex-shrink-0`}><div className="w-5 h-5"><Icons.Landmark/></div></div><div className="flex-1 min-w-0"><h3 className="font-semibold text-gray-800 mb-1">{agency.name}</h3><div className="flex items-center gap-1.5 text-gray-500 text-sm"><div className="w-4 h-4 flex-shrink-0"><Icons.MapPin/></div><span className="truncate">{agency.address}</span></div><div className="flex items-center gap-1.5 text-gray-500 text-sm mt-1"><div className="w-4 h-4 flex-shrink-0"><Icons.Phone/></div><span>{agency.phone}</span></div></div></div></div>;})}</div>
                </div>}
                {tab==='businesses'&&<div className="px-5 py-4">
                    <div className="bg-gold-50 border border-gold-200 rounded-xl p-4 mb-4"><p className="text-gold-700 text-sm font-medium">üíº C√°c doanh nghi·ªáp Pro ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y</p></div>
                    {proBiz.length===0?<div className="text-center py-10"><div className="w-16 h-16 text-gray-300 mx-auto mb-4"><Icons.Building/></div><p className="text-gray-500">Ch∆∞a c√≥ doanh nghi·ªáp Pro n√†o</p></div>:<div className="space-y-3">{proBiz.map(biz=><div key={biz.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100"><div className="flex items-start gap-3">{biz.logo?<img src={biz.logo} alt="" className="w-14 h-14 rounded-xl object-cover"/>:<div className="w-14 h-14 bg-navy-100 rounded-xl flex items-center justify-center"><div className="w-8 h-8 text-navy-400"><Icons.Building/></div></div>}<div className="flex-1 min-w-0"><div className="flex items-center gap-2"><h3 className="font-semibold text-gray-800">{biz.name}</h3><div className="bg-gold-500 px-1.5 py-0.5 rounded text-white text-xs font-bold">PRO</div></div><p className="text-sm text-gray-500">{INDUSTRIES.find(i=>i.id===biz.industry)?.name}</p>{biz.phone&&<p className="text-sm text-gray-500 mt-1">üìû {biz.phone}</p>}{biz.address&&<p className="text-sm text-gray-500">üìç {biz.address}</p>}</div></div></div>)}</div>}
                </div>}
            </div>
        </div>
    );
};

// ============ MEMBERSHIP MODAL ============
const MembershipModal=({onClose,onSelectPlan,currentPlan})=>{
    return(
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl max-h-[90vh] overflow-auto hide-scrollbar slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="sticky top-0 bg-white px-5 py-4 border-b flex justify-between items-center z-10"><h2 className="text-xl font-bold text-gray-800">N√¢ng c·∫•p t√†i kho·∫£n</h2><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100"><div className="w-5 h-5 text-gray-500"><Icons.X/></div></button></div>
                <div className="p-5 space-y-4">
                    <div className={`border-2 rounded-2xl p-5 ${currentPlan==='free'?'border-navy-500 bg-navy-50':'border-gray-200'}`}>
                        <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-800">Mi·ªÖn ph√≠</h3>{currentPlan==='free'&&<span className="bg-navy-600 text-white text-xs px-2 py-1 rounded-full">Hi·ªán t·∫°i</span>}</div>
                        <p className="text-3xl font-bold text-gray-800 mb-3">0ƒë</p>
                        <ul className="space-y-2">{MEMBERSHIP_PLANS.free.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-600 text-sm"><div className="w-5 h-5 text-green-500"><Icons.Check/></div>{f}</li>)}</ul>
                    </div>
                    <div className={`border-2 rounded-2xl p-5 relative overflow-hidden ${currentPlan==='pro_monthly'?'border-gold-500 bg-gold-50':'border-gray-200'}`}>
                        <div className="absolute top-0 right-0 bg-gold-500 text-white text-xs px-3 py-1 rounded-bl-xl font-bold">PH·ªî BI·∫æN</div>
                        <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-800">Pro Th√°ng</h3>{currentPlan==='pro_monthly'&&<span className="bg-gold-500 text-white text-xs px-2 py-1 rounded-full">Hi·ªán t·∫°i</span>}</div>
                        <p className="text-3xl font-bold text-gray-800 mb-1">{formatPrice(61000)}<span className="text-lg font-normal text-gray-500">/th√°ng</span></p>
                        <ul className="space-y-2 mt-3">{MEMBERSHIP_PLANS.pro_monthly.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-600 text-sm"><div className="w-5 h-5 text-gold-500"><Icons.Check/></div>{f}</li>)}</ul>
                        {currentPlan!=='pro_monthly'&&<button onClick={()=>onSelectPlan('pro_monthly')} className="w-full mt-4 py-3 bg-gold-500 text-white rounded-xl font-semibold">Ch·ªçn g√≥i n√†y</button>}
                    </div>
                    <div className={`border-2 rounded-2xl p-5 ${currentPlan==='pro_yearly'?'border-green-500 bg-green-50':'border-gray-200'}`}>
                        <div className="flex items-center justify-between mb-3"><h3 className="text-lg font-bold text-gray-800">Pro NƒÉm</h3>{currentPlan==='pro_yearly'&&<span className="bg-green-500 text-white text-xs px-2 py-1 rounded-full">Hi·ªán t·∫°i</span>}</div>
                        <p className="text-3xl font-bold text-gray-800 mb-1">{formatPrice(599000)}<span className="text-lg font-normal text-gray-500">/nƒÉm</span></p>
                        <p className="text-green-600 text-sm font-medium mb-3">üéÅ Ti·∫øt ki·ªám 133.000ƒë so v·ªõi g√≥i th√°ng</p>
                        <ul className="space-y-2">{MEMBERSHIP_PLANS.pro_yearly.features.map((f,i)=><li key={i} className="flex items-center gap-2 text-gray-600 text-sm"><div className="w-5 h-5 text-green-500"><Icons.Check/></div>{f}</li>)}</ul>
                        {currentPlan!=='pro_yearly'&&<button onClick={()=>onSelectPlan('pro_yearly')} className="w-full mt-4 py-3 bg-green-500 text-white rounded-xl font-semibold">Ch·ªçn g√≥i n√†y - Ti·∫øt ki·ªám nh·∫•t!</button>}
                    </div>
                </div>
            </div>
        </div>
    );
};

// ============ PAYMENT MODAL ============
const PaymentModal=({plan,onClose,onSuccess})=>{
    const[method,setMethod]=useState('');
    const price=plan==='pro_monthly'?61000:599000;
    const period=plan==='pro_monthly'?'th√°ng':'nƒÉm';
    const handlePay=()=>{alert(`Chuy·ªÉn h∆∞·ªõng ƒë·∫øn c·ªïng thanh to√°n ${method}...\nS·ªë ti·ªÅn: ${formatPrice(price)}`);onSuccess(plan);};
    return(
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50 fade-in" onClick={onClose}>
            <div className="bg-white w-full max-w-lg rounded-t-3xl p-5 slide-up safe-bottom" onClick={e=>e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4"><h2 className="text-xl font-bold text-gray-800">Thanh to√°n</h2><button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100"><div className="w-5 h-5 text-gray-500"><Icons.X/></div></button></div>
                <div className="bg-navy-50 rounded-xl p-4 mb-4"><p className="text-navy-700 font-medium">G√≥i Pro {period==='th√°ng'?'Th√°ng':'NƒÉm'}</p><p className="text-2xl font-bold text-navy-800">{formatPrice(price)}/{period}</p></div>
                <p className="text-sm font-medium text-gray-700 mb-3">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n:</p>
                <div className="space-y-2 mb-4">
                    <button onClick={()=>setMethod('vnpay')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='vnpay'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">VNPay</div><div className="text-left"><p className="font-medium text-gray-800">VNPay</p><p className="text-xs text-gray-500">Th·∫ª ATM, Visa, MasterCard</p></div></button>
                    <button onClick={()=>setMethod('momo')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='momo'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">MoMo</div><div className="text-left"><p className="font-medium text-gray-800">V√≠ MoMo</p><p className="text-xs text-gray-500">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠</p></div></button>
                    <button onClick={()=>setMethod('bank')} className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 ${method==='bank'?'border-navy-500 bg-navy-50':'border-gray-200'}`}><div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center"><div className="w-6 h-6 text-white"><Icons.CreditCard/></div></div><div className="text-left"><p className="font-medium text-gray-800">Chuy·ªÉn kho·∫£n</p><p className="text-xs text-gray-500">Ng√¢n h√†ng n·ªôi ƒë·ªãa</p></div></button>
                </div>
                <button onClick={handlePay} disabled={!method} className={`w-full py-4 rounded-2xl font-semibold text-white ${method?'bg-navy-700':'bg-gray-300'}`}>Thanh to√°n {formatPrice(price)}</button>
            </div>
        </div>
    );
};

// ============ SETTINGS SCREEN (c√≥ upload logo) ============
const SettingsScreen=({onReset,businessProfile,onUpdateProfile,membership,onUpgradeMembership})=>{
    const[showProfileForm,setShowProfileForm]=useState(false);
    const[profile,setProfile]=useState(businessProfile||{});
    const[showMembership,setShowMembership]=useState(false);
    const[selectedPlan,setSelectedPlan]=useState(null);
    const saveProfile=()=>{onUpdateProfile(profile);setShowProfileForm(false);};
    const handleLogoUpload=(e)=>{
        const file=e.target.files[0];
        if(file){const reader=new FileReader();reader.onloadend=()=>{setProfile({...profile,logo:reader.result});};reader.readAsDataURL(file);}
    };
    const handleSelectPlan=(plan)=>{setShowMembership(false);setSelectedPlan(plan);};
    const handlePaymentSuccess=(plan)=>{onUpgradeMembership(plan);setSelectedPlan(null);};

    if(showProfileForm)return(
        <div className="h-full bg-gray-50 flex flex-col pb-20">
            <div className="bg-white pt-14 pb-4 px-5 shadow-sm safe-top"><div className="flex items-center gap-3"><button onClick={()=>setShowProfileForm(false)}><div className="w-7 h-7 text-gray-600"><Icons.ChevronLeft/></div></button><h1 className="text-xl font-bold text-gray-800">H·ªì s∆° doanh nghi·ªáp</h1></div></div>
            <div className="flex-1 px-5 py-5 overflow-auto hide-scrollbar">
                <div className="flex flex-col items-center mb-6">
                    <div className="relative">
                        {profile.logo?<img src={profile.logo} alt="Logo" className="w-24 h-24 rounded-2xl object-cover"/>:<div className="w-24 h-24 bg-navy-100 rounded-2xl flex items-center justify-center"><div className="w-12 h-12 text-navy-400"><Icons.Building/></div></div>}
                        <label className="absolute -bottom-2 -right-2 bg-navy-600 p-2 rounded-full cursor-pointer"><div className="w-5 h-5 text-white"><Icons.Upload/></div><input type="file" accept="image/*" onChange={handleLogoUpload} className="hidden"/></label>
                    </div>
                    <p className="text-sm text-gray-500 mt-2">Upload logo c√¥ng ty</p>
                </div>
                <div className="space-y-4">
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">T√™n c√¥ng ty *</label><input type="text" value={profile.companyName||''} onChange={e=>setProfile({...profile,companyName:e.target.value})} placeholder="C√¥ng ty TNHH ABC" className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">M√£ s·ªë thu·∫ø</label><input type="text" value={profile.taxCode||''} onChange={e=>setProfile({...profile,taxCode:e.target.value})} placeholder="0123456789" className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">S·ªë ƒëi·ªán tho·∫°i</label><input type="tel" value={profile.phone||''} onChange={e=>setProfile({...profile,phone:e.target.value})} placeholder="0912 345 678" className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">ƒê·ªãa ch·ªâ</label><input type="text" value={profile.address||''} onChange={e=>setProfile({...profile,address:e.target.value})} placeholder="123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ" className="w-full p-4 rounded-xl border border-gray-200 focus:border-navy-500 focus:outline-none"/></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">Lo·∫°i h√¨nh</label><select value={profile.businessType||''} onChange={e=>setProfile({...profile,businessType:e.target.value})} className="w-full p-4 rounded-xl border border-gray-200 bg-white focus:border-navy-500 focus:outline-none"><option value="">-- Ch·ªçn --</option>{BUSINESS_TYPES.map(t=><option key={t.id} value={t.id}>{t.name}</option>)}</select></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">Ng√†nh ngh·ªÅ</label><select value={profile.industry||''} onChange={e=>setProfile({...profile,industry:e.target.value})} className="w-full p-4 rounded-xl border border-gray-200 bg-white focus:border-navy-500 focus:outline-none"><option value="">-- Ch·ªçn --</option>{INDUSTRIES.map(i=><option key={i.id} value={i.id}>{i.name}</option>)}</select></div>
                    <div><label className="text-sm font-medium text-gray-700 mb-2 block">K√™ khai thu·∫ø</label><select value={profile.taxPeriod||''} onChange={e=>setProfile({...profile,taxPeriod:e.target.value})} className="w-full p-4 rounded-xl border border-gray-200 bg-white focus:border-navy-500 focus:outline-none"><option value="">-- Ch·ªçn --</option>{TAX_PERIODS.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}</select></div>
                </div>
            </div>
            <div className="p-5"><button onClick={saveProfile} className="w-full py-4 rounded-2xl bg-navy-700 text-white font-semibold">L∆∞u th√¥ng tin</button></div>
        </div>
    );

    return(
        <div className="h-full bg-gray-50 overflow-auto hide-scrollbar pb-24">
            <div className="bg-gradient-to-br from-navy-700 to-navy-800 pt-14 pb-8 px-5 safe-top">
                <h1 className="text-2xl font-bold text-white mb-5">C√†i ƒë·∫∑t</h1>
                <div className="bg-white/10 rounded-2xl p-5">
                    <div className="flex items-center gap-4">
                        {businessProfile?.logo?<img src={businessProfile.logo} alt="" className="w-14 h-14 rounded-xl object-cover"/>:<div className="bg-white p-2.5 rounded-xl"><AppLogo size={36}/></div>}
                        <div className="flex-1 min-w-0"><p className="text-white font-bold text-lg truncate">{businessProfile?.companyName||'Doanh nghi·ªáp'}</p><p className="text-navy-200 truncate">{businessProfile?.taxCode?`MST: ${businessProfile.taxCode}`:'Ch∆∞a thi·∫øt l·∫≠p'}</p></div>
                        {(membership?.plan==='pro_monthly'||membership?.plan==='pro_yearly')&&<div className="bg-gold-500 px-2 py-1 rounded-full flex items-center gap-1"><div className="w-4 h-4 text-white"><Icons.Crown/></div><span className="text-white text-xs font-bold">PRO</span></div>}
                    </div>
                </div>
            </div>
            <div className="px-5 py-5">
                <div className="bg-white rounded-2xl p-5 shadow-sm mb-5">
                    <div className="flex items-center justify-between mb-4"><h3 className="font-bold text-gray-800 flex items-center gap-2"><div className="w-5 h-5 text-navy-600"><Icons.Building/></div>H·ªì s∆° doanh nghi·ªáp</h3><button onClick={()=>setShowProfileForm(true)} className="text-navy-600 text-sm font-medium">Ch·ªânh s·ª≠a</button></div>
                    {businessProfile?.companyName?<div className="space-y-2 text-sm"><p><span className="text-gray-500">T√™n:</span> <span className="text-gray-800">{businessProfile.companyName}</span></p>{businessProfile.taxCode&&<p><span className="text-gray-500">MST:</span> <span className="text-gray-800">{businessProfile.taxCode}</span></p>}{businessProfile.businessType&&<p><span className="text-gray-500">Lo·∫°i h√¨nh:</span> <span className="text-gray-800">{BUSINESS_TYPES.find(t=>t.id===businessProfile.businessType)?.name}</span></p>}</div>:<p className="text-gray-500 text-sm">Ch∆∞a thi·∫øt l·∫≠p h·ªì s∆°.</p>}
                </div>
                <div className="bg-gradient-to-r from-gold-400 to-gold-500 rounded-2xl p-5 shadow-sm mb-5">
                    <div className="flex items-center justify-between"><div><h3 className="font-bold text-white flex items-center gap-2"><div className="w-5 h-5"><Icons.Crown/></div>G√≥i th√†nh vi√™n</h3><p className="text-gold-100 text-sm mt-1">{membership?.plan==='free'?'Mi·ªÖn ph√≠ (c√≥ qu·∫£ng c√°o)':membership?.plan==='pro_monthly'?'Pro Th√°ng':'Pro NƒÉm'}</p></div><button onClick={()=>setShowMembership(true)} className="bg-white text-gold-600 px-4 py-2 rounded-xl font-semibold text-sm">{membership?.plan==='free'?'N√¢ng c·∫•p':'Qu·∫£n l√Ω'}</button></div>
                </div>
                <div className="bg-white rounded-2xl px-5 shadow-sm mb-5">
                    <h3 className="font-bold pt-5 pb-3 text-gray-800">V·ªÅ ·ª©ng d·ª•ng</h3>
                    <div className="py-4 border-b border-gray-100 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.Info/></div><span className="flex-1 text-gray-700">Phi√™n b·∫£n</span><span className="text-gray-400">5.0.0</span></div>
                    <div className="py-4 border-b border-gray-100 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.Shield/></div><span className="flex-1 text-gray-700">Ch√≠nh s√°ch b·∫£o m·∫≠t</span><div className="w-5 h-5 text-gray-400"><Icons.ChevronRight/></div></div>
                    <div className="py-4 flex items-center gap-4"><div className="w-5 h-5 text-gray-500"><Icons.HelpCircle/></div><span className="flex-1 text-gray-700">Li√™n h·ªá h·ªó tr·ª£</span><div className="w-5 h-5 text-gray-400"><Icons.ChevronRight/></div></div>
                </div>
                <div className="bg-white rounded-2xl p-5 shadow-sm mb-5">
                    <h3 className="font-bold mb-4 text-gray-800">Nh√† ph√°t h√†nh</h3>
                    <div className="flex items-center gap-4"><div className="bg-navy-100 p-3 rounded-xl"><AppLogo size={28}/></div><div><p className="font-semibold text-gray-800">{COMPANY_INFO.name}</p><p className="text-sm text-gray-500">{COMPANY_INFO.website}</p></div></div>
                    <div className="mt-4 pt-4 border-t border-gray-100 space-y-3"><div className="flex items-center gap-3 text-gray-500"><div className="w-5 h-5"><Icons.Phone/></div><span>{COMPANY_INFO.phone}</span></div><div className="flex items-center gap-3 text-gray-500"><div className="w-5 h-5"><Icons.Mail/></div><span>{COMPANY_INFO.email}</span></div></div>
                </div>
                <div className="bg-white rounded-2xl px-5 shadow-sm"><button onClick={onReset} className="w-full py-4 flex items-center gap-4"><div className="w-5 h-5 text-red-500"><Icons.Trash/></div><span className="text-red-500">ƒê·∫∑t l·∫°i d·ªØ li·ªáu</span></button></div>
            </div>
            {showMembership&&<MembershipModal onClose={()=>setShowMembership(false)} onSelectPlan={handleSelectPlan} currentPlan={membership?.plan}/>}
            {selectedPlan&&<PaymentModal plan={selectedPlan} onClose={()=>setSelectedPlan(null)} onSuccess={handlePaymentSuccess}/>}
        </div>
    );
};

// ============ TAB BAR ============
const TabBar=({activeTab,onTabChange})=>{
    const tabs=[{id:'home',I:Icons.Home,l:'Trang ch·ªß'},{id:'calendar',I:Icons.Calendar,l:'L·ªãch'},{id:'news',I:Icons.Newspaper,l:'Tin t·ª©c'},{id:'support',I:Icons.Headphones,l:'H·ªó tr·ª£'},{id:'settings',I:Icons.Settings,l:'C√†i ƒë·∫∑t'}];
    return<div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex safe-bottom z-40 max-w-lg mx-auto">{tabs.map(t=><button key={t.id} onClick={()=>onTabChange(t.id)} className={`flex-1 py-3 flex flex-col items-center gap-1 transition-colors ${activeTab===t.id?'text-navy-700':'text-gray-400'}`}><div className="w-6 h-6"><t.I/></div><span className="text-xs font-medium">{t.l}</span></button>)}</div>;
};

// ============ MAIN APP ============
function App(){
    const[screen,setScreen]=useState('splash');
    const[tab,setTab]=useState('home');
    const[selEvent,setSelEvent]=useState(null);
    const[events,setEvents]=useState([]);
    const[newsData,setNewsData]=useState([]);
    const[provinces,setProvinces]=useState([]);
    const[agencies,setAgencies]=useState([]);
    const[businesses,setBusinesses]=useState([]);
    const[checklistState,setChecklistState]=useState(()=>{const s=localStorage.getItem('checklistState');return s?JSON.parse(s):{};});
    const[businessProfile,setBusinessProfile]=useState(()=>{const s=localStorage.getItem('businessProfile');return s?JSON.parse(s):{};});
    const[membership,setMembership]=useState(()=>{const s=localStorage.getItem('membership');return s?JSON.parse(s):{plan:'free'};});
    const[userEvents,setUserEvents]=useState(()=>{const s=localStorage.getItem('userEvents');return s?JSON.parse(s):[];});

    useEffect(()=>{localStorage.setItem('checklistState',JSON.stringify(checklistState));},[checklistState]);
    useEffect(()=>{localStorage.setItem('businessProfile',JSON.stringify(businessProfile));},[businessProfile]);
    useEffect(()=>{localStorage.setItem('membership',JSON.stringify(membership));},[membership]);
    useEffect(()=>{localStorage.setItem('userEvents',JSON.stringify(userEvents));},[userEvents]);

    useEffect(()=>{
        const fetchData=async()=>{
            try{
                const[evRes,newsRes,provRes,agRes,bizRes]=await Promise.all([fetch(API+'/events'),fetch(API+'/news'),fetch(API+'/provinces'),fetch(API+'/agencies'),fetch(API+'/businesses').catch(()=>({json:()=>({success:true,data:[]})}))]);
                const evData=await evRes.json();const newsDataJson=await newsRes.json();const provData=await provRes.json();const agData=await agRes.json();const bizData=await bizRes.json();
                if(evData.success)setEvents(evData.data.map(e=>({...e,completed:false})));
                if(newsDataJson.success)setNewsData(newsDataJson.data);
                if(provData.success)setProvinces(provData.data);
                if(agData.success)setAgencies(agData.data);
                if(bizData.success)setBusinesses(bizData.data);
            }catch(err){console.error('Error:',err);}
        };
        fetchData();
    },[]);

    const toggleEvent=id=>{setEvents(events.map(e=>e.id===id?{...e,completed:!e.completed}:e));setSelEvent(p=>p&&p.id===id?{...p,completed:!p.completed}:p);};
    const handleChecklistChange=(eventId,completedSteps)=>{setChecklistState(prev=>({...prev,[eventId]:completedSteps}));};
    const reset=()=>{localStorage.clear();window.location.reload();};
    const handleUpgradeMembership=(plan)=>{setMembership({plan});if(plan!=='free'&&businessProfile?.companyName){setBusinesses(prev=>[...prev.filter(b=>b.id!==businessProfile.id),{...businessProfile,id:businessProfile.id||Date.now(),isPro:true}]);}};
    const addUserEvent=(ev)=>{setUserEvents(prev=>[...prev,ev]);};
    const deleteUserEvent=(id)=>{setUserEvents(prev=>prev.filter(e=>e.id!==id));};

    return(
        <div className="h-full w-full max-w-lg mx-auto bg-gray-50 relative overflow-hidden">
            {screen==='splash'&&<SplashScreen onFinish={()=>setScreen('main')}/>}
            {screen==='main'&&<>
                {tab==='home'&&<DashboardScreen events={events} news={newsData} onEventClick={setSelEvent} onNewsClick={n=>setTab('news')} membership={membership} businessProfile={businessProfile}/>}
                {tab==='calendar'&&<CalendarScreen events={events} onEventClick={setSelEvent} userEvents={userEvents} onAddUserEvent={addUserEvent} onDeleteUserEvent={deleteUserEvent}/>}
                {tab==='news'&&<NewsScreen newsData={newsData}/>}
                {tab==='support'&&<SupportScreen provinces={provinces} agencies={agencies} businesses={businesses} membership={membership}/>}
                {tab==='settings'&&<SettingsScreen onReset={reset} businessProfile={businessProfile} onUpdateProfile={setBusinessProfile} membership={membership} onUpgradeMembership={handleUpgradeMembership}/>}
                <TabBar activeTab={tab} onTabChange={setTab}/>
                {selEvent&&<EventDetailModal event={selEvent} onClose={()=>setSelEvent(null)} onToggle={toggleEvent} checklistState={checklistState} onChecklistChange={handleChecklistChange}/>}
            </>}
        </div>
    );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
