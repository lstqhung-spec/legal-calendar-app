<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTIC Legal Calendar - Admin v15</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3B82F6;
      --primary-dark: #2563EB;
      --success: #10B981;
      --warning: #F97316;
      --danger: #EF4444;
      --sidebar-width: 260px;
    }
    body { background: #F1F5F9; font-family: 'Segoe UI', system-ui, sans-serif; }
    .sidebar {
      position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-width);
      background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
      padding: 20px 0; z-index: 1000; overflow-y: auto;
    }
    .sidebar-brand {
      padding: 0 20px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 20px; text-align: center;
    }
    .sidebar-brand h4 { color: #fff; font-weight: 700; margin: 0; font-size: 18px; }
    .sidebar-brand small { color: #94A3B8; font-size: 11px; }
    .nav-item { padding: 3px 15px; }
    .nav-link {
      color: #CBD5E1; padding: 12px 15px; border-radius: 10px;
      display: flex; align-items: center; gap: 12px; font-weight: 500;
      transition: all 0.2s;
    }
    .nav-link:hover, .nav-link.active { background: var(--primary); color: #fff; }
    .nav-link i { font-size: 18px; width: 24px; text-align: center; }
    .nav-link .badge { margin-left: auto; }
    .main-content { margin-left: var(--sidebar-width); padding: 30px; }
    .page-header { margin-bottom: 25px; }
    .page-header h2 { font-weight: 700; color: #1E293B; margin: 0; }
    .card { border: none; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .card-header { background: #fff; border-bottom: 1px solid #E2E8F0; padding: 16px 20px; border-radius: 16px 16px 0 0 !important; }
    .card-header h5 { margin: 0; font-weight: 600; color: #1E293B; }
    .stat-card { border-radius: 16px; padding: 20px; color: #fff; }
    .stat-card.events { background: linear-gradient(135deg, #3B82F6, #60A5FA); }
    .stat-card.news { background: linear-gradient(135deg, #10B981, #34D399); }
    .stat-card.orgs { background: linear-gradient(135deg, #F97316, #FB923C); }
    .stat-card.requests { background: linear-gradient(135deg, #EF4444, #F87171); }
    .stat-card .stat-icon { font-size: 40px; opacity: 0.3; position: absolute; right: 20px; top: 20px; }
    .stat-card .stat-value { font-size: 32px; font-weight: 700; }
    .stat-card .stat-label { opacity: 0.9; font-size: 14px; }
    .table th { font-weight: 600; color: #475569; font-size: 13px; text-transform: uppercase; }
    .table td { vertical-align: middle; }
    .btn-action { padding: 6px 10px; font-size: 14px; }
    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .status-pending { background: #FEF3C7; color: #D97706; }
    .status-processing { background: #DBEAFE; color: #2563EB; }
    .status-completed { background: #D1FAE5; color: #059669; }
    .status-cancelled { background: #FEE2E2; color: #DC2626; }
    .category-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; }
    .form-label { font-weight: 600; color: #475569; font-size: 13px; }
    .form-control:focus, .form-select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59,130,246,0.15); }
    .modal-header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: #fff; }
    .modal-header .btn-close { filter: brightness(0) invert(1); }
    .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #3B82F6, #1E40AF); }
    .login-card { background: #fff; border-radius: 20px; padding: 40px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .login-card h3 { font-weight: 700; color: #1E293B; }
    /* Rich Text Editor */
    .editor-toolbar { background: #F8FAFC; border: 1px solid #E2E8F0; border-bottom: none; border-radius: 8px 8px 0 0; padding: 8px; display: flex; gap: 5px; flex-wrap: wrap; }
    .editor-toolbar button { background: #fff; border: 1px solid #E2E8F0; border-radius: 6px; padding: 6px 10px; cursor: pointer; transition: all 0.2s; }
    .editor-toolbar button:hover { background: var(--primary); color: #fff; border-color: var(--primary); }
    .editor-toolbar button.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .editor-content { border: 1px solid #E2E8F0; border-radius: 0 0 8px 8px; min-height: 200px; padding: 15px; background: #fff; }
    .editor-content:focus { outline: none; border-color: var(--primary); }
    .priority-high { color: #DC2626; }
    .priority-medium { color: #F97316; }
    .priority-low { color: #10B981; }
    .hidden { display: none !important; }
    @media (max-width: 768px) {
      .sidebar { width: 100%; position: relative; }
      .main-content { margin-left: 0; }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="login-container">
    <div class="login-card text-center">
      <i class="bi bi-shield-lock-fill text-primary" style="font-size: 50px;"></i>
      <h3 class="mt-3 mb-4">HTIC Admin</h3>
      <form id="loginForm">
        <div class="mb-3">
          <input type="text" class="form-control form-control-lg" id="username" placeholder="TÃªn Ä‘Äƒng nháº­p" required>
        </div>
        <div class="mb-4">
          <input type="password" class="form-control form-control-lg" id="password" placeholder="Máº­t kháº©u" required>
        </div>
        <button type="submit" class="btn btn-primary btn-lg w-100">
          <i class="bi bi-box-arrow-in-right me-2"></i>ÄÄƒng nháº­p
        </button>
      </form>
      <p class="text-muted mt-3 mb-0" style="font-size: 12px;">Admin Dashboard v15.0</p>
    </div>
  </div>

  <!-- Main Admin -->
  <div id="adminPanel" class="hidden">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-brand">
        <h4>âš–ï¸ HTIC Admin</h4>
        <small>Legal Calendar v15.0</small>
      </div>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="#" data-page="dashboard"><i class="bi bi-grid-1x2-fill"></i>Tá»•ng quan</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="events"><i class="bi bi-calendar-event-fill"></i>Lá»‹ch phÃ¡p lÃ½</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="news"><i class="bi bi-newspaper"></i>Tin tá»©c</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="organizations"><i class="bi bi-building"></i>CÆ¡ quan tra cá»©u</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="lawyers"><i class="bi bi-person-badge-fill"></i>Luáº­t sÆ° há»— trá»£</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="requests"><i class="bi bi-chat-left-text-fill"></i>YÃªu cáº§u tÆ° váº¥n<span id="pendingBadge" class="badge bg-danger rounded-pill ms-2">0</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-page="settings"><i class="bi bi-gear-fill"></i>CÃ i Ä‘áº·t App</a></li>
        <li class="nav-item mt-4"><a class="nav-link text-danger" href="#" id="logoutBtn"><i class="bi bi-box-arrow-left"></i>ÄÄƒng xuáº¥t</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Page -->
      <div id="page-dashboard" class="page-content">
        <div class="page-header"><h2>ğŸ“Š Tá»•ng quan</h2></div>
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="stat-card events position-relative">
              <i class="bi bi-calendar-event stat-icon"></i>
              <div class="stat-value" id="statEvents">0</div>
              <div class="stat-label">Lá»‹ch phÃ¡p lÃ½</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card news position-relative">
              <i class="bi bi-newspaper stat-icon"></i>
              <div class="stat-value" id="statNews">0</div>
              <div class="stat-label">Tin tá»©c</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card orgs position-relative">
              <i class="bi bi-building stat-icon"></i>
              <div class="stat-value" id="statOrgs">0</div>
              <div class="stat-label">CÆ¡ quan</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card requests position-relative">
              <i class="bi bi-chat-left-text stat-icon"></i>
              <div class="stat-value" id="statRequests">0</div>
              <div class="stat-label">YÃªu cáº§u chá» xá»­ lÃ½</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><h5>ğŸ“Œ HÆ°á»›ng dáº«n sá»­ dá»¥ng</h5></div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="text-primary"><i class="bi bi-calendar-event me-2"></i>Lá»‹ch phÃ¡p lÃ½</h6>
                <p class="text-muted">Quáº£n lÃ½ cÃ¡c nghÄ©a vá»¥ phÃ¡p lÃ½, deadline vá»›i Ä‘áº§y Ä‘á»§ thÃ´ng tin: cÄƒn cá»© phÃ¡p lÃ½, má»©c pháº¡t...</p>
                <h6 class="text-success"><i class="bi bi-newspaper me-2"></i>Tin tá»©c</h6>
                <p class="text-muted">ÄÄƒng tin tá»©c phÃ¡p luáº­t vá»›i trÃ¬nh soáº¡n tháº£o há»— trá»£ Ä‘á»‹nh dáº¡ng vÄƒn báº£n.</p>
              </div>
              <div class="col-md-6">
                <h6 class="text-warning"><i class="bi bi-building me-2"></i>CÆ¡ quan tra cá»©u</h6>
                <p class="text-muted">Danh sÃ¡ch cÆ¡ quan nhÃ  nÆ°á»›c, cÃ´ng ty luáº­t, vÄƒn phÃ²ng cÃ´ng chá»©ng...</p>
                <h6 class="text-danger"><i class="bi bi-chat-left-text me-2"></i>YÃªu cáº§u tÆ° váº¥n</h6>
                <p class="text-muted">Xá»­ lÃ½ cÃ¡c yÃªu cáº§u tÆ° váº¥n tá»« ngÆ°á»i dÃ¹ng app.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Events Page -->
      <div id="page-events" class="page-content hidden">
        <div class="page-header d-flex justify-content-between align-items-center">
          <h2>ğŸ“… Quáº£n lÃ½ Lá»‹ch phÃ¡p lÃ½</h2>
          <button class="btn btn-primary" onclick="openEventModal()"><i class="bi bi-plus-lg me-2"></i>ThÃªm má»›i</button>
        </div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>TiÃªu Ä‘á»</th>
                    <th>Danh má»¥c</th>
                    <th>Háº¡n ná»™p</th>
                    <th>Æ¯u tiÃªn</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th width="120">Thao tÃ¡c</th>
                  </tr>
                </thead>
                <tbody id="eventsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- News Page -->
      <div id="page-news" class="page-content hidden">
        <div class="page-header d-flex justify-content-between align-items-center">
          <h2>ğŸ“° Quáº£n lÃ½ Tin tá»©c</h2>
          <div>
            <button class="btn btn-warning me-2" onclick="cleanNewsHtml()"><i class="bi bi-magic me-2"></i>Clean HTML</button>
            <button class="btn btn-primary" onclick="openNewsModal()"><i class="bi bi-plus-lg me-2"></i>ThÃªm tin má»›i</button>
          </div>
        </div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>TiÃªu Ä‘á»</th>
                    <th>Danh má»¥c</th>
                    <th>NgÃ y Ä‘Äƒng</th>
                    <th>Ná»•i báº­t</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th width="120">Thao tÃ¡c</th>
                  </tr>
                </thead>
                <tbody id="newsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Organizations Page -->
      <div id="page-organizations" class="page-content hidden">
        <div class="page-header d-flex justify-content-between align-items-center">
          <h2>ğŸ¢ Quáº£n lÃ½ CÆ¡ quan tra cá»©u</h2>
          <button class="btn btn-primary" onclick="openOrgModal()"><i class="bi bi-plus-lg me-2"></i>ThÃªm má»›i</button>
        </div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>TÃªn cÆ¡ quan</th>
                    <th>Loáº¡i</th>
                    <th>Äá»‹a chá»‰</th>
                    <th>Äiá»‡n thoáº¡i</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th width="120">Thao tÃ¡c</th>
                  </tr>
                </thead>
                <tbody id="orgsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Lawyers Page -->
      <div id="page-lawyers" class="page-content hidden">
        <div class="page-header d-flex justify-content-between align-items-center">
          <h2>ğŸ‘¨â€âš–ï¸ Quáº£n lÃ½ Luáº­t sÆ° há»— trá»£</h2>
          <button class="btn btn-primary" onclick="openLawyerModal()"><i class="bi bi-plus-lg me-2"></i>ThÃªm má»›i</button>
        </div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Há» tÃªn</th>
                    <th>Chá»©c danh</th>
                    <th>CÃ´ng ty</th>
                    <th>Äiá»‡n thoáº¡i</th>
                    <th>Online</th>
                    <th width="120">Thao tÃ¡c</th>
                  </tr>
                </thead>
                <tbody id="lawyersTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Support Requests Page -->
      <div id="page-requests" class="page-content hidden">
        <div class="page-header"><h2>ğŸ’¬ YÃªu cáº§u tÆ° váº¥n tá»« ngÆ°á»i dÃ¹ng</h2></div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Há» tÃªn</th>
                    <th>LiÃªn há»‡</th>
                    <th>Ná»™i dung</th>
                    <th>NgÃ y gá»­i</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th width="140">Thao tÃ¡c</th>
                  </tr>
                </thead>
                <tbody id="requestsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="page-settings" class="page-content hidden">
        <div class="page-header"><h2>âš™ï¸ CÃ i Ä‘áº·t á»©ng dá»¥ng</h2></div>
        <div class="row">
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-header"><h5><i class="bi bi-app me-2"></i>ThÃ´ng tin á»©ng dá»¥ng</h5></div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">TÃªn á»©ng dá»¥ng</label>
                  <input type="text" class="form-control" id="setting_app_name">
                </div>
                <div class="mb-3">
                  <label class="form-label">PhiÃªn báº£n</label>
                  <input type="text" class="form-control" id="setting_app_version">
                </div>
                <div class="mb-3">
                  <label class="form-label">URL Logo (Ä‘á»ƒ trá»‘ng náº¿u dÃ¹ng máº·c Ä‘á»‹nh)</label>
                  <input type="text" class="form-control" id="setting_app_logo" placeholder="https://example.com/logo.png">
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><h5><i class="bi bi-clock me-2"></i>Giá» lÃ m viá»‡c</h5></div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">NgÃ y lÃ m viá»‡c</label>
                  <input type="text" class="form-control" id="setting_working_days">
                </div>
                <div class="mb-3">
                  <label class="form-label">Giá» lÃ m viá»‡c</label>
                  <input type="text" class="form-control" id="setting_working_hours">
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-header"><h5><i class="bi bi-building me-2"></i>ThÃ´ng tin cÃ´ng ty</h5></div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">TÃªn cÃ´ng ty</label>
                  <input type="text" class="form-control" id="setting_company_name">
                </div>
                <div class="mb-3">
                  <label class="form-label">Slogan</label>
                  <input type="text" class="form-control" id="setting_company_slogan">
                </div>
                <div class="mb-3">
                  <label class="form-label">Äá»‹a chá»‰</label>
                  <input type="text" class="form-control" id="setting_address">
                </div>
              </div>
            </div>
            <div class="card mb-4">
              <div class="card-header"><h5><i class="bi bi-telephone me-2"></i>ThÃ´ng tin liÃªn há»‡</h5></div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">Hotline</label>
                  <input type="text" class="form-control" id="setting_hotline">
                </div>
                <div class="mb-3">
                  <label class="form-label">Email liÃªn há»‡</label>
                  <input type="email" class="form-control" id="setting_contact_email">
                </div>
                <div class="mb-3">
                  <label class="form-label">Link Zalo</label>
                  <input type="text" class="form-control" id="setting_zalo_link">
                </div>
                <div class="mb-3">
                  <label class="form-label">Website</label>
                  <input type="text" class="form-control" id="setting_website">
                </div>
                <div class="mb-3">
                  <label class="form-label">Facebook</label>
                  <input type="text" class="form-control" id="setting_facebook">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card mb-4">
          <div class="card-header"><h5><i class="bi bi-info-circle me-2"></i>Giá»›i thiá»‡u cÃ´ng ty</h5></div>
          <div class="card-body">
            <textarea class="form-control" id="setting_about_content" rows="4"></textarea>
          </div>
        </div>
        <button class="btn btn-primary btn-lg" onclick="saveSettings()"><i class="bi bi-save me-2"></i>LÆ°u cÃ i Ä‘áº·t</button>
      </div>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventModalTitle">ThÃªm lá»‹ch phÃ¡p lÃ½</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="eventId">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">TiÃªu Ä‘á» *</label>
              <input type="text" class="form-control" id="eventTitle" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Danh má»¥c</label>
              <select class="form-select" id="eventCategory">
                <option value="tax">Thuáº¿</option>
                <option value="labor">Lao Ä‘á»™ng</option>
                <option value="insurance">Báº£o hiá»ƒm</option>
                <option value="finance">TÃ i chÃ­nh</option>
                <option value="investment">Äáº§u tÆ°</option>
                <option value="other">KhÃ¡c</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Háº¡n ná»™p *</label>
              <input type="date" class="form-control" id="eventDeadline" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Má»©c Æ°u tiÃªn</label>
              <select class="form-select" id="eventPriority">
                <option value="high">Cao</option>
                <option value="medium" selected>Trung bÃ¬nh</option>
                <option value="low">Tháº¥p</option>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Táº§n suáº¥t</label>
              <select class="form-select" id="eventFrequency">
                <option value="">Má»™t láº§n</option>
                <option value="monthly">HÃ ng thÃ¡ng</option>
                <option value="quarterly">HÃ ng quÃ½</option>
                <option value="yearly">HÃ ng nÄƒm</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">MÃ´ táº£ chi tiáº¿t</label>
            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">CÄƒn cá»© phÃ¡p lÃ½</label>
            <input type="text" class="form-control" id="eventLegalBasis" placeholder="VD: ThÃ´ng tÆ° 80/2021/TT-BTC">
          </div>
          <div class="mb-3">
            <label class="form-label">Má»©c pháº¡t vi pháº¡m</label>
            <textarea class="form-control" id="eventPenalty" rows="2" placeholder="VD: Pháº¡t cháº­m ná»™p 0.03%/ngÃ y"></textarea>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Ãp dá»¥ng cho</label>
              <select class="form-select" id="eventAppliesTo">
                <option value="business">Doanh nghiá»‡p</option>
                <option value="individual">CÃ¡ nhÃ¢n</option>
                <option value="both">Cáº£ hai</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Nháº¯c trÆ°á»›c (ngÃ y)</label>
              <input type="number" class="form-control" id="eventReminderDays" value="7">
            </div>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="eventActive" checked>
            <label class="form-check-label" for="eventActive">KÃ­ch hoáº¡t</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
          <button type="button" class="btn btn-primary" onclick="saveEvent()"><i class="bi bi-save me-2"></i>LÆ°u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- News Modal -->
  <div class="modal fade" id="newsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="newsModalTitle">ThÃªm tin tá»©c</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="newsId">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">TiÃªu Ä‘á» *</label>
              <input type="text" class="form-control" id="newsTitle" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Danh má»¥c</label>
              <select class="form-select" id="newsCategory">
                <option value="tax">Thuáº¿</option>
                <option value="labor">Lao Ä‘á»™ng</option>
                <option value="insurance">Báº£o hiá»ƒm</option>
                <option value="investment">Äáº§u tÆ°</option>
                <option value="general">Tin chung</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">TÃ³m táº¯t</label>
            <textarea class="form-control" id="newsSummary" rows="2"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Ná»™i dung chi tiáº¿t</label>
            <div class="editor-toolbar">
              <button type="button" onclick="formatText('bold')" title="In Ä‘áº­m"><i class="bi bi-type-bold"></i></button>
              <button type="button" onclick="formatText('italic')" title="In nghiÃªng"><i class="bi bi-type-italic"></i></button>
              <button type="button" onclick="formatText('underline')" title="Gáº¡ch dÆ°á»›i"><i class="bi bi-type-underline"></i></button>
              <button type="button" onclick="formatText('strikeThrough')" title="Gáº¡ch ngang"><i class="bi bi-type-strikethrough"></i></button>
              <span class="mx-2 border-start"></span>
              <button type="button" onclick="formatText('insertUnorderedList')" title="Danh sÃ¡ch"><i class="bi bi-list-ul"></i></button>
              <button type="button" onclick="formatText('insertOrderedList')" title="Danh sÃ¡ch sá»‘"><i class="bi bi-list-ol"></i></button>
              <span class="mx-2 border-start"></span>
              <button type="button" onclick="formatText('justifyLeft')" title="CÄƒn trÃ¡i"><i class="bi bi-text-left"></i></button>
              <button type="button" onclick="formatText('justifyCenter')" title="CÄƒn giá»¯a"><i class="bi bi-text-center"></i></button>
              <button type="button" onclick="formatText('justifyRight')" title="CÄƒn pháº£i"><i class="bi bi-text-right"></i></button>
            </div>
            <div class="editor-content" id="newsContent" contenteditable="true"></div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">URL HÃ¬nh áº£nh</label>
              <input type="text" class="form-control" id="newsImageUrl" placeholder="https://example.com/image.jpg">
            </div>
            <div class="col-md-3 mb-3">
              <label class="form-label">Nguá»“n</label>
              <input type="text" class="form-control" id="newsSource">
            </div>
            <div class="col-md-3 mb-3">
              <label class="form-label">NgÃ y Ä‘Äƒng</label>
              <input type="datetime-local" class="form-control" id="newsPublishedAt">
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="newsFeatured">
                <label class="form-check-label" for="newsFeatured">Tin ná»•i báº­t</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="newsActive" checked>
                <label class="form-check-label" for="newsActive">KÃ­ch hoáº¡t</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
          <button type="button" class="btn btn-primary" onclick="saveNews()"><i class="bi bi-save me-2"></i>LÆ°u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Organization Modal -->
  <div class="modal fade" id="orgModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="orgModalTitle">ThÃªm cÆ¡ quan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="orgId">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">TÃªn cÆ¡ quan *</label>
              <input type="text" class="form-control" id="orgName" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Loáº¡i cÆ¡ quan</label>
              <select class="form-select" id="orgCategory">
                <option value="government">CÆ¡ quan nhÃ  nÆ°á»›c</option>
                <option value="lawfirm">CÃ´ng ty luáº­t</option>
                <option value="notary">VÄƒn phÃ²ng cÃ´ng chá»©ng</option>
                <option value="bailiff">Thá»«a phÃ¡t láº¡i</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Loáº¡i chi tiáº¿t</label>
              <select class="form-select" id="orgTypeId"></select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Tá»‰nh/ThÃ nh phá»‘</label>
              <select class="form-select" id="orgProvinceId"></select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Äá»‹a chá»‰</label>
            <input type="text" class="form-control" id="orgAddress">
          </div>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Äiá»‡n thoáº¡i</label>
              <input type="text" class="form-control" id="orgPhone">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="orgEmail">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Website</label>
              <input type="text" class="form-control" id="orgWebsite">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Giá» lÃ m viá»‡c</label>
            <input type="text" class="form-control" id="orgWorkingHours" placeholder="VD: 7:30 - 16:30">
          </div>
          <div class="mb-3">
            <label class="form-label">MÃ´ táº£ / Dá»‹ch vá»¥</label>
            <textarea class="form-control" id="orgDescription" rows="2"></textarea>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="orgActive" checked>
            <label class="form-check-label" for="orgActive">KÃ­ch hoáº¡t</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
          <button type="button" class="btn btn-primary" onclick="saveOrg()"><i class="bi bi-save me-2"></i>LÆ°u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lawyer Modal -->
  <div class="modal fade" id="lawyerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="lawyerModalTitle">ThÃªm luáº­t sÆ°</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="lawyerId">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Há» tÃªn *</label>
              <input type="text" class="form-control" id="lawyerName" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Chá»©c danh</label>
              <input type="text" class="form-control" id="lawyerTitle" placeholder="VD: Luáº­t sÆ° Ä‘iá»u hÃ nh">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">CÃ´ng ty</label>
            <input type="text" class="form-control" id="lawyerCompany">
          </div>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Äiá»‡n thoáº¡i</label>
              <input type="text" class="form-control" id="lawyerPhone">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Zalo</label>
              <input type="text" class="form-control" id="lawyerZalo">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="lawyerEmail">
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Giá» lÃ m viá»‡c</label>
              <input type="text" class="form-control" id="lawyerWorkingHours" placeholder="VD: 8:00 - 18:00">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">NgÃ y lÃ m viá»‡c</label>
              <input type="text" class="form-control" id="lawyerWorkingDays" placeholder="VD: Thá»© 2 - Thá»© 6">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">ChuyÃªn mÃ´n</label>
            <input type="text" class="form-control" id="lawyerSpecialization" placeholder="VD: Thuáº¿, M&A, Lao Ä‘á»™ng">
          </div>
          <div class="mb-3">
            <label class="form-label">Giá»›i thiá»‡u</label>
            <textarea class="form-control" id="lawyerBio" rows="2"></textarea>
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="lawyerOnline" checked>
                <label class="form-check-label" for="lawyerOnline">Äang online</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="lawyerPrimary">
                <label class="form-check-label" for="lawyerPrimary">Luáº­t sÆ° chÃ­nh</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="lawyerActive" checked>
                <label class="form-check-label" for="lawyerActive">KÃ­ch hoáº¡t</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
          <button type="button" class="btn btn-primary" onclick="saveLawyer()"><i class="bi bi-save me-2"></i>LÆ°u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Request Detail Modal -->
  <div class="modal fade" id="requestModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Chi tiáº¿t yÃªu cáº§u tÆ° váº¥n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="requestId">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label text-muted">Há» tÃªn</label>
              <p class="fw-bold" id="requestName"></p>
            </div>
            <div class="col-md-6">
              <label class="form-label text-muted">CÃ´ng ty</label>
              <p class="fw-bold" id="requestCompany"></p>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label text-muted">Äiá»‡n thoáº¡i</label>
              <p class="fw-bold" id="requestPhone"></p>
            </div>
            <div class="col-md-6">
              <label class="form-label text-muted">Email</label>
              <p class="fw-bold" id="requestEmail"></p>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label text-muted">Ná»™i dung yÃªu cáº§u</label>
            <div class="p-3 bg-light rounded" id="requestMessage"></div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Tráº¡ng thÃ¡i</label>
              <select class="form-select" id="requestStatus">
                <option value="pending">Chá» xá»­ lÃ½</option>
                <option value="processing">Äang xá»­ lÃ½</option>
                <option value="completed">ÄÃ£ hoÃ n thÃ nh</option>
                <option value="cancelled">ÄÃ£ há»§y</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">NgÆ°á»i xá»­ lÃ½</label>
              <input type="text" class="form-control" id="requestAssignedTo">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Ghi chÃº ná»™i bá»™</label>
            <textarea class="form-control" id="requestNotes" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÄÃ³ng</button>
          <button type="button" class="btn btn-primary" onclick="saveRequest()"><i class="bi bi-save me-2"></i>Cáº­p nháº­t</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GLOBAL VARIABLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let authHeader = '';
    let orgTypes = [];
    let provinces = [];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTHENTICATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      authHeader = 'Basic ' + btoa(username + ':' + password);
      
      try {
        const res = await fetch('/api/admin/stats', { headers: { 'Authorization': authHeader } });
        if (res.ok) {
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('adminPanel').classList.remove('hidden');
          loadDashboard();
          loadOrgTypes();
          loadProvinces();
        } else {
          alert('Sai tÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u!');
        }
      } catch (err) {
        alert('Lá»—i káº¿t ná»‘i server!');
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      authHeader = '';
      document.getElementById('adminPanel').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAVIGATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.querySelectorAll('.nav-link[data-page]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = link.dataset.page;
        
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + page).classList.remove('hidden');
        
        switch(page) {
          case 'dashboard': loadDashboard(); break;
          case 'events': loadEvents(); break;
          case 'news': loadNews(); break;
          case 'organizations': loadOrganizations(); break;
          case 'lawyers': loadLawyers(); break;
          case 'requests': loadRequests(); break;
          case 'settings': loadSettings(); break;
        }
      });
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // API HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function api(url, options = {}) {
      const res = await fetch(url, {
        ...options,
        headers: { 'Authorization': authHeader, 'Content-Type': 'application/json', ...options.headers }
      });
      return res.json();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DASHBOARD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadDashboard() {
      const data = await api('/api/admin/stats');
      if (data.success) {
        document.getElementById('statEvents').textContent = data.data.events;
        document.getElementById('statNews').textContent = data.data.news;
        document.getElementById('statOrgs').textContent = data.data.organizations;
        document.getElementById('statRequests').textContent = data.data.pendingRequests;
        document.getElementById('pendingBadge').textContent = data.data.pendingRequests;
      }
    }

    async function loadOrgTypes() {
      const data = await api('/api/admin/org-types');
      if (data.success) {
        orgTypes = data.data;
        updateOrgTypeSelect();
      }
    }

    async function loadProvinces() {
      const data = await api('/api/admin/provinces');
      if (data.success) {
        provinces = data.data;
        updateProvinceSelect();
      }
    }

    function updateOrgTypeSelect() {
      const sel = document.getElementById('orgTypeId');
      sel.innerHTML = '<option value="">-- Chá»n loáº¡i --</option>' + 
        orgTypes.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
    }

    function updateProvinceSelect() {
      const sel = document.getElementById('orgProvinceId');
      sel.innerHTML = '<option value="">-- Chá»n tá»‰nh/TP --</option>' + 
        provinces.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadEvents() {
      const data = await api('/api/admin/events');
      const tbody = document.getElementById('eventsTable');
      if (data.success) {
        tbody.innerHTML = data.data.map(e => `
          <tr>
            <td><strong>${e.title}</strong></td>
            <td><span class="category-badge" style="background: ${getCategoryColor(e.category)}20; color: ${getCategoryColor(e.category)}">${getCategoryName(e.category)}</span></td>
            <td>${formatDate(e.deadline)}</td>
            <td><span class="priority-${e.priority}">${getPriorityName(e.priority)}</span></td>
            <td>${e.is_active ? '<span class="badge bg-success">Hoáº¡t Ä‘á»™ng</span>' : '<span class="badge bg-secondary">Táº¯t</span>'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary btn-action" onclick="editEvent(${e.id})"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteEvent(${e.id})"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        `).join('');
      }
    }

    function openEventModal(id = null) {
      document.getElementById('eventId').value = '';
      document.getElementById('eventTitle').value = '';
      document.getElementById('eventCategory').value = 'tax';
      document.getElementById('eventDeadline').value = '';
      document.getElementById('eventPriority').value = 'medium';
      document.getElementById('eventFrequency').value = '';
      document.getElementById('eventDescription').value = '';
      document.getElementById('eventLegalBasis').value = '';
      document.getElementById('eventPenalty').value = '';
      document.getElementById('eventAppliesTo').value = 'business';
      document.getElementById('eventReminderDays').value = '7';
      document.getElementById('eventActive').checked = true;
      document.getElementById('eventModalTitle').textContent = 'ThÃªm lá»‹ch phÃ¡p lÃ½';
      new bootstrap.Modal(document.getElementById('eventModal')).show();
    }

    async function editEvent(id) {
      const data = await api('/api/admin/events');
      const event = data.data.find(e => e.id === id);
      if (event) {
        document.getElementById('eventId').value = event.id;
        document.getElementById('eventTitle').value = event.title || '';
        document.getElementById('eventCategory').value = event.category || 'tax';
        document.getElementById('eventDeadline').value = event.deadline?.split('T')[0] || '';
        document.getElementById('eventPriority').value = event.priority || 'medium';
        document.getElementById('eventFrequency').value = event.frequency || '';
        document.getElementById('eventDescription').value = event.description || '';
        document.getElementById('eventLegalBasis').value = event.legal_basis || '';
        document.getElementById('eventPenalty').value = event.penalty || '';
        document.getElementById('eventAppliesTo').value = event.applies_to || 'business';
        document.getElementById('eventReminderDays').value = event.reminder_days || 7;
        document.getElementById('eventActive').checked = event.is_active;
        document.getElementById('eventModalTitle').textContent = 'Sá»­a lá»‹ch phÃ¡p lÃ½';
        new bootstrap.Modal(document.getElementById('eventModal')).show();
      }
    }

    async function saveEvent() {
      const id = document.getElementById('eventId').value;
      const data = {
        title: document.getElementById('eventTitle').value,
        category: document.getElementById('eventCategory').value,
        deadline: document.getElementById('eventDeadline').value,
        priority: document.getElementById('eventPriority').value,
        frequency: document.getElementById('eventFrequency').value,
        description: document.getElementById('eventDescription').value,
        legal_basis: document.getElementById('eventLegalBasis').value,
        penalty: document.getElementById('eventPenalty').value,
        applies_to: document.getElementById('eventAppliesTo').value,
        reminder_days: parseInt(document.getElementById('eventReminderDays').value) || 7,
        is_active: document.getElementById('eventActive').checked
      };
      
      const url = id ? `/api/admin/events/${id}` : '/api/admin/events';
      const method = id ? 'PUT' : 'POST';
      await api(url, { method, body: JSON.stringify(data) });
      bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
      loadEvents();
    }

    async function deleteEvent(id) {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) {
        await api(`/api/admin/events/${id}`, { method: 'DELETE' });
        loadEvents();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NEWS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadNews() {
      const data = await api('/api/admin/news');
      const tbody = document.getElementById('newsTable');
      if (data.success) {
        tbody.innerHTML = data.data.map(n => `
          <tr>
            <td><strong>${n.title}</strong></td>
            <td><span class="category-badge" style="background: ${getCategoryColor(n.category)}20; color: ${getCategoryColor(n.category)}">${getCategoryName(n.category)}</span></td>
            <td>${formatDateTime(n.published_at)}</td>
            <td>${n.is_featured ? '<i class="bi bi-star-fill text-warning"></i>' : ''}</td>
            <td>${n.is_active ? '<span class="badge bg-success">Hoáº¡t Ä‘á»™ng</span>' : '<span class="badge bg-secondary">Táº¯t</span>'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary btn-action" onclick="editNews(${n.id})"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteNews(${n.id})"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        `).join('');
      }
    }

    function openNewsModal() {
      document.getElementById('newsId').value = '';
      document.getElementById('newsTitle').value = '';
      document.getElementById('newsCategory').value = 'general';
      document.getElementById('newsSummary').value = '';
      document.getElementById('newsContent').innerHTML = '';
      document.getElementById('newsImageUrl').value = '';
      document.getElementById('newsSource').value = '';
      document.getElementById('newsPublishedAt').value = new Date().toISOString().slice(0, 16);
      document.getElementById('newsFeatured').checked = false;
      document.getElementById('newsActive').checked = true;
      document.getElementById('newsModalTitle').textContent = 'ThÃªm tin tá»©c';
      new bootstrap.Modal(document.getElementById('newsModal')).show();
    }

    async function editNews(id) {
      const data = await api('/api/admin/news');
      const news = data.data.find(n => n.id === id);
      if (news) {
        document.getElementById('newsId').value = news.id;
        document.getElementById('newsTitle').value = news.title || '';
        document.getElementById('newsCategory').value = news.category || 'general';
        document.getElementById('newsSummary').value = news.summary || '';
        document.getElementById('newsContent').innerHTML = news.content || '';
        document.getElementById('newsImageUrl').value = news.image_url || '';
        document.getElementById('newsSource').value = news.source || '';
        document.getElementById('newsPublishedAt').value = news.published_at?.slice(0, 16) || '';
        document.getElementById('newsFeatured').checked = news.is_featured;
        document.getElementById('newsActive').checked = news.is_active;
        document.getElementById('newsModalTitle').textContent = 'Sá»­a tin tá»©c';
        new bootstrap.Modal(document.getElementById('newsModal')).show();
      }
    }

    async function saveNews() {
      const id = document.getElementById('newsId').value;
      const data = {
        title: document.getElementById('newsTitle').value,
        category: document.getElementById('newsCategory').value,
        summary: document.getElementById('newsSummary').value,
        content: document.getElementById('newsContent').innerHTML,
        image_url: document.getElementById('newsImageUrl').value,
        source: document.getElementById('newsSource').value,
        published_at: document.getElementById('newsPublishedAt').value,
        is_featured: document.getElementById('newsFeatured').checked,
        is_active: document.getElementById('newsActive').checked
      };
      
      const url = id ? `/api/admin/news/${id}` : '/api/admin/news';
      const method = id ? 'PUT' : 'POST';
      await api(url, { method, body: JSON.stringify(data) });
      bootstrap.Modal.getInstance(document.getElementById('newsModal')).hide();
      loadNews();
    }

    async function deleteNews(id) {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) {
        await api(`/api/admin/news/${id}`, { method: 'DELETE' });
        loadNews();
      }
    }

    // Clean HTML tá»« táº¥t cáº£ tin tá»©c trong database
    async function cleanNewsHtml() {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n clean HTML tá»« táº¥t cáº£ tin tá»©c?\n\nThao tÃ¡c nÃ y sáº½ loáº¡i bá» táº¥t cáº£ HTML tags vÃ  chá»‰ giá»¯ láº¡i ná»™i dung vÄƒn báº£n thuáº§n.')) {
        return;
      }
      
      try {
        const result = await api('/api/admin/clean-news-html', { method: 'POST' });
        if (result.success) {
          alert(`âœ… ${result.message}`);
          loadNews();
        } else {
          alert('âŒ Lá»—i: ' + result.message);
        }
      } catch (err) {
        alert('âŒ Lá»—i káº¿t ná»‘i: ' + err.message);
      }
    }

    function formatText(command) {
      document.execCommand(command, false, null);
      document.getElementById('newsContent').focus();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ORGANIZATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadOrganizations() {
      const data = await api('/api/admin/organizations');
      const tbody = document.getElementById('orgsTable');
      if (data.success) {
        tbody.innerHTML = data.data.map(o => `
          <tr>
            <td><strong>${o.name}</strong></td>
            <td><span class="badge bg-info">${o.type_name || getOrgCategoryName(o.category)}</span></td>
            <td>${o.address || '-'}</td>
            <td>${o.phone || '-'}</td>
            <td>${o.is_active ? '<span class="badge bg-success">Hoáº¡t Ä‘á»™ng</span>' : '<span class="badge bg-secondary">Táº¯t</span>'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary btn-action" onclick="editOrg(${o.id})"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteOrg(${o.id})"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        `).join('');
      }
    }

    function openOrgModal() {
      document.getElementById('orgId').value = '';
      document.getElementById('orgName').value = '';
      document.getElementById('orgCategory').value = 'government';
      document.getElementById('orgTypeId').value = '';
      document.getElementById('orgProvinceId').value = '';
      document.getElementById('orgAddress').value = '';
      document.getElementById('orgPhone').value = '';
      document.getElementById('orgEmail').value = '';
      document.getElementById('orgWebsite').value = '';
      document.getElementById('orgWorkingHours').value = '';
      document.getElementById('orgDescription').value = '';
      document.getElementById('orgActive').checked = true;
      document.getElementById('orgModalTitle').textContent = 'ThÃªm cÆ¡ quan';
      new bootstrap.Modal(document.getElementById('orgModal')).show();
    }

    async function editOrg(id) {
      const data = await api('/api/admin/organizations');
      const org = data.data.find(o => o.id === id);
      if (org) {
        document.getElementById('orgId').value = org.id;
        document.getElementById('orgName').value = org.name || '';
        document.getElementById('orgCategory').value = org.category || 'government';
        document.getElementById('orgTypeId').value = org.type_id || '';
        document.getElementById('orgProvinceId').value = org.province_id || '';
        document.getElementById('orgAddress').value = org.address || '';
        document.getElementById('orgPhone').value = org.phone || '';
        document.getElementById('orgEmail').value = org.email || '';
        document.getElementById('orgWebsite').value = org.website || '';
        document.getElementById('orgWorkingHours').value = org.working_hours || '';
        document.getElementById('orgDescription').value = org.description || '';
        document.getElementById('orgActive').checked = org.is_active;
        document.getElementById('orgModalTitle').textContent = 'Sá»­a cÆ¡ quan';
        new bootstrap.Modal(document.getElementById('orgModal')).show();
      }
    }

    async function saveOrg() {
      const id = document.getElementById('orgId').value;
      const data = {
        name: document.getElementById('orgName').value,
        category: document.getElementById('orgCategory').value,
        type_id: document.getElementById('orgTypeId').value || null,
        province_id: document.getElementById('orgProvinceId').value || null,
        address: document.getElementById('orgAddress').value,
        phone: document.getElementById('orgPhone').value,
        email: document.getElementById('orgEmail').value,
        website: document.getElementById('orgWebsite').value,
        working_hours: document.getElementById('orgWorkingHours').value,
        description: document.getElementById('orgDescription').value,
        is_active: document.getElementById('orgActive').checked
      };
      
      const url = id ? `/api/admin/organizations/${id}` : '/api/admin/organizations';
      const method = id ? 'PUT' : 'POST';
      await api(url, { method, body: JSON.stringify(data) });
      bootstrap.Modal.getInstance(document.getElementById('orgModal')).hide();
      loadOrganizations();
    }

    async function deleteOrg(id) {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) {
        await api(`/api/admin/organizations/${id}`, { method: 'DELETE' });
        loadOrganizations();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LAWYERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadLawyers() {
      const data = await api('/api/admin/lawyers');
      const tbody = document.getElementById('lawyersTable');
      if (data.success) {
        tbody.innerHTML = data.data.map(l => `
          <tr>
            <td><strong>${l.name}</strong>${l.is_primary ? ' <span class="badge bg-warning">ChÃ­nh</span>' : ''}</td>
            <td>${l.title || '-'}</td>
            <td>${l.company || '-'}</td>
            <td>${l.phone || '-'}</td>
            <td>${l.is_online ? '<span class="badge bg-success">Online</span>' : '<span class="badge bg-secondary">Offline</span>'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary btn-action" onclick="editLawyer(${l.id})"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteLawyer(${l.id})"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        `).join('');
      }
    }

    function openLawyerModal() {
      document.getElementById('lawyerId').value = '';
      document.getElementById('lawyerName').value = '';
      document.getElementById('lawyerTitle').value = '';
      document.getElementById('lawyerCompany').value = '';
      document.getElementById('lawyerPhone').value = '';
      document.getElementById('lawyerZalo').value = '';
      document.getElementById('lawyerEmail').value = '';
      document.getElementById('lawyerWorkingHours').value = '';
      document.getElementById('lawyerWorkingDays').value = '';
      document.getElementById('lawyerSpecialization').value = '';
      document.getElementById('lawyerBio').value = '';
      document.getElementById('lawyerOnline').checked = true;
      document.getElementById('lawyerPrimary').checked = false;
      document.getElementById('lawyerActive').checked = true;
      document.getElementById('lawyerModalTitle').textContent = 'ThÃªm luáº­t sÆ°';
      new bootstrap.Modal(document.getElementById('lawyerModal')).show();
    }

    async function editLawyer(id) {
      const data = await api('/api/admin/lawyers');
      const lawyer = data.data.find(l => l.id === id);
      if (lawyer) {
        document.getElementById('lawyerId').value = lawyer.id;
        document.getElementById('lawyerName').value = lawyer.name || '';
        document.getElementById('lawyerTitle').value = lawyer.title || '';
        document.getElementById('lawyerCompany').value = lawyer.company || '';
        document.getElementById('lawyerPhone').value = lawyer.phone || '';
        document.getElementById('lawyerZalo').value = lawyer.zalo || '';
        document.getElementById('lawyerEmail').value = lawyer.email || '';
        document.getElementById('lawyerWorkingHours').value = lawyer.working_hours || '';
        document.getElementById('lawyerWorkingDays').value = lawyer.working_days || '';
        document.getElementById('lawyerSpecialization').value = lawyer.specialization || '';
        document.getElementById('lawyerBio').value = lawyer.bio || '';
        document.getElementById('lawyerOnline').checked = lawyer.is_online;
        document.getElementById('lawyerPrimary').checked = lawyer.is_primary;
        document.getElementById('lawyerActive').checked = lawyer.is_active;
        document.getElementById('lawyerModalTitle').textContent = 'Sá»­a luáº­t sÆ°';
        new bootstrap.Modal(document.getElementById('lawyerModal')).show();
      }
    }

    async function saveLawyer() {
      const id = document.getElementById('lawyerId').value;
      const data = {
        name: document.getElementById('lawyerName').value,
        title: document.getElementById('lawyerTitle').value,
        company: document.getElementById('lawyerCompany').value,
        phone: document.getElementById('lawyerPhone').value,
        zalo: document.getElementById('lawyerZalo').value,
        email: document.getElementById('lawyerEmail').value,
        working_hours: document.getElementById('lawyerWorkingHours').value,
        working_days: document.getElementById('lawyerWorkingDays').value,
        specialization: document.getElementById('lawyerSpecialization').value,
        bio: document.getElementById('lawyerBio').value,
        is_online: document.getElementById('lawyerOnline').checked,
        is_primary: document.getElementById('lawyerPrimary').checked,
        is_active: document.getElementById('lawyerActive').checked
      };
      
      const url = id ? `/api/admin/lawyers/${id}` : '/api/admin/lawyers';
      const method = id ? 'PUT' : 'POST';
      await api(url, { method, body: JSON.stringify(data) });
      bootstrap.Modal.getInstance(document.getElementById('lawyerModal')).hide();
      loadLawyers();
    }

    async function deleteLawyer(id) {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) {
        await api(`/api/admin/lawyers/${id}`, { method: 'DELETE' });
        loadLawyers();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SUPPORT REQUESTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadRequests() {
      const data = await api('/api/admin/support-requests');
      const tbody = document.getElementById('requestsTable');
      if (data.success) {
        tbody.innerHTML = data.data.map(r => `
          <tr>
            <td><strong>${r.name}</strong></td>
            <td>${r.phone || '-'}<br><small class="text-muted">${r.email || ''}</small></td>
            <td><small>${(r.message || '').substring(0, 60)}...</small></td>
            <td>${formatDateTime(r.created_at)}</td>
            <td><span class="status-badge status-${r.status}">${getStatusName(r.status)}</span></td>
            <td>
              <button class="btn btn-sm btn-outline-primary btn-action" onclick="viewRequest(${r.id})"><i class="bi bi-eye"></i></button>
              <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteRequest(${r.id})"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        `).join('');
      }
    }

    async function viewRequest(id) {
      const data = await api('/api/admin/support-requests');
      const req = data.data.find(r => r.id === id);
      if (req) {
        document.getElementById('requestId').value = req.id;
        document.getElementById('requestName').textContent = req.name || '-';
        document.getElementById('requestCompany').textContent = req.company || '-';
        document.getElementById('requestPhone').textContent = req.phone || '-';
        document.getElementById('requestEmail').textContent = req.email || '-';
        document.getElementById('requestMessage').textContent = req.message || '-';
        document.getElementById('requestStatus').value = req.status || 'pending';
        document.getElementById('requestAssignedTo').value = req.assigned_to || '';
        document.getElementById('requestNotes').value = req.notes || '';
        new bootstrap.Modal(document.getElementById('requestModal')).show();
      }
    }

    async function saveRequest() {
      const id = document.getElementById('requestId').value;
      const data = {
        status: document.getElementById('requestStatus').value,
        assigned_to: document.getElementById('requestAssignedTo').value,
        notes: document.getElementById('requestNotes').value
      };
      
      await api(`/api/admin/support-requests/${id}`, { method: 'PUT', body: JSON.stringify(data) });
      bootstrap.Modal.getInstance(document.getElementById('requestModal')).hide();
      loadRequests();
      loadDashboard();
    }

    async function deleteRequest(id) {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) {
        await api(`/api/admin/support-requests/${id}`, { method: 'DELETE' });
        loadRequests();
        loadDashboard();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SETTINGS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadSettings() {
      const data = await api('/api/admin/settings');
      if (data.success) {
        data.data.forEach(s => {
          const el = document.getElementById('setting_' + s.key);
          if (el) el.value = s.value || '';
        });
      }
    }

    async function saveSettings() {
      const settings = {};
      const keys = ['app_name', 'app_version', 'app_logo', 'company_name', 'company_slogan', 'address', 'hotline', 'zalo_link', 'contact_email', 'website', 'facebook', 'working_hours', 'working_days', 'about_content'];
      keys.forEach(key => {
        const el = document.getElementById('setting_' + key);
        if (el) settings[key] = el.value;
      });
      
      await api('/api/admin/settings', { method: 'PUT', body: JSON.stringify(settings) });
      alert('ÄÃ£ lÆ°u cÃ i Ä‘áº·t!');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const d = new Date(dateStr);
      return d.toLocaleDateString('vi-VN');
    }

    function formatDateTime(dateStr) {
      if (!dateStr) return '-';
      const d = new Date(dateStr);
      return d.toLocaleDateString('vi-VN') + ' ' + d.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
    }

    function getCategoryColor(cat) {
      const colors = { tax: '#F97316', labor: '#06B6D4', insurance: '#10B981', finance: '#8B5CF6', investment: '#6366F1', general: '#3B82F6', other: '#64748B' };
      return colors[cat] || '#3B82F6';
    }

    function getCategoryName(cat) {
      const names = { tax: 'Thuáº¿', labor: 'Lao Ä‘á»™ng', insurance: 'Báº£o hiá»ƒm', finance: 'TÃ i chÃ­nh', investment: 'Äáº§u tÆ°', general: 'Tin chung', other: 'KhÃ¡c' };
      return names[cat] || cat;
    }

    function getPriorityName(p) {
      const names = { high: 'ğŸ”´ Cao', medium: 'ğŸŸ  TB', low: 'ğŸŸ¢ Tháº¥p' };
      return names[p] || p;
    }

    function getStatusName(s) {
      const names = { pending: 'Chá» xá»­ lÃ½', processing: 'Äang xá»­ lÃ½', completed: 'HoÃ n thÃ nh', cancelled: 'ÄÃ£ há»§y' };
      return names[s] || s;
    }

    function getOrgCategoryName(cat) {
      const names = { government: 'CÆ¡ quan nhÃ  nÆ°á»›c', lawfirm: 'CÃ´ng ty luáº­t', notary: 'CÃ´ng chá»©ng', bailiff: 'Thá»«a phÃ¡t láº¡i' };
      return names[cat] || cat;
    }
  </script>
</body>
</html>
