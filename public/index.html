<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTIC Legal Calendar - Admin Dashboard v12</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .sidebar-link.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-backdrop { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .toggle-switch { position: relative; width: 44px; height: 24px; background: #cbd5e1; border-radius: 12px; cursor: pointer; transition: background 0.3s; }
        .toggle-switch.active { background: #3b82f6; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .toggle-switch.active::after { transform: translateX(20px); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        const API_URL = '';
        
        let state = {
            isLoggedIn: false,
            currentPage: 'dashboard',
            user: null,
            events: [],
            news: [],
            categories: [],
            agencies: [],
            provinces: [],
            stats: {},
            loading: false,
            modal: { show: false, type: '', data: null }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // API FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = { method, headers: { 'Content-Type': 'application/json' } };
            if (data) options.body = JSON.stringify(data);
            try {
                const res = await fetch(API_URL + endpoint, options);
                return await res.json();
            } catch (err) {
                console.error('API Error:', err);
                return { success: false, error: err.message };
            }
        }

        async function login(username, password) {
            const result = await apiCall('/api/admin/login', 'POST', { username, password });
            if (result.success) {
                state.isLoggedIn = true;
                state.user = result.user;
                localStorage.setItem('htic_admin', JSON.stringify({ username }));
                await loadAllData();
            }
            return result;
        }

        function logout() {
            state.isLoggedIn = false;
            state.user = null;
            localStorage.removeItem('htic_admin');
            render();
        }

        async function loadAllData() {
            state.loading = true;
            render();
            
            const [events, news, categories, agencies, provinces, stats] = await Promise.all([
                apiCall('/api/admin/events'),
                apiCall('/api/admin/news'),
                apiCall('/api/admin/categories'),
                apiCall('/api/admin/agencies'),
                apiCall('/api/admin/provinces'),
                apiCall('/api/admin/stats')
            ]);
            
            state.events = Array.isArray(events) ? events : [];
            state.news = Array.isArray(news) ? news : [];
            state.categories = Array.isArray(categories) ? categories : [];
            state.agencies = Array.isArray(agencies) ? agencies : [];
            state.provinces = Array.isArray(provinces) ? provinces : [];
            state.stats = stats || {};
            state.loading = false;
            render();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRUD FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function saveEvent(data) {
            const endpoint = data.id && !data.id.startsWith('evt_') ? `/api/admin/events/${data.id}` : (data.originalId ? `/api/admin/events/${data.originalId}` : '/api/admin/events');
            const method = data.originalId ? 'PUT' : 'POST';
            delete data.originalId;
            const result = await apiCall(endpoint, method, data);
            if (result.success) { closeModal(); await loadAllData(); showToast('LÆ°u nghÄ©a vá»¥ thÃ nh cÃ´ng!', 'success'); }
            else showToast('Lá»—i: ' + (result.message || 'KhÃ´ng thá»ƒ lÆ°u'), 'error');
        }

        async function deleteEvent(id) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
            const result = await apiCall(`/api/admin/events/${id}`, 'DELETE');
            if (result.success) { await loadAllData(); showToast('ÄÃ£ xÃ³a!', 'success'); }
        }

        async function saveNews(data) {
            const endpoint = data.originalId ? `/api/admin/news/${data.originalId}` : '/api/admin/news';
            const method = data.originalId ? 'PUT' : 'POST';
            delete data.originalId;
            const result = await apiCall(endpoint, method, data);
            if (result.success) { closeModal(); await loadAllData(); showToast('LÆ°u tin tá»©c thÃ nh cÃ´ng!', 'success'); }
            else showToast('Lá»—i: ' + (result.message || 'KhÃ´ng thá»ƒ lÆ°u'), 'error');
        }

        async function deleteNews(id) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
            const result = await apiCall(`/api/admin/news/${id}`, 'DELETE');
            if (result.success) { await loadAllData(); showToast('ÄÃ£ xÃ³a!', 'success'); }
        }

        async function saveCategory(data) {
            const endpoint = data.isEdit ? `/api/admin/categories/${data.id}` : '/api/admin/categories';
            const method = data.isEdit ? 'PUT' : 'POST';
            delete data.isEdit;
            const result = await apiCall(endpoint, method, data);
            if (result.success) { closeModal(); await loadAllData(); showToast('LÆ°u thÃ nh cÃ´ng!', 'success'); }
            else showToast('Lá»—i: ' + (result.message || 'KhÃ´ng thá»ƒ lÆ°u'), 'error');
        }

        async function deleteCategory(id) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
            const result = await apiCall(`/api/admin/categories/${id}`, 'DELETE');
            if (result.success) { await loadAllData(); showToast('ÄÃ£ xÃ³a!', 'success'); }
        }

        async function saveAgency(data) {
            const endpoint = data.isEdit ? `/api/admin/agencies/${data.id}` : '/api/admin/agencies';
            const method = data.isEdit ? 'PUT' : 'POST';
            delete data.isEdit;
            const result = await apiCall(endpoint, method, data);
            if (result.success) { closeModal(); await loadAllData(); showToast('LÆ°u thÃ nh cÃ´ng!', 'success'); }
            else showToast('Lá»—i: ' + (result.message || 'KhÃ´ng thá»ƒ lÆ°u'), 'error');
        }

        async function deleteAgency(id) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
            const result = await apiCall(`/api/admin/agencies/${id}`, 'DELETE');
            if (result.success) { await loadAllData(); showToast('ÄÃ£ xÃ³a!', 'success'); }
        }

        async function saveProvince(data) {
            const endpoint = data.isEdit ? `/api/admin/provinces/${data.id}` : '/api/admin/provinces';
            const method = data.isEdit ? 'PUT' : 'POST';
            delete data.isEdit;
            const result = await apiCall(endpoint, method, data);
            if (result.success) { closeModal(); await loadAllData(); showToast('LÆ°u thÃ nh cÃ´ng!', 'success'); }
            else showToast('Lá»—i: ' + (result.message || 'KhÃ´ng thá»ƒ lÆ°u'), 'error');
        }

        async function deleteProvince(id) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
            const result = await apiCall(`/api/admin/provinces/${id}`, 'DELETE');
            if (result.success) { await loadAllData(); showToast('ÄÃ£ xÃ³a!', 'success'); }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI HELPERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showModal(type, data = null) { state.modal = { show: true, type, data }; render(); }
        function closeModal() { state.modal = { show: false, type: '', data: null }; render(); }
        function navigate(page) { state.currentPage = page; render(); }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 fade-in ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const d = new Date(dateStr);
                if (isNaN(d.getTime())) return dateStr;
                return d.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
            } catch { return dateStr; }
        }

        function formatDateTimeLocal(dateStr) {
            if (!dateStr) return '';
            try {
                const d = new Date(dateStr);
                if (isNaN(d.getTime())) return '';
                return d.toISOString().slice(0, 16);
            } catch { return ''; }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function render() {
            document.getElementById('app').innerHTML = state.isLoggedIn ? renderDashboard() : renderLogin();
            attachEventListeners();
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-blue-800">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
                        <div class="text-center mb-8">
                            <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                </svg>
                            </div>
                            <h1 class="text-2xl font-bold text-gray-800">HTIC Legal Calendar</h1>
                            <p class="text-gray-500 mt-2">Admin Dashboard v12.0</p>
                        </div>
                        <form id="loginForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">TÃ i khoáº£n</label>
                                <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="admin" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Máº­t kháº©u</label>
                                <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                            </div>
                            <button type="submit" class="w-full py-3 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-blue-800">ÄÄƒng nháº­p</button>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            return `
                <div class="flex h-screen">
                    <div class="w-64 bg-white shadow-lg flex flex-col">
                        <div class="p-6 border-b">
                            <h1 class="text-xl font-bold text-gray-800">ğŸ›ï¸ HTIC Admin</h1>
                            <p class="text-sm text-gray-500 mt-1">Legal Calendar v12.0</p>
                        </div>
                        <nav class="flex-1 p-4 space-y-1 custom-scrollbar overflow-y-auto">
                            ${['dashboard|ğŸ“Š|Dashboard', 'events|ğŸ“‹|NghÄ©a vá»¥ phÃ¡p lÃ½', 'news|ğŸ“°|Tin tá»©c', 'categories|ğŸ·ï¸|Danh má»¥c', 'agencies|ğŸ¢|CÆ¡ quan ban hÃ nh', 'provinces|ğŸ“|Tá»‰nh/ThÃ nh phá»‘'].map(item => {
                                const [page, icon, label] = item.split('|');
                                return `<a href="#" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 ${state.currentPage === page ? 'active' : ''}" data-page="${page}">${icon} ${label}</a>`;
                            }).join('')}
                        </nav>
                        <div class="p-4 border-t">
                            <button id="logoutBtn" class="w-full py-2 text-red-600 hover:bg-red-50 rounded-lg">ğŸšª ÄÄƒng xuáº¥t</button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-auto bg-gray-100 custom-scrollbar">
                        <div class="p-8">${renderCurrentPage()}</div>
                    </div>
                </div>
                ${renderModal()}
            `;
        }

        function renderCurrentPage() {
            if (state.loading) return `<div class="flex items-center justify-center h-64"><div class="text-gray-500">Äang táº£i...</div></div>`;
            switch (state.currentPage) {
                case 'dashboard': return renderDashboardPage();
                case 'events': return renderEventsPage();
                case 'news': return renderNewsPage();
                case 'categories': return renderCategoriesPage();
                case 'agencies': return renderAgenciesPage();
                case 'provinces': return renderProvincesPage();
                default: return renderDashboardPage();
            }
        }

        function renderDashboardPage() {
            const statCards = [
                { label: 'NghÄ©a vá»¥ phÃ¡p lÃ½', value: state.stats.events || 0, color: 'blue', icon: 'ğŸ“‹' },
                { label: 'Tin tá»©c', value: state.stats.news || 0, color: 'green', icon: 'ğŸ“°' },
                { label: 'Danh má»¥c', value: state.stats.categories || 0, color: 'purple', icon: 'ğŸ·ï¸' },
                { label: 'CÆ¡ quan', value: state.stats.agencies || 0, color: 'yellow', icon: 'ğŸ¢' },
                { label: 'Tá»‰nh/TP', value: state.stats.provinces || 0, color: 'pink', icon: 'ğŸ“' }
            ];
            return `
                <div class="fade-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                        ${statCards.map(s => `
                            <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-${s.color}-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-gray-500 text-sm">${s.label}</div>
                                        <div class="text-2xl font-bold text-gray-800 mt-1">${s.value}</div>
                                    </div>
                                    <div class="text-2xl">${s.icon}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Œ ThÃ´ng tin há»‡ thá»‘ng</h3>
                            <div class="space-y-3 text-gray-600">
                                <p>âœ… Server: <span class="text-green-600 font-medium">Railway (Online)</span></p>
                                <p>âœ… Database: <span class="text-green-600 font-medium">PostgreSQL</span></p>
                                <p>âœ… Version: <span class="font-medium">12.0 (Full Features)</span></p>
                                <p>âœ… API: <span class="text-green-600 font-medium">Hoáº¡t Ä‘á»™ng</span></p>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“± HÆ°á»›ng dáº«n</h3>
                            <div class="space-y-2 text-gray-600 text-sm">
                                <p>â€¢ <strong>NghÄ©a vá»¥ phÃ¡p lÃ½:</strong> Quáº£n lÃ½ cÃ¡c deadline, má»©c pháº¡t, cÄƒn cá»© phÃ¡p lÃ½</p>
                                <p>â€¢ <strong>Tin tá»©c:</strong> ÄÄƒng tin tá»©c phÃ¡p luáº­t má»›i</p>
                                <p>â€¢ <strong>Danh má»¥c:</strong> Thuáº¿, Báº£o hiá»ƒm, Lao Ä‘á»™ng...</p>
                                <p>â€¢ <strong>CÆ¡ quan:</strong> Bá»™ TÃ i chÃ­nh, Tá»•ng cá»¥c Thuáº¿...</p>
                                <p>â€¢ <strong>Tá»‰nh/TP:</strong> Pháº¡m vi Ã¡p dá»¥ng Ä‘á»‹a phÆ°Æ¡ng</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENTS PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderEventsPage() {
            return `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“‹ NghÄ©a vá»¥ phÃ¡p lÃ½</h2>
                        <button id="addEventBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ ThÃªm má»›i</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">TiÃªu Ä‘á»</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Danh má»¥c</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Deadline</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">CÆ¡ quan</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Æ¯u tiÃªn</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Tráº¡ng thÃ¡i</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Thao tÃ¡c</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    ${state.events.length === 0 ? '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">ChÆ°a cÃ³ dá»¯ liá»‡u</td></tr>' : 
                                    state.events.map(e => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-4 py-3"><div class="font-medium text-gray-800 max-w-xs truncate">${e.title || ''}</div></td>
                                            <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700">${e.category_name || e.category || '-'}</span></td>
                                            <td class="px-4 py-3 text-gray-600 text-sm">${formatDate(e.deadline)}</td>
                                            <td class="px-4 py-3 text-gray-600 text-sm">${e.agency_name || '-'}</td>
                                            <td class="px-4 py-3">
                                                <span class="px-2 py-1 text-xs rounded-full ${e.priority === 'high' ? 'bg-red-100 text-red-700' : e.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}">${e.priority === 'high' ? 'Cao' : e.priority === 'medium' ? 'TB' : 'Tháº¥p'}</span>
                                            </td>
                                            <td class="px-4 py-3">
                                                <span class="px-2 py-1 text-xs rounded-full ${e.is_active !== false ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">${e.is_active !== false ? 'Hoáº¡t Ä‘á»™ng' : 'áº¨n'}</span>
                                            </td>
                                            <td class="px-4 py-3 text-center">
                                                <button class="edit-event-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${e.id}">âœï¸</button>
                                                <button class="delete-event-btn text-red-600 hover:text-red-800" data-id="${e.id}">ğŸ—‘ï¸</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NEWS PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderNewsPage() {
            return `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“° Tin tá»©c phÃ¡p luáº­t</h2>
                        <button id="addNewsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ ThÃªm má»›i</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">TiÃªu Ä‘á»</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Danh má»¥c</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">NgÃ y</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Nguá»“n</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Ná»•i báº­t</th>
                                    <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Thao tÃ¡c</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${state.news.length === 0 ? '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">ChÆ°a cÃ³ dá»¯ liá»‡u</td></tr>' : 
                                state.news.map(n => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3"><div class="font-medium text-gray-800 max-w-xs truncate">${n.title || ''}</div></td>
                                        <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-700">${n.category_name || n.category || '-'}</span></td>
                                        <td class="px-4 py-3 text-gray-600 text-sm">${formatDate(n.date)}</td>
                                        <td class="px-4 py-3 text-gray-600 text-sm">${n.source || '-'}</td>
                                        <td class="px-4 py-3">
                                            <span class="px-2 py-1 text-xs rounded-full ${n.is_featured ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-500'}">${n.is_featured ? 'â­ CÃ³' : 'KhÃ´ng'}</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <button class="edit-news-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${n.id}">âœï¸</button>
                                            <button class="delete-news-btn text-red-600 hover:text-red-800" data-id="${n.id}">ğŸ—‘ï¸</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CATEGORIES PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderCategoriesPage() {
            return `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ·ï¸ Danh má»¥c</h2>
                        <button id="addCategoryBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ ThÃªm má»›i</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${state.categories.map(c => `
                            <div class="bg-white rounded-xl shadow-sm p-4 border-l-4" style="border-color: ${c.color || '#3b82f6'}">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: ${c.color || '#3b82f6'}20">
                                            <span class="text-lg">ğŸ·ï¸</span>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-gray-800">${c.name}</div>
                                            <div class="text-xs text-gray-500">ID: ${c.id}</div>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="edit-category-btn text-blue-600 hover:text-blue-800 mr-1" data-id="${c.id}" data-name="${c.name}" data-icon="${c.icon || ''}" data-color="${c.color || ''}">âœï¸</button>
                                        <button class="delete-category-btn text-red-600 hover:text-red-800" data-id="${c.id}">ğŸ—‘ï¸</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AGENCIES PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderAgenciesPage() {
            return `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ¢ CÆ¡ quan ban hÃ nh</h2>
                        <button id="addAgencyBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ ThÃªm má»›i</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">ID</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">TÃªn cÆ¡ quan</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">TÃªn viáº¿t táº¯t</th>
                                    <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Thao tÃ¡c</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${state.agencies.map(a => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3 font-mono text-sm text-gray-600">${a.id}</td>
                                        <td class="px-4 py-3 font-medium text-gray-800">${a.name}</td>
                                        <td class="px-4 py-3 text-gray-600">${a.short_name || '-'}</td>
                                        <td class="px-4 py-3 text-center">
                                            <button class="edit-agency-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${a.id}" data-name="${a.name}" data-short="${a.short_name || ''}">âœï¸</button>
                                            <button class="delete-agency-btn text-red-600 hover:text-red-800" data-id="${a.id}">ğŸ—‘ï¸</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PROVINCES PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderProvincesPage() {
            return `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“ Tá»‰nh/ThÃ nh phá»‘</h2>
                        <button id="addProvinceBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ ThÃªm má»›i</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">ID</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">TÃªn tá»‰nh/TP</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">VÃ¹ng miá»n</th>
                                    <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Thao tÃ¡c</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${state.provinces.map(p => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3 font-mono text-sm text-gray-600">${p.id}</td>
                                        <td class="px-4 py-3 font-medium text-gray-800">${p.name}</td>
                                        <td class="px-4 py-3 text-gray-600">${p.region === 'north' ? 'Miá»n Báº¯c' : p.region === 'central' ? 'Miá»n Trung' : p.region === 'south' ? 'Miá»n Nam' : p.region || '-'}</td>
                                        <td class="px-4 py-3 text-center">
                                            <button class="edit-province-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${p.id}" data-name="${p.name}" data-region="${p.region || ''}">âœï¸</button>
                                            <button class="delete-province-btn text-red-600 hover:text-red-800" data-id="${p.id}">ğŸ—‘ï¸</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODAL RENDER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderModal() {
            if (!state.modal.show) return '';
            let content = '';
            switch (state.modal.type) {
                case 'event': content = renderEventForm(state.modal.data); break;
                case 'news': content = renderNewsForm(state.modal.data); break;
                case 'category': content = renderCategoryForm(state.modal.data); break;
                case 'agency': content = renderAgencyForm(state.modal.data); break;
                case 'province': content = renderProvinceForm(state.modal.data); break;
            }
            return `<div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-auto fade-in custom-scrollbar">${content}</div></div>`;
        }

        function renderEventForm(data) {
            const isEdit = !!data;
            return `
                <div class="p-6 border-b bg-gradient-to-r from-blue-50 to-white">
                    <h3 class="text-xl font-bold text-gray-800">${isEdit ? 'âœï¸ Sá»­a' : 'â• ThÃªm'} NghÄ©a vá»¥ phÃ¡p lÃ½</h3>
                </div>
                <form id="eventForm" class="p-6 space-y-4">
                    <input type="hidden" name="originalId" value="${data?.id || ''}">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TiÃªu Ä‘á» <span class="text-red-500">*</span></label>
                        <input type="text" name="title" value="${data?.title || ''}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">MÃ´ táº£ chi tiáº¿t</label>
                        <textarea name="description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">${data?.description || ''}</textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Danh má»¥c</label>
                            <select name="category" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Chá»n danh má»¥c --</option>
                                ${state.categories.map(c => `<option value="${c.id}" ${data?.category === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Deadline</label>
                            <input type="datetime-local" name="deadline" value="${formatDateTimeLocal(data?.deadline)}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Táº§n suáº¥t</label>
                            <select name="frequency" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Chá»n --</option>
                                <option value="HÃ ng thÃ¡ng" ${data?.frequency === 'HÃ ng thÃ¡ng' ? 'selected' : ''}>HÃ ng thÃ¡ng</option>
                                <option value="HÃ ng quÃ½" ${data?.frequency === 'HÃ ng quÃ½' ? 'selected' : ''}>HÃ ng quÃ½</option>
                                <option value="6 thÃ¡ng/láº§n" ${data?.frequency === '6 thÃ¡ng/láº§n' ? 'selected' : ''}>6 thÃ¡ng/láº§n</option>
                                <option value="HÃ ng nÄƒm" ${data?.frequency === 'HÃ ng nÄƒm' ? 'selected' : ''}>HÃ ng nÄƒm</option>
                                <option value="Má»™t láº§n" ${data?.frequency === 'Má»™t láº§n' ? 'selected' : ''}>Má»™t láº§n</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">CÆ¡ quan ban hÃ nh</label>
                            <select name="agency_id" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Chá»n cÆ¡ quan --</option>
                                ${state.agencies.map(a => `<option value="${a.id}" ${data?.agency_id === a.id ? 'selected' : ''}>${a.name}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">CÄƒn cá»© phÃ¡p lÃ½</label>
                        <textarea name="legal_basis" rows="2" placeholder="VD: ThÃ´ng tÆ° 80/2021/TT-BTC, Nghá»‹ Ä‘á»‹nh 145/2020/NÄ-CP" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">${data?.legal_basis || ''}</textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Má»©c pháº¡t vi pháº¡m</label>
                        <textarea name="penalty" rows="2" placeholder="VD: Pháº¡t tá»« 5-10 triá»‡u Ä‘á»“ng, pháº¡t cháº­m ná»™p 0.03%/ngÃ y" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">${data?.penalty || ''}</textarea>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ãp dá»¥ng cho</label>
                            <select name="applies_to" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="all" ${data?.applies_to === 'all' ? 'selected' : ''}>Táº¥t cáº£</option>
                                <option value="business" ${data?.applies_to === 'business' ? 'selected' : ''}>Doanh nghiá»‡p</option>
                                <option value="individual" ${data?.applies_to === 'individual' ? 'selected' : ''}>CÃ¡ nhÃ¢n</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Má»©c Ä‘á»™ Æ°u tiÃªn</label>
                            <select name="priority" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="low" ${data?.priority === 'low' ? 'selected' : ''}>Tháº¥p</option>
                                <option value="medium" ${data?.priority === 'medium' || !data?.priority ? 'selected' : ''}>Trung bÃ¬nh</option>
                                <option value="high" ${data?.priority === 'high' ? 'selected' : ''}>Cao</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nháº¯c trÆ°á»›c (ngÃ y)</label>
                            <input type="number" name="reminder_days" value="${data?.reminder_days || 7}" min="1" max="30" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tá»‰nh/TP Ã¡p dá»¥ng</label>
                            <select name="province_id" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- ToÃ n quá»‘c --</option>
                                ${state.provinces.map(p => `<option value="${p.id}" ${data?.province_id === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="flex items-center pt-6">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" name="is_active" ${data?.is_active !== false ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Äang hoáº¡t Ä‘á»™ng</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Há»§y</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ LÆ°u</button>
                    </div>
                </form>
            `;
        }

        function renderNewsForm(data) {
            const isEdit = !!data;
            return `
                <div class="p-6 border-b bg-gradient-to-r from-purple-50 to-white">
                    <h3 class="text-xl font-bold text-gray-800">${isEdit ? 'âœï¸ Sá»­a' : 'â• ThÃªm'} Tin tá»©c</h3>
                </div>
                <form id="newsForm" class="p-6 space-y-4">
                    <input type="hidden" name="originalId" value="${data?.id || ''}">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TiÃªu Ä‘á» <span class="text-red-500">*</span></label>
                        <input type="text" name="title" value="${data?.title || ''}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TÃ³m táº¯t</label>
                        <textarea name="summary" rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">${data?.summary || ''}</textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ná»™i dung chi tiáº¿t</label>
                        <textarea name="content" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">${data?.content || ''}</textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Danh má»¥c</label>
                            <select name="category" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Chá»n danh má»¥c --</option>
                                ${state.categories.map(c => `<option value="${c.id}" ${data?.category === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">NgÃ y Ä‘Äƒng</label>
                            <input type="datetime-local" name="date" value="${formatDateTimeLocal(data?.date) || formatDateTimeLocal(new Date().toISOString())}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nguá»“n tin</label>
                            <input type="text" name="source" value="${data?.source || ''}" placeholder="VD: Bá»™ TÃ i chÃ­nh, Tá»•ng cá»¥c Thuáº¿" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Link nguá»“n</label>
                            <input type="url" name="source_url" value="${data?.source_url || ''}" placeholder="https://..." class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Link hÃ¬nh áº£nh</label>
                        <input type="url" name="image_url" value="${data?.image_url || ''}" placeholder="https://..." class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="is_featured" ${data?.is_featured ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">â­ Tin ná»•i báº­t</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="is_active" ${data?.is_active !== false ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Äang hiá»ƒn thá»‹</span>
                        </label>
                    </div>
                    
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Há»§y</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ LÆ°u</button>
                    </div>
                </form>
            `;
        }

        function renderCategoryForm(data) {
            const isEdit = !!data;
            return `
                <div class="p-6 border-b"><h3 class="text-xl font-bold text-gray-800">${isEdit ? 'âœï¸ Sá»­a' : 'â• ThÃªm'} Danh má»¥c</h3></div>
                <form id="categoryForm" class="p-6 space-y-4">
                    <input type="hidden" name="id" value="${data?.id || ''}">
                    <input type="hidden" name="isEdit" value="${isEdit}">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TÃªn danh má»¥c <span class="text-red-500">*</span></label>
                        <input type="text" name="name" value="${data?.name || ''}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Icon</label>
                            <input type="text" name="icon" value="${data?.icon || ''}" placeholder="VD: receipt_long" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">MÃ u sáº¯c</label>
                            <input type="color" name="color" value="${data?.color || '#3b82f6'}" class="w-full h-10 border rounded-lg cursor-pointer">
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Há»§y</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ LÆ°u</button>
                    </div>
                </form>
            `;
        }

        function renderAgencyForm(data) {
            const isEdit = !!data;
            return `
                <div class="p-6 border-b"><h3 class="text-xl font-bold text-gray-800">${isEdit ? 'âœï¸ Sá»­a' : 'â• ThÃªm'} CÆ¡ quan ban hÃ nh</h3></div>
                <form id="agencyForm" class="p-6 space-y-4">
                    <input type="hidden" name="id" value="${data?.id || ''}">
                    <input type="hidden" name="isEdit" value="${isEdit}">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TÃªn cÆ¡ quan <span class="text-red-500">*</span></label>
                        <input type="text" name="name" value="${data?.name || ''}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TÃªn viáº¿t táº¯t</label>
                        <input type="text" name="short_name" value="${data?.short_name || ''}" placeholder="VD: BTC, BHXH" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Há»§y</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ LÆ°u</button>
                    </div>
                </form>
            `;
        }

        function renderProvinceForm(data) {
            const isEdit = !!data;
            return `
                <div class="p-6 border-b"><h3 class="text-xl font-bold text-gray-800">${isEdit ? 'âœï¸ Sá»­a' : 'â• ThÃªm'} Tá»‰nh/ThÃ nh phá»‘</h3></div>
                <form id="provinceForm" class="p-6 space-y-4">
                    <input type="hidden" name="id" value="${data?.id || ''}">
                    <input type="hidden" name="isEdit" value="${isEdit}">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">TÃªn tá»‰nh/TP <span class="text-red-500">*</span></label>
                        <input type="text" name="name" value="${data?.name || ''}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">VÃ¹ng miá»n</label>
                        <select name="region" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">-- Chá»n --</option>
                            <option value="north" ${data?.region === 'north' ? 'selected' : ''}>Miá»n Báº¯c</option>
                            <option value="central" ${data?.region === 'central' ? 'selected' : ''}>Miá»n Trung</option>
                            <option value="south" ${data?.region === 'south' ? 'selected' : ''}>Miá»n Nam</option>
                            <option value="all" ${data?.region === 'all' ? 'selected' : ''}>ToÃ n quá»‘c</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Há»§y</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ LÆ°u</button>
                    </div>
                </form>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENT LISTENERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function attachEventListeners() {
            document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                const result = await login(document.getElementById('username').value, document.getElementById('password').value);
                if (!result.success) showToast(result.message || 'ÄÄƒng nháº­p tháº¥t báº¡i', 'error');
            });

            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            document.querySelectorAll('.sidebar-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); navigate(e.currentTarget.dataset.page); }));

            // Add buttons
            document.getElementById('addEventBtn')?.addEventListener('click', () => showModal('event'));
            document.getElementById('addNewsBtn')?.addEventListener('click', () => showModal('news'));
            document.getElementById('addCategoryBtn')?.addEventListener('click', () => showModal('category'));
            document.getElementById('addAgencyBtn')?.addEventListener('click', () => showModal('agency'));
            document.getElementById('addProvinceBtn')?.addEventListener('click', () => showModal('province'));

            // Edit/Delete Events
            document.querySelectorAll('.edit-event-btn').forEach(btn => btn.addEventListener('click', () => showModal('event', state.events.find(e => e.id === btn.dataset.id))));
            document.querySelectorAll('.delete-event-btn').forEach(btn => btn.addEventListener('click', () => deleteEvent(btn.dataset.id)));

            // Edit/Delete News
            document.querySelectorAll('.edit-news-btn').forEach(btn => btn.addEventListener('click', () => showModal('news', state.news.find(n => n.id === btn.dataset.id))));
            document.querySelectorAll('.delete-news-btn').forEach(btn => btn.addEventListener('click', () => deleteNews(btn.dataset.id)));

            // Edit/Delete Categories
            document.querySelectorAll('.edit-category-btn').forEach(btn => btn.addEventListener('click', () => showModal('category', { id: btn.dataset.id, name: btn.dataset.name, icon: btn.dataset.icon, color: btn.dataset.color })));
            document.querySelectorAll('.delete-category-btn').forEach(btn => btn.addEventListener('click', () => deleteCategory(btn.dataset.id)));

            // Edit/Delete Agencies
            document.querySelectorAll('.edit-agency-btn').forEach(btn => btn.addEventListener('click', () => showModal('agency', { id: btn.dataset.id, name: btn.dataset.name, short_name: btn.dataset.short })));
            document.querySelectorAll('.delete-agency-btn').forEach(btn => btn.addEventListener('click', () => deleteAgency(btn.dataset.id)));

            // Edit/Delete Provinces
            document.querySelectorAll('.edit-province-btn').forEach(btn => btn.addEventListener('click', () => showModal('province', { id: btn.dataset.id, name: btn.dataset.name, region: btn.dataset.region })));
            document.querySelectorAll('.delete-province-btn').forEach(btn => btn.addEventListener('click', () => deleteProvince(btn.dataset.id)));

            // Modal cancel
            document.getElementById('cancelModalBtn')?.addEventListener('click', closeModal);

            // Forms
            document.getElementById('eventForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const data = Object.fromEntries(fd);
                data.is_active = fd.get('is_active') === 'on';
                saveEvent(data);
            });

            document.getElementById('newsForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const data = Object.fromEntries(fd);
                data.is_featured = fd.get('is_featured') === 'on';
                data.is_active = fd.get('is_active') === 'on';
                saveNews(data);
            });

            document.getElementById('categoryForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const data = Object.fromEntries(fd);
                data.isEdit = data.isEdit === 'true';
                saveCategory(data);
            });

            document.getElementById('agencyForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const data = Object.fromEntries(fd);
                data.isEdit = data.isEdit === 'true';
                saveAgency(data);
            });

            document.getElementById('provinceForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const data = Object.fromEntries(fd);
                data.isEdit = data.isEdit === 'true';
                saveProvince(data);
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function init() {
            const saved = localStorage.getItem('htic_admin');
            if (saved) {
                state.isLoggedIn = true;
                state.user = JSON.parse(saved);
                await loadAllData();
            }
            render();
        }

        init();
    </script>
</body>
</html>
